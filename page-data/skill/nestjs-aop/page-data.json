{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/skill/nestjs-aop/",
    "result": {"data":{"cur":{"id":"122a4296-ace7-5c97-8a62-55037352a874","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABM0lEQVQoz41SO07DQBT0BZCAJJj39ueP7EBkLIQEBTQUIAWRIBHRQIWUnoaSe0DDCSJKjkCRgpIrcAP6QbuxowWZhGK0o1nvvBnvBpss4UCzNSSBWqNK97VlCGoS2oMsnInFBgmsE8+H+KZNPPQN5x+QxAqRQ8wG+5yjXZlSA5oGBH5cm2ogu3iJTvCqhpioIXY4RYsYLRJYI57Dpm/X6RoNq8pPyQGm6Sk+kxHezQjPsg/DCtd6C+cqx5nK0FcZLlSOG70N0WQYepNsmlIYTNJDfGWXeIsGKDjGWPdwZwrcmxJXquv4re6BF1Wuaz9EJR6TPXzkxxjrwtWNWUGyRMQKuuIWfxr64ioxdkWEI5k4bvc6JNyweq0R/vqPPxI6kWY32Kkugf7x9hZW9kENB5Y97G8YIhP9LicF3gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"nestjs_logo\"\n        title=\"nestjs_logo\"\n        src=\"/static/6222f56890d651903c0e685b8ec265b2/37523/nestjs_logo.png\"\n        srcset=\"/static/6222f56890d651903c0e685b8ec265b2/e9ff0/nestjs_logo.png 180w,\n/static/6222f56890d651903c0e685b8ec265b2/f21e7/nestjs_logo.png 360w,\n/static/6222f56890d651903c0e685b8ec265b2/37523/nestjs_logo.png 720w,\n/static/6222f56890d651903c0e685b8ec265b2/76cea/nestjs_logo.png 799w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<h2 id=\"-횡단-관심사-란\" style=\"position:relative;\"><a href=\"#-%ED%9A%A1%EB%8B%A8-%EA%B4%80%EC%8B%AC%EC%82%AC-%EB%9E%80\" aria-label=\" 횡단 관심사 란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🤝 횡단 관심사 란?</h2>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 548px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACSElEQVQoz12S608aARDE7///1qQfEKSIAh5VpMhTojwOOEUUKxW4giA9kBN5COgBUrhfA9rUdJNJdjaZzWR3BAP4CAwD4x2rvtUeUCg2aKhdFosFlVp7zTvdEZPJDKXapqQ0GQ71lRqBdyF/l/GvVv2JfMdnewr/icJkvsTlu1rzbOEerfeM3ZNnw3XGz7v+28Jxu83w4YFes8ny6QmmU7TCJaoUpXeRIuf1I4lBTvd8tOU4abcPSQxwHQhSj0dJuf0kXT7K0QjzyTNCuVyipChovR5GrwfNFmomgRI6QEsdkRX3iNlEMk43aiyEtC2ued7joRo5JGF3E7Pt8sP/jdnzCCH3UCLbUdCNOeg6xmzGoF7l8TpHv5gn/S1K0BEmvhdBuzonuhsiuBPmInxCTU4TcYUJ7AS5iSdZvE4RhrMxv1myXN2s24Vmk0rkkO8uC83wPtmtLyRNm8hWK/VDkbR5k4Rpk7xjC8XjQDJbSZosXIs76MM+QqJzzf108PaElxeYzRhrLbqVEt1qmXhA4sAV48gb50EpEvgaw+OMcXYsU8tf4RPjeJzHFDI5jMUcodi75XbUeotNpwOqSiXk5cz6icttEznbJukNC+dWC798Lk4tFtIrRw4b1f0dZPOKm7kR7ehPfYTFyzPLiY6h6/D6unaqj0eMOxrjR41QMMfWtoz34JSOqiKKGWz2DFL8imqxgsMpY7OnyJ8XgSUC/+XOWC4/jsjftDmS6pzmVeYLg2S2QUSqU651GYwmnMgNjqQaTW24zuEf4sq6bQDNXssAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"횡단 관심사\"\n        title=\"횡단 관심사\"\n        src=\"/static/6c4e696c10c5c42e48b39d54735ad275/a58fe/cross-cutting.png\"\n        srcset=\"/static/6c4e696c10c5c42e48b39d54735ad275/e9ff0/cross-cutting.png 180w,\n/static/6c4e696c10c5c42e48b39d54735ad275/f21e7/cross-cutting.png 360w,\n/static/6c4e696c10c5c42e48b39d54735ad275/a58fe/cross-cutting.png 548w\"\n        sizes=\"(max-width: 548px) 100vw, 548px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>비즈니스 로직의 핵심 기능이 아닌, 프로세스 중간에 삽입되는 기능을 말한다.<br>\n위 사진처럼 프로세스마다 공통되는 기능을 <code class=\"language-text\">횡단 관심사</code>라고 부르며, 이러한 관심사들의 분리는 <code class=\"language-text\">AOP</code>, 즉 관점 지향 프로그래밍에서 모듈성을 증가시키기 위한 패터다임이다.<br></p>\n<br>\n<h3 id=\"-aop의-주요-개념\" style=\"position:relative;\"><a href=\"#-aop%EC%9D%98-%EC%A3%BC%EC%9A%94-%EA%B0%9C%EB%85%90\" aria-label=\" aop의 주요 개념 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🗿 AOP의 주요 개념</h3>\n<br>\n<ul>\n<li>Aspect : 위에서 설명한 <code class=\"language-text\">횡단 관심사</code>를 모듈화 한 것이다.</li>\n<li>Target : Aspect를 적용하는 곳이다.</li>\n<li>Advice : 실질적인 부가기능을 담은 구현체이다.</li>\n<li>JointPoint : <code class=\"language-text\">Advice가 적용될 위치</code>로 필드에서 값을 꺼내올 때 등 다양한 시점에 적용 가능하다.</li>\n<li>PointCut : <code class=\"language-text\">JointPoint의 상세한 스펙</code>을 정의한 것으로 Advice가 실행될 지점을 정할 수 있음</li>\n</ul>\n<br>\n<h3 id=\"-nestjs의-interceptor-란\" style=\"position:relative;\"><a href=\"#-nestjs%EC%9D%98-interceptor-%EB%9E%80\" aria-label=\" nestjs의 interceptor 란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>👽 NestJS의 Interceptor 란?</h3>\n<br>\n<p>NestJS는 <code class=\"language-text\">AOP(Aspect Oriented Programing)</code>에서 영감을 받은 Interceptor를 다음과 같은 5가지의 예시를 들며 강조하고 있다.<br></p>\n<ul>\n<li>메서드 실행 전후에 추가 논리 바인딩</li>\n<li>함수에서 반환된 결과를 변환</li>\n<li>함수에서 throw된 예외를 변환</li>\n<li>기본 기능 동작 확장</li>\n<li>특정 조건에 따라 함수를 완전히 재정의 (예: 캐싱 목적)</li>\n</ul>\n<br>\n<p>NestJS 요청 - 응답 생명주기를 봤을 때 Controller 로직 전/후로 동작을 수행하는 기능이다.<br>\n여기서 위 1번 기능으로 <code class=\"language-text\">JointPoint</code>를 지정해 관심사 분리를 진행할 예정이다.<br></p>\n<br>\n<h2 id=\"-횡단-관심사-분리\" style=\"position:relative;\"><a href=\"#-%ED%9A%A1%EB%8B%A8-%EA%B4%80%EC%8B%AC%EC%82%AC-%EB%B6%84%EB%A6%AC\" aria-label=\" 횡단 관심사 분리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🪢 횡단 관심사 분리</h2>\n<br>\n<p>예를들어 채팅방을 구현한다 가정을 해보자.<br>\n방장이 존재할 것이며, 방장은 <code class=\"language-text\">mute</code>, <code class=\"language-text\">ban</code>, <code class=\"language-text\">invite</code>의 기능을 수행할 수 있다.<br>\n유저는 <code class=\"language-text\">chat</code>, <code class=\"language-text\">DM</code>, <code class=\"language-text\">block</code>의 기능을 사용할 수 있다.<br>\n그전에 일단 해당 채팅방에 참여하고 있어야 한다.<br>\n이를 통해 위 AOP의 <code class=\"language-text\">Aspect</code>를 정의해 보면 <code class=\"language-text\">채팅방</code>, <code class=\"language-text\">채팅</code>으로 구분할 수 있다.<br></p>\n<br>\n<p><code class=\"language-text\">채팅방</code>에서는 <strong>채팅방 존재 여부</strong>, <strong>방장 권한</strong>, <strong>채팅방 참여 가능 여부</strong>로 나눌 수 있고, <code class=\"language-text\">채팅</code>에서는 <strong>mute 여부</strong>, <strong>block 여부</strong>로 나눌 수 있다.<br></p>\n<br>\n<h3 id=\"-관점을-기준으로-분리해-보자\" style=\"position:relative;\"><a href=\"#-%EA%B4%80%EC%A0%90%EC%9D%84-%EA%B8%B0%EC%A4%80%EC%9C%BC%EB%A1%9C-%EB%B6%84%EB%A6%AC%ED%95%B4-%EB%B3%B4%EC%9E%90\" aria-label=\" 관점을 기준으로 분리해 보자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🕸 관점을 기준으로 분리해 보자</h3>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Client</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Socket</span> <span class=\"token punctuation\">{</span>\n  hasChannel<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">;</span>\n  isAdmin<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">;</span>\n  isMuted<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 채팅방 Interceptor</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ChannelAuthInterceptor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">NestInterceptor</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> requiredAdmin<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>param<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>requiredAdmin <span class=\"token operator\">=</span> param<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">intercept</span><span class=\"token punctuation\">(</span>context<span class=\"token operator\">:</span> ExecutionContext<span class=\"token punctuation\">,</span> next<span class=\"token operator\">:</span> CallHandler<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>Observable<span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">>></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// Socket Gateway 기반으로 구현된 사항 입니다.</span>\n    <span class=\"token keyword\">const</span> client<span class=\"token operator\">:</span> Client <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">switchToWs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 1. 채팅방에 존재하지 않는 경우 Exception</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>client<span class=\"token punctuation\">.</span>hasChannel<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ForbiddenException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 2. 방장 권한이 없는 경우 Exception</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>client<span class=\"token punctuation\">.</span>isAdmin <span class=\"token operator\">&amp;&amp;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>requiredAdmin<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ForbiddenException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 채팅 Interceptor</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ChannelMessageInterceptor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">NestInterceptor</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">intercept</span><span class=\"token punctuation\">(</span>context<span class=\"token operator\">:</span> ExecutionContext<span class=\"token punctuation\">,</span> next<span class=\"token operator\">:</span> CallHandler<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>Observable<span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">>></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">const</span> client<span class=\"token operator\">:</span> Client <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">switchToWs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 3. 방장에게 채팅 차단을 당한 경우 Exception</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>client<span class=\"token punctuation\">.</span>isMuted<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ForbiddenException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>위에 예시로 적은 모든 기능들을 코드화 하진 않았지만, 위와 같이 <code class=\"language-text\">채팅방</code>, <code class=\"language-text\">채팅</code>으로 관점을 Interceptor로 분리하고, 세부적인 기능을 조건문으로 조정할 수 있다.<br></p>\n<br>\n<h3 id=\"-pointcut\" style=\"position:relative;\"><a href=\"#-pointcut\" aria-label=\" pointcut permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🎯 PointCut</h3>\n<br>\n<p>클래스, 메서드 어느 곳이던 위 <code class=\"language-text\">Interceptor</code>를 적용할 수 있다.<br>\n위 예시는 채팅방이니, <code class=\"language-text\">Gateway</code>의 메서드 하나에 적용해 보도록 하겠다.<br></p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> ChannelAuthInterceptor <span class=\"token keyword\">from</span> <span class=\"token string\">'@Interceptor/channel'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">WebSocketGateway</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SocketGateway</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">OnGatewayConnection</span><span class=\"token punctuation\">,</span> OnGatewayDisconnect <span class=\"token punctuation\">{</span>\n\n  <span class=\"token comment\">/* ... */</span>\n\n  <span class=\"token comment\">// ⬇️ 이곳이 PointCut이 된다.</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">UseInterceptors</span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelAuthInterceptor</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">SubscribeMessage</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'muteUser'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">muteUser</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">ConnectedSocket</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> client<span class=\"token operator\">:</span> ClientInstance<span class=\"token punctuation\">,</span> <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">MessageBody</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'userId'</span><span class=\"token punctuation\">)</span> userId<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* Business Logic */</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>위처럼 필요한 메서드에 <code class=\"language-text\">@UseInterceptors</code> 데코레이터를 사용하여 <code class=\"language-text\">Interceptor</code>를 적용할 수 있다.<br>\n필요에 따라, 여러 관심사들을 <code class=\"language-text\">Interceptor</code>로 묶어 <code class=\"language-text\">횡단 관심사 분리</code>를 진행할 수 있다.<br></p>\n<br>\n<p>이로인해 AOP의 주요 목적인 <code class=\"language-text\">관심사</code>들의 모듈화를 하게 되어, 유지보수성이 높은 코드를 짤 수 있게 된다.<br></p>\n<br>\n<h3 id=\"-interceptor로-할-수-있는-것들\" style=\"position:relative;\"><a href=\"#-interceptor%EB%A1%9C-%ED%95%A0-%EC%88%98-%EC%9E%88%EB%8A%94-%EA%B2%83%EB%93%A4\" aria-label=\" interceptor로 할 수 있는 것들 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🧩 Interceptor로 할 수 있는 것들</h3>\n<br>\n<p>Interceptor만 잘 이용하면 여러 기능을 구현할 수 있다.<br>\nHTTP 통신 라우터라면 throw 컨트롤, 메서드 로깅, 요청값 변경, 유효성 검사 등 여러 기능을 수행할 수 있다.<br></p>\n<br>\n<p>이외에 <code class=\"language-text\">Socket Gateway</code>라면 NestJS에서 지원하지 않는 <code class=\"language-text\">Socket Message Body</code>의 유효성 검사가 가능하다.<br>\n이 부분은 <code class=\"language-text\">ValidationPipe</code>로 진행할 수 있다고 생각할 수 있는데, <code class=\"language-text\">ValidationPipe</code>는 정상적으로 들어온 인자에 대해 검사를 진행하기 때문에, 애초에 <code class=\"language-text\">undefined</code>로 들어온 인자는 검사 자체를 안한다.<br>\n이는 서버 운영에 치명적인 결과를 낳을 수 있지만 <code class=\"language-text\">Interceptor</code>만 잘 활용하면 해결 가능한 문제이다.<br></p>\n<br>\n<h2 id=\"-참고-자료\" style=\"position:relative;\"><a href=\"#-%EC%B0%B8%EA%B3%A0-%EC%9E%90%EB%A3%8C\" aria-label=\" 참고 자료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📚 참고 자료</h2>\n<br>\n<blockquote>\n<p>NestJS Docs</p>\n</blockquote>\n<ul>\n<li><a href=\"https://nestjs.com\">https://nestjs.com</a></li>\n</ul>\n<br>\n<blockquote>\n<p>AOP 주요 개념</p>\n</blockquote>\n<ul>\n<li><a href=\"https://engkimbs.tistory.com/746\">https://engkimbs.tistory.com/746</a></li>\n</ul>\n<br>\n<h2 id=\"-github-주소\" style=\"position:relative;\"><a href=\"#-github-%EC%A3%BC%EC%86%8C\" aria-label=\" github 주소 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🧑‍💻 Github 주소</h2>\n<br>\n<ul>\n<li><a href=\"https://github.com/mtak0235/simmons_transcendence/blob/main/backend/node/app/src/socket/interceptor/channel.socket.interceptor.ts\">이 글을 쓰게 된 계기</a></li>\n</ul>\n<br/>\n<br/>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-%ED%9A%A1%EB%8B%A8-%EA%B4%80%EC%8B%AC%EC%82%AC-%EB%9E%80\">🤝 횡단 관심사 란?</a></p>\n<ul>\n<li><a href=\"#-aop%EC%9D%98-%EC%A3%BC%EC%9A%94-%EA%B0%9C%EB%85%90\">🗿 AOP의 주요 개념</a></li>\n<li><a href=\"#-nestjs%EC%9D%98-interceptor-%EB%9E%80\">👽 NestJS의 Interceptor 란?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%ED%9A%A1%EB%8B%A8-%EA%B4%80%EC%8B%AC%EC%82%AC-%EB%B6%84%EB%A6%AC\">🪢 횡단 관심사 분리</a></p>\n<ul>\n<li><a href=\"#-%EA%B4%80%EC%A0%90%EC%9D%84-%EA%B8%B0%EC%A4%80%EC%9C%BC%EB%A1%9C-%EB%B6%84%EB%A6%AC%ED%95%B4-%EB%B3%B4%EC%9E%90\">🕸 관점을 기준으로 분리해 보자</a></li>\n<li><a href=\"#-pointcut\">🎯 PointCut</a></li>\n<li><a href=\"#-interceptor%EB%A1%9C-%ED%95%A0-%EC%88%98-%EC%9E%88%EB%8A%94-%EA%B2%83%EB%93%A4\">🧩 Interceptor로 할 수 있는 것들</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EC%B0%B8%EA%B3%A0-%EC%9E%90%EB%A3%8C\">📚 참고 자료</a></p>\n</li>\n<li>\n<p><a href=\"#-github-%EC%A3%BC%EC%86%8C\">🧑‍💻 Github 주소</a></p>\n</li>\n</ul>\n</div>","excerpt":"🤝 횡단 관심사 란?  비즈니스 로직의 핵심 기능이 아닌, 프로세스 중간에 삽입되는 기능을 말한다.\n위 사진처럼 프로세스마다 공통되는 기능을 라고 부르며, 이러한 관심사들의 분리는 , 즉 관점 지향 프로그래밍에서 모듈성을 증가시키기 위한 패터다임이다. 🗿 AOP의 주요 개념 Aspect : 위에서 설명한 를 모듈화 한 것이다. Target : Aspect를 적용하는 곳이다. Advice : 실질적인 부가기능을 담은 구현체이다. JointPoint : 로 필드에서 값을 꺼내올 때 등 다양한 시점에 적용 가능하다. PointCut : 을 정의한 것으로 Advice가 실행될 지점을 정할 수 있음 👽 NestJS의 Interceptor 란? NestJS는 에서 영감을 받은 Interceptor를 다음과 같은 5가지의 예시를 들며 강조하고 있다. 메서드 실행 전후에 추가 논리 바인딩 함수에서 반환된 결과를 변환 함수에서 throw된 예외를 변환 기본 기능 동작 확장 특정 조건에 따라 함수를…","frontmatter":{"date":"September 25, 2022","title":"NestJS Interceptor를 이용한 횡단 관심사 분리","categories":"Node.js NestJS","author":"seongsu","emoji":"1️⃣3️⃣"},"fields":{"slug":"/skill/nestjs-aop/"}},"next":{"id":"f21bf880-1afe-5951-9102-8fe325e58d23","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 620px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAQC/8QAFAEBAAAAAAAAAAAAAAAAAAAAA//aAAwDAQACEAMQAAABmnzthlBp/8QAGhAAAgIDAAAAAAAAAAAAAAAAAQIAERASMv/aAAgBAQABBQLW0EfpGNOcf//EABcRAAMBAAAAAAAAAAAAAAAAAAEQERL/2gAIAQMBAT8B0bF//8QAFxEAAwEAAAAAAAAAAAAAAAAAARAREv/aAAgBAgEBPwHIi//EABoQAAICAwAAAAAAAAAAAAAAAAABAjEQISL/2gAIAQEABj8CbilZ1E0Xn//EABoQAQADAQEBAAAAAAAAAAAAAAEAESExQcH/2gAIAQEAAT8hDtK3NCEPhKW4PCByoykdWf/aAAwDAQACAAMAAAAQDz//xAAXEQADAQAAAAAAAAAAAAAAAAAAASEx/9oACAEDAQE/ENwSh//EABcRAQEBAQAAAAAAAAAAAAAAAAEAITH/2gAIAQIBAT8Q6CXb/8QAGxABAQACAwEAAAAAAAAAAAAAAREAIUFRYfH/2gAIAQEAAT8QWgHgJwONfMKbMRjk7plHC7UbDDKBveBa6dvrgFO95//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"thumbnail\"\n        title=\"thumbnail\"\n        src=\"/static/781354a41a332ac4571fb50564bea8dd/935bc/thumbnail.jpg\"\n        srcset=\"/static/781354a41a332ac4571fb50564bea8dd/4ec73/thumbnail.jpg 180w,\n/static/781354a41a332ac4571fb50564bea8dd/158ba/thumbnail.jpg 360w,\n/static/781354a41a332ac4571fb50564bea8dd/935bc/thumbnail.jpg 620w\"\n        sizes=\"(max-width: 620px) 100vw, 620px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>[출처] <a href=\"https://korea.ul.com/ict/\">https://korea.ul.com/ict/</a></p>\n</blockquote>\n<br>\n<h2 id=\"-소켓-이란\" style=\"position:relative;\"><a href=\"#-%EC%86%8C%EC%BC%93-%EC%9D%B4%EB%9E%80\" aria-label=\" 소켓 이란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💡 소켓 이란?</h2>\n<br>\n<p>소켓은 특정한 파이프의 끝, 파이프 이음쇠 또는 위생 기구를 수용하기 위해 확장한 것으로, 또 다른 파이프의 끝이나 파이프 이음쇠을 가리킨다. 또한 소켓(socket)은 통신선 또는 전기선, 전구 따위를 끼워 넣어 연결선과 접속하게 하는 연결기구를 가리킨다.<br></p>\n<blockquote>\n<p>[출처] <a href=\"https://ko.wikipedia.org/wiki/%EC%86%8C%EC%BC%93\">Wikipedia</a></p>\n</blockquote>\n<br>\n<p>쉽게 말해, 특정 지점의 <code class=\"language-text\">Endpoint</code>를 의미하는 것이다.<br>\n오늘 알아볼 내용은 <code class=\"language-text\">소켓</code> 중 <code class=\"language-text\">네트워크 소켓</code>을 알아보는 것이 목적이고, <code class=\"language-text\">네트워크 소켓</code>도 위에 설명된 소켓과 유사한 개념이다. 단지 <code class=\"language-text\">Endpoint</code>가 특정 프로세스 일 뿐이다.<br></p>\n<br>\n<h3 id=\"-네크워크-소켓\" style=\"position:relative;\"><a href=\"#-%EB%84%A4%ED%81%AC%EC%9B%8C%ED%81%AC-%EC%86%8C%EC%BC%93\" aria-label=\" 네크워크 소켓 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🌐 네크워크 소켓</h3>\n<br>\n<p>네트워크 소켓은 네트워크를 통해 데이터를 보내고 받기 위한 <code class=\"language-text\">Endpoint</code>의 끝점 역할을 하는 <code class=\"language-text\">네트워크 노드</code> 내의 소프트웨어 구조다.<br>\n소켓의 구조와 속성은 네트워크 API에 따라 정의되며, 일반적인 경우 소켓은 실행 중인 프로세스의 생명주기와 맞물린다.<br></p>\n<br>\n<h2 id=\"-http-socket\" style=\"position:relative;\"><a href=\"#-http-socket\" aria-label=\" http socket permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🟡 HTTP Socket</h2>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAACo0lEQVQoz2XQ20/acBQHcP85EhnSEihe5uuWbHvY47Jkm4kvLmpcljiTXYzTqNmcU6eggGVgVC4tpVIEbB1IKeWqg1KggGv7W4BpxnZyXk5yPsn3nD7S+7mScV+y6E/OyUdthfD3YsR1GXXzpCOyscxsrJ5trCZ31maePoGMwyZkeEBv1EOmbvex9B6QQ2otAJrBVsGn5kiQJ0ExdM1huf2t868r0S9LRcfm2/ExHWxGkJEefBHZAS2yjWt4PXP0i8PbPkdKCQ9nW4+tLZ5+Wsjsrs+NPRsw/IfZmFUWfGnaqlSxRtaj8EQ+jFbjx62kn7Nv5hzbGfu3kmt39sXzLtYN/IWTUasq+q9YVBHbWOYJgTmUkt4Wi5Uwb50IVgMBJUy9n5jUwQiCjEAwAsGIHkK6sS3gOqTUg6BOSFmPnCZAIQTyJ00WK+NezumMWS2C37swNa2DTEbTkHlw9MHDx/fuP4JgpHNzI6AIXlD1S/yhzGEy51d5vHnhLfuOCgfujBOVcGz+5aQOMiHmdmwIvolNU/tKLdb4STWFsJgl65mIVKQbxTMxRZVOQ7VYVIxG5PiPd9MzXdzzsEQiCQBQVBV0S1VBvgAqlT8TALKiAAAWl1bu6AyI+e4/ONEhSmdTBaoC8llQEW4sUDp4aXFZD5nMg6M92I1HqHiWSuRovkzzZSYjMIUak6/S6dJ5tkLFcwTNpUqtV3Pz/f16g3HoVrbx1kHIFoijJOthrgJslUjVCLaGX4i7PuaYLh5EsugJG0xLE68/aDRaCDb3YMtRGA0m3BSHJUrBlEhyVYKtBFjhMJoJsmKIl0iuFi3KU28+ajRa2NCLl7ddrpOkA2PsGG3HaAfOrKOY5TiMEnG7n7b5z/Z8MReZHJ+c1WrbsWGD+bZ/Aw6rPa/Rl73kAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"http-layer\"\n        title=\"http-layer\"\n        src=\"/static/25cc812d10419a499efee370b1162180/37523/http-layers.png\"\n        srcset=\"/static/25cc812d10419a499efee370b1162180/e9ff0/http-layers.png 180w,\n/static/25cc812d10419a499efee370b1162180/f21e7/http-layers.png 360w,\n/static/25cc812d10419a499efee370b1162180/37523/http-layers.png 720w,\n/static/25cc812d10419a499efee370b1162180/302a4/http-layers.png 1080w,\n/static/25cc812d10419a499efee370b1162180/07a9c/http-layers.png 1440w,\n/static/25cc812d10419a499efee370b1162180/1acf3/http-layers.png 1596w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>[출처] <a href=\"https://developer.mozilla.org/ko/docs/Web/HTTP/Overview\">Mozilla HTTP</a></p>\n</blockquote>\n<br>\n<p>우리가 매일 사용하는 HTTP 통신도 <code class=\"language-text\">Socket 통신</code>으로 작동한다.<br>\nTCP/UDP 통신 위에 입혀진 HTTP는 <code class=\"language-text\">Socket Connection</code>이 된 후에 들어온 패킷의 <code class=\"language-text\">Payload</code>를 읽어내는 식으로 동작하게 정의된 규약이다.<br></p>\n<br>\n<p><code class=\"language-text\">이 글은 TCP 기반 HTTP 통신을 설명합니다.</code></p>\n<br>\n<h3 id=\"-socket-connection\" style=\"position:relative;\"><a href=\"#-socket-connection\" aria-label=\" socket connection permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🔌 Socket Connection</h3>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 632px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAABe0lEQVQ4y41TyarCQBD0//8iP+DZQ5TgxSAoJooouB3Ug6Im7ku0HtXQeeM4LgMhQ09NdXfVdAEAHo8H7OWK/RIv6OZ+vyNNU6zXa+x2uxzEuGLM/2azESz/xGg8J7zdbhgMBuh2u5hOp84KzOSj0Qj9fh/D4RBZlv0TmpkJ3O/3uF6vOJ/PkmQymSBJEmd7l8vF3bIJOJ1OQsw9SdvtNsIwRK/Xw3K5fNLwcDg8VZ63rAGtzGUAK1+tVpLoeDwKGTW3tX1q2SbUxYp5tt1uRd9Go4FOp4PxePyS+IVQdWE1FJ2XW62W7ElGZxWjyd8SEsjWuOg2XScxdXW5rtiPhLVaTVqZz+diCPXSd2aSMUYdv7Ycx7G4WqlUUCqV4Ps+6vW6vLfFYpE/enX5Jw3ZIi+zUlbseR6KxaIkKZfLYshsNvuN0HZZx4zkNIYGVatVBEGAZrP5XUMlNGfYXJwets0JiqLoMyFJzEE3Z/hdAjtWcB3YIHu8zM+u8A9hadmDSLjebwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"tcp-connection\"\n        title=\"tcp-connection\"\n        src=\"/static/5fa7b3221fbcf0caffe6434ca2809220/084e2/tcp-connection.png\"\n        srcset=\"/static/5fa7b3221fbcf0caffe6434ca2809220/e9ff0/tcp-connection.png 180w,\n/static/5fa7b3221fbcf0caffe6434ca2809220/f21e7/tcp-connection.png 360w,\n/static/5fa7b3221fbcf0caffe6434ca2809220/084e2/tcp-connection.png 632w\"\n        sizes=\"(max-width: 632px) 100vw, 632px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n[출처] <a href=\"https://en.wikipedia.org/wiki/Transmission_Control_Protocol\">https://en.wikipedia.org/wiki/Transmission_Control_Protocol</a></p>\n<br>\n<p>Server에 Binding된 Port로 Client가 요청을 보냈을 때 도달하는 지점이 <code class=\"language-text\">Server Socket</code> 이다.<br></p>\n<blockquote>\n<p>위 그림의 <code class=\"language-text\">SYN</code>이라 보면 된다.</p>\n</blockquote>\n<p>그 뒤 Client 정보를 accept 해주고, Client에 <code class=\"language-text\">SYN-ACK</code> 응답이 내려간다.<br>\n이렇게 소켓을 이용해 Client - Server 간 파이프라인이 구축되는 것이다.<br></p>\n<br>\n<p>이러한 연결이 수립되면, Client와 Server는 <code class=\"language-text\">HTML</code>, <code class=\"language-text\">CSS</code>, <code class=\"language-text\">JS</code>, <code class=\"language-text\">JSON</code>, <code class=\"language-text\">Binary</code> 등과 같은 데이터를 주고 받을 수 있다.<br></p>\n<br>\n<h3 id=\"️-client가-syn만-보내고-끝내면-어떻게-되지\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-client%EA%B0%80-syn%EB%A7%8C-%EB%B3%B4%EB%82%B4%EA%B3%A0-%EB%81%9D%EB%82%B4%EB%A9%B4-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%90%98%EC%A7%80\" aria-label=\"️ client가 syn만 보내고 끝내면 어떻게 되지 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>❗️ Client가 SYN만 보내고 끝내면 어떻게 되지?</h3>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 480px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIDBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe5bItQ//8QAGBAAAwEBAAAAAAAAAAAAAAAAAAESESH/2gAIAQEAAQUCdaJ8JVn/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAEBAQAAAAAAAAAAAAAAAAAQESH/2gAIAQEABj8CyQ0p/8QAGhAAAgMBAQAAAAAAAAAAAAAAARARMVEhgf/aAAgBAQABPyEL3gjGQQcRpOzq/9oADAMBAAIAAwAAABAjz//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/ECf/xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPxBn/8QAGxAAAgIDAQAAAAAAAAAAAAAAAREhMQAQQbH/2gAIAQEAAT8QkQ4QSJ9wNGMAgOzVophWNr1//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"syn backlog queue\"\n        title=\"syn backlog queue\"\n        src=\"/static/7b24f8c77d28ab162632176c854ed7cf/7cc5e/syn-backlog-queue.jpg\"\n        srcset=\"/static/7b24f8c77d28ab162632176c854ed7cf/4ec73/syn-backlog-queue.jpg 180w,\n/static/7b24f8c77d28ab162632176c854ed7cf/158ba/syn-backlog-queue.jpg 360w,\n/static/7b24f8c77d28ab162632176c854ed7cf/7cc5e/syn-backlog-queue.jpg 480w\"\n        sizes=\"(max-width: 480px) 100vw, 480px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>[출처] <a href=\"https://blog.cloudflare.com/ko-kr/syn-packet-handling-in-the-wild-ko-kr/\">https://blog.cloudflare.com/ko-kr/syn-packet-handling-in-the-wild-ko-kr/</a></p>\n</blockquote>\n<br>\n<p>Client가 <code class=\"language-text\">SYN</code>만 보내고 <code class=\"language-text\">ACK</code>를 Server에 보내지 않으면, Server의 <code class=\"language-text\">Backlog Queue</code>에 담겨있는 Client 정보가 계속 남게 된다.<br>\n그 때 Server는 리눅스 기준 5번까지 <code class=\"language-text\">SYN-ACK</code>요청을 다시 보내고 응답이 없으면 <code class=\"language-text\">Timeout</code>처리를 하게 된다.<br></p>\n<blockquote>\n<p>서버 소켓 설정에 따라 다르겠지만, Backlog Queue가 다 찬 경우, 새로운 Client의 연결 요청은 <a href=\"https://lwn.net/Articles/277146/\">SYN Cookie</a>형식으로 대체된다고 한다.</p>\n</blockquote>\n<blockquote>\n<p><a href=\"https://blog.cloudflare.com/ko-kr/syn-packet-handling-in-the-wild-ko-kr/\">여기</a>에서 <strong>SYN 패킷 처리 방법</strong>을 보는 것을 정말 추천한다. 설명이 너무 잘되어 있다.</p>\n</blockquote>\n<br>\n<h3 id=\"-client가-server에-연결되는-방법\" style=\"position:relative;\"><a href=\"#-client%EA%B0%80-server%EC%97%90-%EC%97%B0%EA%B2%B0%EB%90%98%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-label=\" client가 server에 연결되는 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🚪 Client가 Server에 연결되는 방법</h3>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 580px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXElEQVQoz22RXYvyMBCF/f+/yWvBXcELERSK1NTGmMZm0nw2STsvNi9LWfa5mIsDZ858bOYV0zTd7/fj8Xg4HHa7nbUWEadpQsSqqk6nU13X319ft9vtfD4DwGZagYhKKQDQWgNAjBERU0o555SS994YAwDDMKiFDa7IOQ/DYIzRWo/jWNc1IcQY03UdIaRtW8ZYt6CUklJumqa5XC7X65VSOo4jAAghiqeqKkKI1poucM4JIX3fCyGstZ9kxth+v99ut03TxBgBQCnV9721tm1bzrn3XgjBOX8vcM4ppc65z87rsWOMZeeu66y1nHMpZQjh/X5TSvu+996HEJRS/5N/HcwYE0KIMXrvy8HmeZZSPh6P5/NpjHHOSSmttZ/k9asQ0TlXzKUWHQCKWWvtvQeAP8zzPOec40JK6UcEgNfrxRhTSoUQpJTlnb/NJb/woxhjvPfOObtQWiDiP9jHN8IaogU2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"socket fd\"\n        title=\"socket fd\"\n        src=\"/static/2d414b8f97ac8bb28a325db179e6dba6/b6272/socket-fd.png\"\n        srcset=\"/static/2d414b8f97ac8bb28a325db179e6dba6/e9ff0/socket-fd.png 180w,\n/static/2d414b8f97ac8bb28a325db179e6dba6/f21e7/socket-fd.png 360w,\n/static/2d414b8f97ac8bb28a325db179e6dba6/b6272/socket-fd.png 580w\"\n        sizes=\"(max-width: 580px) 100vw, 580px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>[출처] <a href=\"https://luckyyowu.tistory.com/71\">https://luckyyowu.tistory.com/71</a></p>\n</blockquote>\n<br>\n<p>Client가 최초 <code class=\"language-text\">SYN</code> 요청을 보냈을 때, Server 커널에 Client 정보가 담긴 <code class=\"language-text\">Payload</code>가 들어온다.<br>\nServer는 Socket으로 Binding된 fd를 통해 <a href=\"https://man7.org/linux/man-pages/man2/poll.2.html\"><strong>poll()</strong></a>을 사용하여 지속적으로 커널을 읽어와, Client의 정보를 <code class=\"language-text\">Application Layer</code>로 불러와 <a href=\"https://man7.org/linux/man-pages/man2/accept.2.html\"><strong>accept()</strong></a>하는 과정을 거친다.<br></p>\n<blockquote>\n<p><a href=\"https://man7.org/linux/man-pages/man2/poll.2.html\"><strong>poll()</strong></a> 뿐 아니라, <a href=\"https://man7.org/linux/man-pages/man2/select.2.html\"><strong>select()</strong></a>, <a href=\"https://sjmulder.nl/dl/pdf/unsorted/2000%20-%20Lemon%20-%20Kqueue,%20A%20generic%20and%20scalable%20event%20notification%20facility.pdf\"><strong>kqueue()</strong></a> 등 여러 시스템 콜 함수도 있다.</p>\n</blockquote>\n<blockquote>\n<p>이 때, Server에서 Client로 <code class=\"language-text\">SYN-ACK</code> 요청이 가게 된다.</p>\n</blockquote>\n<br>\n<p><a href=\"https://man7.org/linux/man-pages/man2/accept.2.html\"><strong>accept()</strong></a>가 끝났다면, HTTP 통신을 위해 <code class=\"language-text\">Client Disconnected</code>가 될때 까지 Client의 정보를 커널에 저장한다.<br>\n이러한 <code class=\"language-text\">프로세스 커널</code>을 이용한 연결 수립 과정을 통해 Client - Server간 통신이 가능한 것이다.<br></p>\n<br>\n<h3 id=\"-http-packet-전송-방식\" style=\"position:relative;\"><a href=\"#-http-packet-%EC%A0%84%EC%86%A1-%EB%B0%A9%EC%8B%9D\" aria-label=\" http packet 전송 방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🌊 HTTP Packet 전송 방식</h3>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 556px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABZElEQVQoz2WQ22rjMBRF/f8/VPreQgvFDZSEkD6EOJFtWZdzdLNkyZaK7WHoMOtJD1qcvXeVUtJaK6Vut6a5NUqpcRxH52KM5T9yzqWU0/H0+vI6hama51kKiYhsGCilxhhAREApZPBh+593Lee8bJRSUkre+2qaphhjCKFru67rnHMgQXCOG2xgIYRcSoxRIUq5nrmcL89Pz5/1ZwWAU5i892xgw8AQ8fEgzVZBcMGFUEoZY/bYy7IAwKE+vL+9L8tSzWlOMfnRc86lBARomuZ6vT6auzHWWpPm9LcwGxil9Ph1rD/qUsoq77Fb0tKeWmNgAxG1WocM0/THZKxtWyHE+XQ+1Id/ZNr3lFLnHCIarRFRcLEW3gYrpcy/2Gercs7OWgCgG+uj71vSkgdRSu83QYIUEiSABK3Nvbl/X767tqtKKcGHcRyttc45Z+1qErK2oBRRWWv1FmRDWevYwAghnPMf4bX77+KB0QEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"packet\"\n        title=\"packet\"\n        src=\"/static/20df12f98462edc7057be39900dde99d/96638/packet.png\"\n        srcset=\"/static/20df12f98462edc7057be39900dde99d/e9ff0/packet.png 180w,\n/static/20df12f98462edc7057be39900dde99d/f21e7/packet.png 360w,\n/static/20df12f98462edc7057be39900dde99d/96638/packet.png 556w\"\n        sizes=\"(max-width: 556px) 100vw, 556px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>[출처] (<a href=\"https://d2.naver.com/helloworld/47667\">https://d2.naver.com/helloworld/47667</a>)</p>\n</blockquote>\n<br>\n<p>우선 NIC가 들어온 패킷을 자신의 메모리에 기록하고, CRC검사로 패킷이 유효한지 확인한 뒤 호스트의 메모리 버퍼로 이동시킨다.<br>\n이 버퍼는 드라이버가 커널에 요청하여 <code class=\"language-text\">패킷 수신용으로 미리 할당한 메모리</code>이고, 할당을 받은 후 드라이버는 NIC에 메모리 주소와 크기를 알려 준다.<br></p>\n<blockquote>\n<p>NIC가 패킷을 받았는데, 드라이버가 미리 할당해 놓은 호스트 메모리 버퍼가 없으면 NIC가 패킷을 버릴 수 있다 (packet drop).</p>\n</blockquote>\n<br>\n<p>그 뒤 제조사 별 정의된 Driver 통신 규약에 따라 상위 Layer로 패킷을 전송하고, Ethernet에선 헤더를 제거한 패킷을 상위 Layer로 전달한다.<br></p>\n<br>\n<p>IP Layer에선 목적 ip에 대한 라우팅을 진행한다.<br></p>\n<blockquote>\n<p>ip가 현재 장비인지 다른 장비인지 확인한다.</p>\n</blockquote>\n<br>\n<p><code class=\"language-text\">IP, TCP Layer</code>를 통과했다면, 패킷은 목적 Port와 매핑된 프로세스의 커널에 저장될 것이다.<br>\n이때 Server 프로세스에서 커널 버퍼를 읽는 과정을 진행하고, <code class=\"language-text\">Application Layer</code>로 데이터를 전송한다.<br></p>\n<br>\n<p>이제 Server에서 HTTP에 정의된 내용으로 header와 body를 읽어 그에 맞는 <code class=\"language-text\">Business Logic</code>이 실행된 뒤 적절한 응답이 내려간다.<br></p>\n<blockquote>\n<p>HTTP에 대한 내용은 <a href=\"https://www.rfc-editor.org/rfc/rfc7230\">RFC-7230</a> 문서를 보면 잘 설명 되어있다.</p>\n</blockquote>\n<br>\n<h2 id=\"-web-socket\" style=\"position:relative;\"><a href=\"#-web-socket\" aria-label=\" web socket permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🔵 Web Socket</h2>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 667px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB7UlEQVQoz31Sy4rUQBSdb3Il4kb8Bpf+gyv/wo0rQRd+gIsRFUTRjTDgYgbGTotNJ+nKs/PoPKZTk2fVPVIV0g9bPXC5oVJ17rn33DMigsKfuW1bJEmCLMtQFAXKstSR5zm22+3u7hQKadng7JBESpXHb/VoPp/DNE0djuPAsiwsFgs4josR4/0jwpEE+Pmrx5OnBb5ddIoaeT6qaZoGwzDo2IMgBCHdAFFCmDg0ofqhcP6uxp37CZ4932CzcbFaObBtW6u8vv6By6srGIaB2WwG07TgBwOCoECScoRrcarw4nuLR48zvDnfQgoOzmvUda0VStmibTnSVBVLEcUFPH8AYzEct0S4lv+b4SlMS8Bx5dFZ1xEqDvBbHLd8SKbaV3lyTkqpw2YDrNWwM0AS/duUQ4UTpoq+72tXLWsB217qGUZRdLIRf1W4ySTevq/h+eOAq4rrHez7HsMg0PeD3k0hBKb6bQtUfE88uaxPPn1p6N7DhF6+LonzlBhziTFGy+WSDMMg27YpiiIKgoDCMKC8EOT5LYXrnsqbUW5aNrRbmw8fG9x9kODFqxuAbrXLXdchjmO92IwxhGEIz3PhBymYo1z2EK4zuL48almzZ7mkz18bCkJVgUgISXI/qKNQnmW5oDiRFMWSKr5X+Bv8yJFJKvmfngAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Web Socket Connection\"\n        title=\"Web Socket Connection\"\n        src=\"/static/ba8111600808bf14d569f627ad8b34da/295bd/web-socket.png\"\n        srcset=\"/static/ba8111600808bf14d569f627ad8b34da/e9ff0/web-socket.png 180w,\n/static/ba8111600808bf14d569f627ad8b34da/f21e7/web-socket.png 360w,\n/static/ba8111600808bf14d569f627ad8b34da/295bd/web-socket.png 667w\"\n        sizes=\"(max-width: 667px) 100vw, 667px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>[출처] <a href=\"https://geekflare.com/websocket-servers\">https://geekflare.com/websocket-servers</a></p>\n</blockquote>\n<br>\n<p>Web Socket은 위 TCP 접속에 <a href=\"https://ko.wikipedia.org/wiki/%EC%9D%B4%EC%A4%91%ED%86%B5%EC%8B%A0\">전이중 통신</a>을 지원하는 통신 프로토콜이다.<br></p>\n<br>\n<p>Web Socket은 <code class=\"language-text\">HTTP 통신과 같은 반이중 방식</code>보다 오버헤드가 낮은 웹 브라우저와 웹 서버 간의 상호 작용을 가능하게 하여 서버에서 <code class=\"language-text\">실시간 데이터 전송</code>을 용이하게 한다.<br></p>\n<p>이것은 Client와 Server간에 연결 수립을 하지 않고 <code class=\"language-text\">Payload만 전송</code>할 수 있다는 것을 의미한다.<br></p>\n<p>HTTP에서 억지로 양방향 통신을 구현한 것이고, <code class=\"language-text\">Observer</code> 패턴과 비슷하다고 볼 수 있지만, 서로 <code class=\"language-text\">Request</code>를 계속 보내는 형식이다.<br></p>\n<br>\n<h3 id=\"-web-socket-연결-수립-과정\" style=\"position:relative;\"><a href=\"#-web-socket-%EC%97%B0%EA%B2%B0-%EC%88%98%EB%A6%BD-%EA%B3%BC%EC%A0%95\" aria-label=\" web socket 연결 수립 과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🤝 Web Socket 연결 수립 과정</h3>\n<br>\n<blockquote>\n<p>Client Handshake Request</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">GET /change/protocol HTTP/1.1\n\nHost: server.example.com\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==\nOrigin: http://example.com\nSec-WebSocket-Protocol: chat, superchat\nSec-WebSocket-Version: 13</code></pre></div>\n<br>\n<blockquote>\n<p>Server Handshake Response</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">HTTP/1.1 101 Switching Protocols\n\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=\nSec-WebSocket-Protocol: chat</code></pre></div>\n<br>\n<p>우선 HTTP 연결이 우선이 되어야 하고, Client에서 Server에 Web Socket으로 프로토콜을 변경한다는 요청을 보낸다.<br></p>\n<p>그 뒤 Server에서 Client로 프로토콜이 변경됐다는 응답을 보낸다.<br></p>\n<p>이제, 각 프로세스에서 HTTP가 아닌, WS 프로토콜로 통신을 하게 되는 것이다.<br></p>\n<br>\n<h3 id=\"-web-socket-데이터-전송-방식\" style=\"position:relative;\"><a href=\"#-web-socket-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%84%EC%86%A1-%EB%B0%A9%EC%8B%9D\" aria-label=\" web socket 데이터 전송 방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💿 Web Socket 데이터 전송 방식</h3>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAByklEQVQoz42S3W/SUBjG+xfvgoREsitDNCa7EOMiIi6KWZRy4QWKBiSK7GIugjANzItFmEChtqWWj5bTFn6mJSNLhtE3efLkPe/HeU7OI7ElVqvVhm3HYW7bIYew13y152pIwcFyuQwL26AqA5SfF6iDPqN+L8SvoYLv+2yblfhHnOsW7ZFJezTmTDU5Heh8Gxp/7Zcsa0Kn00HTNDRNxzCMEKqqIsSC5KcW8fJnEtVmiL1Kg9vv69gLQb/Xoz8YbPpDhcpwSKvdRlEURiM1LJqmSbfbxRyPKdR+IH9sU/l6Qfm0y9uTc0pfumjGmMfpNLlcjnq9Tj6fRwiBNJ/P2f4xIFzBh4M3HN5IU3pUoPKshHwzQyHxEkM3SCaTZDIZisUisiyvF06nUzzPu7bQ9z3shYtxvI+S30E/uod2nEIt7mJU7/B7rPMwlULOZmk2m6FC13WRJpMpgcogCW64hG3biIXgwbsX7Dy5xd3XT0mXc+xmE+y9OkDTNaLRKJFIhFgsRjweXy8M1AXDjuNsEHjNsZ3QGoe1M5JHTTInLZ7XvrNfbXC/2sD1/VBI8ELLspjNZv9nm+nCZS48bNcLeSY8LEdcM/Slbf4AgELdyHV2PtEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"web socket data transfer\"\n        title=\"web socket data transfer\"\n        src=\"/static/8f1ebf043442c60fded1226daa8477e9/37523/Websocket-Channel-Diagram.png\"\n        srcset=\"/static/8f1ebf043442c60fded1226daa8477e9/e9ff0/Websocket-Channel-Diagram.png 180w,\n/static/8f1ebf043442c60fded1226daa8477e9/f21e7/Websocket-Channel-Diagram.png 360w,\n/static/8f1ebf043442c60fded1226daa8477e9/37523/Websocket-Channel-Diagram.png 720w,\n/static/8f1ebf043442c60fded1226daa8477e9/ae694/Websocket-Channel-Diagram.png 850w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<p>Web Socket은 데이터를 <code class=\"language-text\">Frame</code>으로 구성하고, 데이터를 보내기 위해 여러 종류의 Frame을 정의해놨다.<br></p>\n<ul>\n<li><code class=\"language-text\">Text frame</code>: 서로에게 보내는 텍스트 데이터이다.</li>\n<li><code class=\"language-text\">Binary data frame</code>: 서로에게 보내는 바이너리 데이터이다.</li>\n<li><code class=\"language-text\">ping/pong frame</code>: 서버에서 전송된 연결을 확인하는데 사용되며, 브라우저는 이에 자동으로 응답한다.</li>\n<li><code class=\"language-text\">connect/close frame</code>: 연결/종료에 대한 프레임 데이터이다.</li>\n</ul>\n<br>\n<blockquote>\n<p>Web Socket의 경우 <code class=\"language-text\">Frame</code>을 받는 버퍼가 다 찬 경우와 건너편 소켓이 <code class=\"language-text\">Close</code> 상태인 경우 소켓이 닫히게 된다.</p>\n</blockquote>\n<br>\n<h2 id=\"-참고-자료\" style=\"position:relative;\"><a href=\"#-%EC%B0%B8%EA%B3%A0-%EC%9E%90%EB%A3%8C\" aria-label=\" 참고 자료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📚 참고 자료</h2>\n<br>\n<blockquote>\n<p>Network Socket</p>\n</blockquote>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Network_socket\">https://en.wikipedia.org/wiki/Network_socket</a></li>\n</ul>\n<blockquote>\n<p>HTTP 개요</p>\n</blockquote>\n<ul>\n<li><a href=\"https://developer.mozilla.org/ko/docs/Web/HTTP/Overview\">https://developer.mozilla.org/ko/docs/Web/HTTP/Overview</a></li>\n</ul>\n<blockquote>\n<p>TCP/IP 네트워크 스택 이해하기</p>\n</blockquote>\n<ul>\n<li><a href=\"https://d2.naver.com/helloworld/47667\">https://d2.naver.com/helloworld/47667</a></li>\n</ul>\n<blockquote>\n<p>SYN 패킷 처리</p>\n</blockquote>\n<ul>\n<li><a href=\"https://blog.cloudflare.com/ko-kr/syn-packet-handling-in-the-wild-ko-kr/\">https://blog.cloudflare.com/ko-kr/syn-packet-handling-in-the-wild-ko-kr/</a></li>\n</ul>\n<blockquote>\n<p>A Simple Explanation Of What A WebSocket Is</p>\n</blockquote>\n<ul>\n<li><a href=\"https://www.wallarm.com/what/a-simple-explanation-of-what-a-websocket-is\">https://www.wallarm.com/what/a-simple-explanation-of-what-a-websocket-is</a></li>\n</ul>\n<br>\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-%EC%86%8C%EC%BC%93-%EC%9D%B4%EB%9E%80\">💡 소켓 이란?</a></p>\n<ul>\n<li><a href=\"#-%EB%84%A4%ED%81%AC%EC%9B%8C%ED%81%AC-%EC%86%8C%EC%BC%93\">🌐 네크워크 소켓</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-http-socket\">🟡 HTTP Socket</a></p>\n<ul>\n<li><a href=\"#-socket-connection\">🔌 Socket Connection</a></li>\n<li><a href=\"#%EF%B8%8F-client%EA%B0%80-syn%EB%A7%8C-%EB%B3%B4%EB%82%B4%EA%B3%A0-%EB%81%9D%EB%82%B4%EB%A9%B4-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%90%98%EC%A7%80\">❗️ Client가 SYN만 보내고 끝내면 어떻게 되지?</a></li>\n<li><a href=\"#-client%EA%B0%80-server%EC%97%90-%EC%97%B0%EA%B2%B0%EB%90%98%EB%8A%94-%EB%B0%A9%EB%B2%95\">🚪 Client가 Server에 연결되는 방법</a></li>\n<li><a href=\"#-http-packet-%EC%A0%84%EC%86%A1-%EB%B0%A9%EC%8B%9D\">🌊 HTTP Packet 전송 방식</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-web-socket\">🔵 Web Socket</a></p>\n<ul>\n<li><a href=\"#-web-socket-%EC%97%B0%EA%B2%B0-%EC%88%98%EB%A6%BD-%EA%B3%BC%EC%A0%95\">🤝 Web Socket 연결 수립 과정</a></li>\n<li><a href=\"#-web-socket-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%84%EC%86%A1-%EB%B0%A9%EC%8B%9D\">💿 Web Socket 데이터 전송 방식</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EC%B0%B8%EA%B3%A0-%EC%9E%90%EB%A3%8C\">📚 참고 자료</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"July 30, 2022","title":"Socket이란 무엇인가 (Http Socket, Web Socket)","categories":"네트워크","author":"seongsu","emoji":"1️⃣2️⃣"},"fields":{"slug":"/skill/socket/"}},"prev":{"id":"75c4e40a-e9f0-5a39-af16-92fffe954ad8","html":"<h2 id=\"-session-이란\" style=\"position:relative;\"><a href=\"#-session-%EC%9D%B4%EB%9E%80\" aria-label=\" session 이란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🌊 Session 이란?</h2>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">반영구적이고 상호작용적인 정보 교환을 전제하는 둘 이상의 통신 장치나 컴퓨터와 사용자 간의 대화나\n송수신 연결상태를 의미하는 보안적인 다이얼로그(dialogue) 및 시간대를 가리킨다.\n따라서 세션은 연결상태를 유지하는 것보다 연결상태의 안정성을 더 중요시 하게 된다.</code></pre></div>\n<blockquote>\n<p>[출처] <a href=\"https://en.wikipedia.org/wiki/Session_(computer_science)\">Wikipedia</a></p>\n</blockquote>\n<br>\n<p>쉽게 설명하자면 웹에선 <code class=\"language-text\">Client</code>가 사이트에 접속해 어느 위치에 있는지, 어떤 상호작용을 했는지 등 <code class=\"language-text\">Client</code>의 정보를 서버에 저장해 <code class=\"language-text\">Stateful</code>한 상태를 유지하는 개념이다.<br>\n세션을 쿠키와 굉장히 헷갈려 하는데, 일단 쿠키는 <code class=\"language-text\">Client side</code>에서 관리되고, 세션은 <code class=\"language-text\">Server side</code>에서 관리된다.<br></p>\n<br>\n<p>세션은 쿠키처럼 가시적인 부분에 있는 것이 아니라 이해하기 힘든데, 서버에 파일, 메모리, DB등 어디에든 저장되어 <code class=\"language-text\">Client</code>의 상태 관리를 하는 개념이다.<br>\n추상적인 개념이지만, 사용자가 사이트에 접속해 나가기 전 까지 서비스에 따라 사용자의 데이터를 서버에서 관리하는 것이다.<br></p>\n<br>\n<h2 id=\"-session을-유지시키는-방법\" style=\"position:relative;\"><a href=\"#-session%EC%9D%84-%EC%9C%A0%EC%A7%80%EC%8B%9C%ED%82%A4%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-label=\" session을 유지시키는 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🤝 Session을 유지시키는 방법</h2>\n<br>\n<p>프레임워크 내부 <code class=\"language-text\">세션 라이브러리</code>를 사용하는 방법이 제일 편하고, 사용하기 쉽지만, 이번엔 다른 방법으로 세션을 구현해 보려 한다.<br></p>\n<br>\n<h3 id=\"-세션을-구현하기-위한-다양한-방법\" style=\"position:relative;\"><a href=\"#-%EC%84%B8%EC%85%98%EC%9D%84-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0-%EC%9C%84%ED%95%9C-%EB%8B%A4%EC%96%91%ED%95%9C-%EB%B0%A9%EB%B2%95\" aria-label=\" 세션을 구현하기 위한 다양한 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💾 세션을 구현하기 위한 다양한 방법</h3>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACKklEQVQoz1WT62sTURDF888LfhGrlKKIiIIPKLRV1A9WsPWRllY0tYlF27R5NJu7u9m77+fdzU/uDY3th9kZuMOZM+fMtqqqQilFrZTJTa2I05xL22fi+FhuQFkuenTv9eicTtjt9Nn52afdHZi+lm4sq4osL0iynHlT0zmzWNncN3F/a5+JG1DX9TJgjhskvNw55vH2EY8+dHj6sWMwWhpAs7iz/oVbL3boDR3iJMGVkiCKEY5DkGQ4fsLppUtvYPNn5DJ0Ii5sDyfOmKUlTpQa1i29ql7xV3/MX2uGJRPiOMYWgiAIsCyLSinavSEP3h3yZPuItbcHDGwfx53hzjycmYewHapK0aJpmHoh9za+cfvVLicjB1VVJElCnuekaUpeVoxtj+7FhJEXcy48w9h1XQLfN4O92ew/Q1tG7PX6dC4EIzdcmFTXJhujmoavxwPube6x+uaAuxtto6EGDMPQAOraAOZ5wfPtH6xt7bGy/pmzS5d50yyd1GyLUjFxPPoTgZ9XCD9CRilTIZBSmhBCmOEt7XDfchjLmIHrM5Wx0UKp6yeiGNuSw98Dvp8M2e9eECaZkSPLMiONzoah/oymNkKGTD2fKMlu3JweOJ/rlc9Zfd3m2acuD98fIrzISKF7542WaCGPAZSeRxSG+FJSFsUS8CprndM8x49TMlWTFBVZUZr3oqyQUbkkYAD1hS+ivAF0vb76m67qhXH65EqOBylukBMmJf8AJew4ynevXGEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"diagram\"\n        title=\"diagram\"\n        src=\"/static/99143014b8d47b2d54c4c9a1ed2973f4/37523/diagram.png\"\n        srcset=\"/static/99143014b8d47b2d54c4c9a1ed2973f4/e9ff0/diagram.png 180w,\n/static/99143014b8d47b2d54c4c9a1ed2973f4/f21e7/diagram.png 360w,\n/static/99143014b8d47b2d54c4c9a1ed2973f4/37523/diagram.png 720w,\n/static/99143014b8d47b2d54c4c9a1ed2973f4/302a4/diagram.png 1080w,\n/static/99143014b8d47b2d54c4c9a1ed2973f4/35252/diagram.png 1204w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>위와 같은 게임 데이터가 있다고 가정을 해보고 세션 설계를 진행해 보자.<br>\n일단 <code class=\"language-text\">Third-party DB</code>를 사용하는 방법, <code class=\"language-text\">서버 힙 메모리</code>를 이용하는 방법이 있다.<br></p>\n<br>\n<p>서비스 요구사항에 다르겠지만, 영속성이 보장되어야 하는 서비스의 경우 <code class=\"language-text\">Third-party DB</code>를 사용하면 좋을 것 같고, 그 중 <code class=\"language-text\">Update</code>가 빈번히 일어나는 설계가 된다면 <code class=\"language-text\">RDB</code>를 이용해 구현하면 좋을 것 같다.<br>\n이외의 상황이라면 <code class=\"language-text\">In-memory DB</code> 또는 <code class=\"language-text\">Disk-based DB</code>의 <code class=\"language-text\">noSQL</code>을 사용할 것 같다.</p>\n<blockquote>\n<p>noSQL은 데이터의 구조가 클 때, <code class=\"language-text\">Update</code>가 빈번히 일어나면 성능상 좋지 않다.</p>\n</blockquote>\n<br>\n<p>만약 영속성 보장이 필요없는 서비스거나, 빠른 개발을 목적으로 한다면 <code class=\"language-text\">서버 힙 메모리</code>에서 세션을 관리하면 좋을 듯 하다.<br></p>\n<br>\n<h2 id=\"-메모리로-세션을-유지하는-방법\" style=\"position:relative;\"><a href=\"#-%EB%A9%94%EB%AA%A8%EB%A6%AC%EB%A1%9C-%EC%84%B8%EC%85%98%EC%9D%84-%EC%9C%A0%EC%A7%80%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-label=\" 메모리로 세션을 유지하는 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📱 메모리로 세션을 유지하는 방법</h2>\n<br>\n<p><code class=\"language-text\">JavaScript</code>의 자료구조를 적절히 이용하여 세션을 유지해보자.<br>\n자료구조와, <code class=\"language-text\">JavaScript</code>의 Argument 전달 전략을 적절히 섞으면, 메모리 유실 없이 <code class=\"language-text\">Client</code>의 세션을 유지시킬 수 있다. 이 때, <a href=\"https://en.wikipedia.org/wiki/Evaluation_strategy\">평가 전략</a>인 Call by sharing을 이용하고, <a href=\"https://en.wikipedia.org/wiki/Hash_table\">Hash Table</a>을 사용하는 자료구조인 <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Equality_comparisons_and_sameness#same-value-zero_equality\">Map</a>을 사용할 예정이다.<br></p>\n<br>\n<h3 id=\"-call-by-sharing-이란\" style=\"position:relative;\"><a href=\"#-call-by-sharing-%EC%9D%B4%EB%9E%80\" aria-label=\" call by sharing 이란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📞 Call by sharing 이란?</h3>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB/UlEQVQoz3VSia6iUAzl/z/KUcfEgScOKgqIC3JZBNlEwQXwvLRvfMlMMk2ahh56255Tqb7dcK0qbDYb2LYNIQTu9zvK8oKqrpEXBUzTZNwwTBRFgev1ylh4PMKyLJimBdcVqOsa0ukYIfR8OHsH2+0Wu+0OZVni+XyiyHLGKE++XttIkgRt2yJLEgTCw26342aO46CqKkibuQ5L1aBNp5AVGbquw3Vd3O53BPsD9LEC7beG6XQKRVE40nQHy8bqQ8VkMoEsyzAMg4eQXCHghyGatkXTNOi6Dm+LkxP2B4dXoXzTtBxfrxeCMITjHhBFEQ8QhiFPLgnXReb6SAWtvefViBfiKo9iJHvBdKxtm/NxHDOHfhAgdgQS8UUJ5W+3G6ThYICf/QEmygfG4zGPPxqNkOc5LNPE8Eef85qmfXN5Ppf8Pez3QfW9Xg+r1QqXywUSker7Pqq64gQ5TUBO4pSXC0fqThzRBRAFi8UCv2QZK8NgYagRrS9RIT2SJinSNGUV6YHH48GRVs+yDKfTif18PjOWJCmOxyOyNGN1yektiSSfz+cIguC7mAAyKpjNZswPNSMa3pjneZioKrT5nNdXVZXPRyJlaZV/jZT8H0a2XC6hyDIc3YC1WOLgutxUev/QdS8+ifdZvOMX1v3llI7iGJ7w0D6ewJ//yD4Bp5EyPFX4jCwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"call by ..\"\n        title=\"call by ..\"\n        src=\"/static/7ca7d8abb85e50cc1b302eafa47efcee/37523/call_by.png\"\n        srcset=\"/static/7ca7d8abb85e50cc1b302eafa47efcee/e9ff0/call_by.png 180w,\n/static/7ca7d8abb85e50cc1b302eafa47efcee/f21e7/call_by.png 360w,\n/static/7ca7d8abb85e50cc1b302eafa47efcee/37523/call_by.png 720w,\n/static/7ca7d8abb85e50cc1b302eafa47efcee/302a4/call_by.png 1080w,\n/static/7ca7d8abb85e50cc1b302eafa47efcee/b1584/call_by.png 1342w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>[출처] <a href=\"https://www.educative.io/answers/what-is-call-by-sharing\">What is call by sharing?</a></p>\n</blockquote>\n<br>\n<p>자료구조를 알아보기 앞서, JavaScript의 특별한 매개변수 전달 전략에 대해 설명하려 한다.<br>\nCall by sharing이란, <code class=\"language-text\">Strict binding strategies</code>에 속해있는 Call by value와 Call by reference를 섞은<code class=\"language-text\">평가 전략</code>이라고 한다.<br>\n전달되는 인자 자체는 <code class=\"language-text\">Call by value</code>로 작동하지만, 인자 내부의 값은 <code class=\"language-text\">Call by reference</code>로 작동한다. 즉 전달되는 인자는 <code class=\"language-text\">복사</code>되어 전달되지만 인자가 가르키는 객체 내부의 주소는 공유가 되는 형식이다.<br></p>\n<br>\n<p>이러한 <code class=\"language-text\">얕은 복사</code>가 일어나는 것을 명심해서 코드를 작성해야 하고, <code class=\"language-text\">깊은 복사</code>를 원한다면, 클래스의 복사생성 전략을 사용하던지, 메모리를 새로 할당해서 직접 저장하는 방식을 택해야 한다.<br></p>\n<br>\n<h3 id=\"-map-자료구조\" style=\"position:relative;\"><a href=\"#-map-%EC%9E%90%EB%A3%8C%EA%B5%AC%EC%A1%B0\" aria-label=\" map 자료구조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🗺 Map 자료구조</h3>\n<br>\n<p><code class=\"language-text\">JavaScript</code>의 Map 자료구조는 <code class=\"language-text\">Hash Table</code> 알고리즘으로 구현되어 있다.<br>\n간략히 설명해보면, key를 구현된 <code class=\"language-text\">Hash Function</code>으로 해싱을 하고, 인덱스로 활용하는 방식이다.<br>\n해싱을 진행할 때 알고리즘이 제일 중요시 되며, Result가 중복되는 Index일 수 있어, <code class=\"language-text\">Collision</code>에 대해서도 잘 대응을 해야한다.<br></p>\n<br>\n<p>해싱 알고리즘에 따라 다르지만 key 해싱이 된 후엔 평균 O(1)의 시간 복잡도를 가진다.<br></p>\n<blockquote>\n<p>해싱된 Index에 Value를 넣기만 하면 돼서 최선의 경우 O(1)이지만, 해싱된 Index의 충돌 등 최악의 경우 O(N)까지 복잡도가 커진다.</p>\n</blockquote>\n<br>\n<h3 id=\"-hash-table의-collision-관리\" style=\"position:relative;\"><a href=\"#-hash-table%EC%9D%98-collision-%EA%B4%80%EB%A6%AC\" aria-label=\" hash table의 collision 관리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🤔 Hash Table의 Collision 관리</h3>\n<br>\n<p><code class=\"language-text\">Collision</code>을 해결하기 위한 여러 전략이 있는데 이 중 <code class=\"language-text\">Separate chaining</code>과 <code class=\"language-text\">Open Addressing</code>의 <code class=\"language-text\">Linear probing</code>에 대해서만 간단히 설명하겠다.<br></p>\n<br>\n<blockquote>\n<p>Separate chaining (분리 연결법)</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEAElEQVQ4y11UbUxbVRh+oLS04nRlMFAwDqbRqASzuKBmMWM6F7JFqQQCBUNVMuq6xI1Mevt528stFASlE5aIgFPWTaJksxspZMtW+kEZUGjZdZRGCrXAEFjCh/uMyzXXj/3YSU7Omyfved6T93neAzyyhELhw5hl2YexQCBAviEfSpfy0Sso/KIQ5hkzdD7df0h8/Bbw+SnIyuIlAOABiEPc//mbACTy+YLE7HezUWAu4LAYAFsBpANIyCnNQetGK/KIPAAVFVzCUwBeBBALuQLJaekxHGv3xdZdOlOV4lClohxAEpeYX5OP7PeyBaInRc/F8mJfBpDK4XsO74n5t/6dO/FgWQFYlse7e1fEncfqzdicHhffYwvYzw4MrZwc6zwHIFnv09vqput8hgmDxzBhcDZEGgbMYbNbN6rzaEe0jClkagTW15swM+PH7KwD8/P+pI0/9/7TuacT0850M26r3c02XW7wctDBHw4+K+uUZRY1FmVITJLMEktJpqxDllncXJwh/Vq6XdYhSwE2NnYgGs1DKPQOlpf3vdDbm0EA4hQAvhn7Pqe/t8JmO/8BAP7RvqOk8ZrxhHZYa1F71ccphjpuZIzH9eP6Zs2w5lsjY6wEbt9WYXbWhlDoFG7csGFtdRcLxHGvdE6NVFwac9T29P0s53ola5cdMU2ZPiXHSbl+XC83hUxyOkjLST9ZSfrJz0xTpjzg/v08rKwosLT0CW7dOgyW3caRrSRuSp9UKAYdjSq21vvlIGchWYes1DBheJ8MkPtJP3mA2xRDHdCP6fdrhjUSiqF2Ag8efIxw2AKGMWFpqRlz8zvDQMIbicLnT1dfvNTW0r1eNXjEzhFSDNWoH9P/pHQrTxFuwqod0Vqp65SVcBNdSpfyHB2kjwGrq2WIROoQieiwsFC7zed77SMgGa+/Krjy6+R3fWNDjLW/qxuASKKRJMk6ZeICc4FY2iIVl7eXi0ssJeLS1lJx2YmyLRJa8jinchEiERLR6OeYmyMTotFXYoHNnKrBxR8z+h0dO063db/E3xqXqvaqB8wz5im1V31N7VVzNmHoIM1ormoCmmHN73SQbuV8KEcw2IbR0SYsLn6DP5ZyOEWxPe0JuyNw1uZyLZx0dv7SYv8KPWyPoLi5WGQOm4V0kBZKW6TC8vZyIeknhbW/1YpKLCUCTpS3sLxchoWFQqytfchj2WdiuRkWC1K7rJPe7y942CZP/QDnTO2w9kz9bP1l7Yi2j/AQ/XXTdf0112v6NVc1dpVX5aEnaQq4dw+YnwfCYeDmTe5HAP5igccSMDo9dMgVcFjOX7lQxY0l4STepBjqbdWgane1szrXEDDk6ny6XMJD7Fa6lHt1o7qsvwExk9YuECz3eAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"separate_chaining\"\n        title=\"separate_chaining\"\n        src=\"/static/f818db27035ddf89cfe8e624d936c277/37523/separate_chaining.png\"\n        srcset=\"/static/f818db27035ddf89cfe8e624d936c277/e9ff0/separate_chaining.png 180w,\n/static/f818db27035ddf89cfe8e624d936c277/f21e7/separate_chaining.png 360w,\n/static/f818db27035ddf89cfe8e624d936c277/37523/separate_chaining.png 720w,\n/static/f818db27035ddf89cfe8e624d936c277/1cfc2/separate_chaining.png 900w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>동일 해싱 Index인 경우 해당 인덱스에 <code class=\"language-text\">Linked list</code> 형식으로 나열하는 충돌 관리 기법이다.<br>\nbucket에 해당 key의 <code class=\"language-text\">해싱된 Index</code>가 보장될 수 있지만, 동일 인덱스 데이터가 많아질 경우 특정 데이터를 찾을 때 성능을 보장할 수 없다.<br></p>\n<br>\n<blockquote>\n<p>Linear probing (선형 탐색법) | Open Addressing (개방 주소법)</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 86.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEqklEQVQ4y3WUbUxTVxjH/8CyZW9G59S9ufiaOTEMX7ZlH/Zhk/jBD4v7aOacmiUzZsk+OM3ckBUcRiiIQicbIqTY0gpu0QEKtJTSW25pbW+5F9pe2nvbS7tOQVFAC8wCz3JxLn7ZSf55nnNynl+e55zzHOB/hjgiwuazwe63ZzS3N2f1hfoyxREx69bftzKJCE8og4/zWdKYpO7JeBy/DMCHAN56vEB0B0d+/DojOuFDa68BwSiH4UR8AQJgPYC3AWwFsNTBOpCmNEKh0EIkcOjQ01i/fjGys1+EJGWumZrCleafM6vqyjB0u/8DO39d6+KZQn5I0AeigQt9fJ/Z4XZc6ujuaPIGvMaQEqrhw3yTzWn75BHQbgfMZqCxERAErJqZUTPJVFOpaeg5ajIHx02eTrlBqqeLooEuihfJpJjIKBvJEDaQPqhfUK1QWwzMzW1HLPYLZFkLUSxHMlmxJJXKJkA9j+dqjT1HjWbhfpPXqhilBmocMpEhZCBz1EzGiJFMERMZRSMZRAPVCXUngYcPVWA1kslSKEo5bt8+vSEczi0AXhLOFUC+eWOzw996zMX3fMMF/WVciNMKEaHEF/Cd6vX2nlJ9LsSV+EV/laXHkqeWnIPx8YNIJr+AJO1HKrUfHs+6WmCZTatBL8282Tka2Wkb9O5w9jn2dDG2z50e52eMm9lttVt3q761x7rH6XHuu9p2dRMwP/8pksl2yLIZkUgzxsZ+x8zMNgIytcBTA5fqDvc2nJ/uZn9LtMntZIl2UofcQe1SO7UNtZElaiGLYlmYX+6/fErNcBUmJnYiHt+OZDIPqdQOEC1VH4cNWBHL2XAsvHL1X826vQNHwhoqDBQ8zBfy05ohTfpE9ET6+OBxVdP5Qj4VhguPq8C9GBsLIBJhIEksJifdiMc/JuB5D7DYu2vfYedH+0aN5vzB/FgRFQU0aU1QM1scLZ4tSZbMFoWLZgvFwhlNSEMnYycLgKmpFRgbexeTk7kYGdmMdDp3bX39cn3ms2uL3YTGjtTBX+uTDy74rLIucoYqfGeogqugGqWGquVqOiucpapAFVUOVFJloPInYHb2ACRJRiTiQTDIQVH6X1WUvH7gZbo7gEDCv8vu6+zoHWCafTI3KAwLHD/M+32Sz88Osn4hLvh5hb/ByZxi9Vi/UktejqmpLXjwIAdE76ja6XYv+RZYrrZZ/5Bt0R+OxnVX2i+vbTQ3btFV697XG/RbTU2mXL1Bn9tgaNiqO6d7z9xk3lZdU/2KCvwSyWQCHOdHf/8A7t0LrhwdzVNvWQXeGBrc2+Fk5O4Bxs0qvdPuhHvcnXBPsDF2olvsnvD86ZlwJ9x32BhL13zXvlOBL4DoDRC9tqC5uddB9My/f8SSktPd39dWKzfPe66LZ+QyKvVpqZQrJV1MR5VSJZXxZaTltfMlvhIqD5YXPurlJzU/v2CtYjDL4naBHeQPXHMww12Cw+eMMXOuuGvKFXdNO6PO6a5Q13Rfom/aFXfdd0ad1Opt/eExKOM/zc+rFqPhFtyhECJ3PYuUlHc1y9nX9Ngdm1wudiPLstkMw2RbrdZsl8uVzbLsRoZhclpaWpb9A1M0KH+zDnNBAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"linear_probing\"\n        title=\"linear_probing\"\n        src=\"/static/1d1cc25fcb9acca58e138d55ed410977/37523/linear_probing.png\"\n        srcset=\"/static/1d1cc25fcb9acca58e138d55ed410977/e9ff0/linear_probing.png 180w,\n/static/1d1cc25fcb9acca58e138d55ed410977/f21e7/linear_probing.png 360w,\n/static/1d1cc25fcb9acca58e138d55ed410977/37523/linear_probing.png 720w,\n/static/1d1cc25fcb9acca58e138d55ed410977/3c051/linear_probing.png 760w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>동일 해시 인덱스 삽입 시 <code class=\"language-text\">bucket의 다음 인덱스</code>에 데이터를 삽입하는 방법이다.<br>\n하지만 <code class=\"language-text\">Primary clustering에 취약</code>하다는 단점이 있다. 이 기법 역시 데이터가 많아진다면 복잡도가 높아질 수 있다.<br></p>\n<br>\n<p>위와 같이 <code class=\"language-text\">Chaining</code>과 <code class=\"language-text\">Open Address</code>기법을 이용한 <code class=\"language-text\">Hash table collision</code> 해결에 대해 알아보았다.<br>\nNode.js의 충돌 해결 기법은 위 방식에서 어떤 방식을 사용하는지 소스코드를 뜯어봐도 찾기 힘들었지만, JavaScript의 Map 자료구조가 어떤 식으로 생겼는지 알아본 계기로만 하고, 본론으로 돌아와서, 메모리에 <code class=\"language-text\">Session</code>을 구현해보자.<br></p>\n<br>\n<h2 id=\"-session-구현\" style=\"position:relative;\"><a href=\"#-session-%EA%B5%AC%ED%98%84\" aria-label=\" session 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🧑‍💻 Session 구현</h2>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">BaseSessionStore<span class=\"token operator\">&lt;</span><span class=\"token constant\">T1</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">T2</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">protected</span> store <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map<span class=\"token operator\">&lt;</span><span class=\"token constant\">T1</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">T2</span><span class=\"token operator\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token operator\">:</span> <span class=\"token constant\">T1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token constant\">T2</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>store<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token function\">set</span><span class=\"token punctuation\">(</span>key<span class=\"token operator\">:</span> <span class=\"token constant\">T1</span><span class=\"token punctuation\">,</span> value<span class=\"token operator\">:</span> <span class=\"token constant\">T2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>store<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>JavaScript의 경우 타입이 없으니 타입 지정을 빼고 구현하면 된다.</p>\n</blockquote>\n<br>\n<p>우선, <code class=\"language-text\">BaseSessionStore</code> 클래스를 제작해 주고, <code class=\"language-text\">Generic Type</code> T1, T2를 받아와 준다.</p>\n<blockquote>\n<p><code class=\"language-text\">Generic Type</code>이란, 범용 타입이다. 변수 혹은 클래스 생성 시, 정해준 타입으로 컴파일 시 적용된다.</p>\n</blockquote>\n<br>\n<p>위와같은 보일러 클래스를 Domain 별로 사용하기 위해, 상속을 통해 Domain 별 세션 클래스를 제작할 수 있다.<br></p>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">UserSessionStore</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseSessionStore<span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">string</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">getAllUsers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>store<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>위와같이 <code class=\"language-text\">BaseSessionStore</code>를 상속받아 구현 된 <code class=\"language-text\">UserSessionStore</code>가 있다.<br>\nkey는 number, value는 string으로 설정하였다.<br></p>\n<br>\n<h3 id=\"-session-store-클래스-사용\" style=\"position:relative;\"><a href=\"#-session-store-%ED%81%B4%EB%9E%98%EC%8A%A4-%EC%82%AC%EC%9A%A9\" aria-label=\" session store 클래스 사용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🦿 Session Store 클래스 사용</h3>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token operator\">...</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UserSessionStore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">...</span>\n\n<span class=\"token keyword\">const</span> userSessionStore <span class=\"token operator\">=</span> <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./userSessionStore.ts'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// or</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> userSessionStore <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./userSessionStore'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<p>일단 Map 자료구조를 이용한 클래스 생성은 알겠으니, 실제 프로덕트에 적용시켜 본다면 Node.js의 <code class=\"language-text\">require</code> 또는 <code class=\"language-text\">import</code>를 사용하여 캐싱된 모듈을 불러오는 식으로 생성된 클래스를 이용할 수 있다.<br></p>\n<br>\n<p>프레임워크에서 IOC를 지원한다면 <code class=\"language-text\">Dependency Injection</code>을 사용하여 클래스를 싱글톤으로 유지해 사용하는 방법이 있다.<br></p>\n<br>\n<p>두 경우 객체 내부 메모리는 공유되는 <code class=\"language-text\">Call by sharing</code> 기법이 적용되어 객체 내부 데이터를 잃지 않고 유지할 수 있다.<br>\n이러한 방법을 통해 <code class=\"language-text\">Session store</code>를 구현해 봤으며, 적절히 필요에 따라 사용하면 될 듯 하다.<br></p>\n<br>\n<h2 id=\"-참고-자료\" style=\"position:relative;\"><a href=\"#-%EC%B0%B8%EA%B3%A0-%EC%9E%90%EB%A3%8C\" aria-label=\" 참고 자료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📚 참고 자료</h2>\n<blockquote>\n<p>Evaluation strategies</p>\n</blockquote>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Evaluation_strategy\">https://en.wikipedia.org/wiki/Evaluation_strategy</a></li>\n</ul>\n<br>\n<blockquote>\n<p>Hash Table Algorithm</p>\n</blockquote>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Hash_table\">https://en.wikipedia.org/wiki/Hash_table</a></li>\n<li><a href=\"https://nlp.chonbuk.ac.kr/AL/ch06.pdf\">https://nlp.chonbuk.ac.kr/AL/ch06.pdf</a></li>\n</ul>\n<br/>\n<br/>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-session-%EC%9D%B4%EB%9E%80\">🌊 Session 이란?</a></p>\n</li>\n<li>\n<p><a href=\"#-session%EC%9D%84-%EC%9C%A0%EC%A7%80%EC%8B%9C%ED%82%A4%EB%8A%94-%EB%B0%A9%EB%B2%95\">🤝 Session을 유지시키는 방법</a></p>\n<ul>\n<li><a href=\"#-%EC%84%B8%EC%85%98%EC%9D%84-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0-%EC%9C%84%ED%95%9C-%EB%8B%A4%EC%96%91%ED%95%9C-%EB%B0%A9%EB%B2%95\">💾 세션을 구현하기 위한 다양한 방법</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EB%A9%94%EB%AA%A8%EB%A6%AC%EB%A1%9C-%EC%84%B8%EC%85%98%EC%9D%84-%EC%9C%A0%EC%A7%80%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\">📱 메모리로 세션을 유지하는 방법</a></p>\n<ul>\n<li><a href=\"#-call-by-sharing-%EC%9D%B4%EB%9E%80\">📞 Call by sharing 이란?</a></li>\n<li><a href=\"#-map-%EC%9E%90%EB%A3%8C%EA%B5%AC%EC%A1%B0\">🗺 Map 자료구조</a></li>\n<li><a href=\"#-hash-table%EC%9D%98-collision-%EA%B4%80%EB%A6%AC\">🤔 Hash Table의 Collision 관리</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-session-%EA%B5%AC%ED%98%84\">🧑‍💻 Session 구현</a></p>\n<ul>\n<li><a href=\"#-session-store-%ED%81%B4%EB%9E%98%EC%8A%A4-%EC%82%AC%EC%9A%A9\">🦿 Session Store 클래스 사용</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EC%B0%B8%EA%B3%A0-%EC%9E%90%EB%A3%8C\">📚 참고 자료</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"September 30, 2022","title":"Session이란? JavaScript로 구현하는 Session","categories":"Node.js","author":"seongsu","emoji":"1️⃣4️⃣"},"fields":{"slug":"/skill/session/"}},"site":{"siteMetadata":{"siteUrl":"https://seongsu.me","comments":{"utterances":{"repo":"nfl1ryxditimo12/nfl1ryxditimo12.github.io"}}}}},"pageContext":{"slug":"/skill/nestjs-aop/","nextSlug":"/skill/socket/","prevSlug":"/skill/session/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}