{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/skill/latency-strategy/",
    "result": {"data":{"cur":{"id":"98902d3c-e3ed-5e39-b45b-d44536d6e2b1","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 710px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIDBAX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB24rCw4Ff/8QAGBABAQEBAQAAAAAAAAAAAAAAAQARAiH/2gAIAQEAAQUC7bXZNg9v/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFRABAQAAAAAAAAAAAAAAAAAAECH/2gAIAQEABj8Ca//EABoQAQACAwEAAAAAAAAAAAAAAAEAERAhMUH/2gAIAQEAAT8hQoIH67xwQoWQNq3j/9oADAMBAAIAAwAAABAbz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABYRAQEBAAAAAAAAAAAAAAAAABEQIf/aAAgBAgEBPxA1n//EAB0QAQEAAQQDAAAAAAAAAAAAAAERIQAQMUFhkfD/2gAIAQEAAT8QrkLVVkD496xlVRDtLBOguycicj3oaOTC+Djb/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"network\"\n        title=\"network\"\n        src=\"/static/408ba28e91466c8a84f92f994d4d1866/67e9d/network.jpg\"\n        srcset=\"/static/408ba28e91466c8a84f92f994d4d1866/4ec73/network.jpg 180w,\n/static/408ba28e91466c8a84f92f994d4d1866/158ba/network.jpg 360w,\n/static/408ba28e91466c8a84f92f994d4d1866/67e9d/network.jpg 710w\"\n        sizes=\"(max-width: 710px) 100vw, 710px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<h2 id=\"-개요\" style=\"position:relative;\"><a href=\"#-%EA%B0%9C%EC%9A%94\" aria-label=\" 개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🐽 개요</h2>\n<br>\n<p>프랑스에서 3초마다 데이터를 받아와 Slack으로 최신 데이터를 제공해주는 서비스를 운영중인데, 평균 2-3초의 <code class=\"language-text\">Latency</code>가 있었다.<br></p>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">프랑스 API 서버 -> AWS Seoul Region -> 데이터 가공 -> Slack</code></pre></div>\n<br>\n<p>위와 같은 Flow로 데이터가 이동하였는데 아무리 프랑스에서 데이터가 전송된다 해도, 말이 평균이지 최소 2초의 지연시간은 발생하였다.<br></p>\n<blockquote>\n<p>10초가 넘어가는 경우도 가끔 있었다.</p>\n</blockquote>\n<p>이렇게 불안정한 환경으로 서버를 운영하는 것은 서비스 질적으로 최악이라 판단해서 서버 운영 1주년을 기념해 <code class=\"language-text\">서버 최적화</code>를 기획하게 되었다.<br></p>\n<br>\n<h2 id=\"-최적화-방법을-떠올려-보자\" style=\"position:relative;\"><a href=\"#-%EC%B5%9C%EC%A0%81%ED%99%94-%EB%B0%A9%EB%B2%95%EC%9D%84-%EB%96%A0%EC%98%AC%EB%A0%A4-%EB%B3%B4%EC%9E%90\" aria-label=\" 최적화 방법을 떠올려 보자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🎨 최적화 방법을 떠올려 보자</h2>\n<br>\n<p>일단 데이터 Flow를 기준으로 <code class=\"language-text\">프랑스에서 데이터를 받아오는 부분</code>, <code class=\"language-text\">데이터 가공하는 부분</code>, <code class=\"language-text\">데이터를 Slack으로 전송하는 부분</code> 총 3가지를 트랜잭션으로 묶었고, 로깅을 진행했다.<br></p>\n<br>\n<h3 id=\"-범인은-api-응답이-늦어서-였다\" style=\"position:relative;\"><a href=\"#-%EB%B2%94%EC%9D%B8%EC%9D%80-api-%EC%9D%91%EB%8B%B5%EC%9D%B4-%EB%8A%A6%EC%96%B4%EC%84%9C-%EC%98%80%EB%8B%A4\" aria-label=\" 범인은 api 응답이 늦어서 였다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📄 범인은 API 응답이 늦어서 였다.</h3>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA9ElEQVQoz5WRR47EMAwE/RvnAOec4/8fxEUR0AIz8GUOAt2kukha1jAM0nWdjOMo0zQJuigKqapK0jRVvSyL1o7jkG3b5DxP9VzXpTVy+Ou6Fqvve2nbVo0k0d/AeZ61tu+7rOuqEQ9ggORogMfiIoIJOOiyLLVblmWqMQAFAIxJAd73rTU0918nfFsZmFkZCNCmabQBa6Opw/l5ZQBMBZAGBohPJ3x7FLPy96MwkZkKABFNQ7T+QwMhaYwAmSDPc83zitSe51EIkXtEfoFhMJTl+75wgiCQMAw1Oo4jruuKbdsf+TiO/w+eJEkkiiL99jxPzx8mZQ/Vb8tf6QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"api log\"\n        title=\"api log\"\n        src=\"/static/7e7252af2f0e9110cc62feb86b188e56/37523/api_log.png\"\n        srcset=\"/static/7e7252af2f0e9110cc62feb86b188e56/e9ff0/api_log.png 180w,\n/static/7e7252af2f0e9110cc62feb86b188e56/f21e7/api_log.png 360w,\n/static/7e7252af2f0e9110cc62feb86b188e56/37523/api_log.png 720w,\n/static/7e7252af2f0e9110cc62feb86b188e56/302a4/api_log.png 1080w,\n/static/7e7252af2f0e9110cc62feb86b188e56/6be49/api_log.png 1160w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>프랑스에서 한국까지 API를 받아오는데 <code class=\"language-text\">평균 1,550ms</code> 정도를 기록했고, 데이터 가공은 <code class=\"language-text\">평균 200ms</code> 미만, slack 전송은 <code class=\"language-text\">평균 300ms</code> 정도였다.<br></p>\n<br>\n<h3 id=\"-latency를-줄이기-위한-방법\" style=\"position:relative;\"><a href=\"#-latency%EB%A5%BC-%EC%A4%84%EC%9D%B4%EA%B8%B0-%EC%9C%84%ED%95%9C-%EB%B0%A9%EB%B2%95\" aria-label=\" latency를 줄이기 위한 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🤟🏻 Latency를 줄이기 위한 방법</h3>\n<br>\n<p><code class=\"language-text\">Latency</code>를 줄이겠다고 서버 데이터 가공 로직을 최적화 하는건 한계가 있을 것이다.<br>\n그래서 최적화는 그대로 하되, 데이터를 받아오는 지역 자체를 프랑스로 옮기고, 데이터가 한국으로 전달되는 부분은 Slack의 데이터 전송 기술을 믿으면 더 효율적인 최적화 방법이 될 것 같았다.<br></p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABCElEQVQoz4WSWW6EQAxE5zqITSzN3uyLuP+BPHqOPCGKlHy0ENX2c5Xh1XWd9H0v3ntZlkXKspSqqiTPc9WnaZJhGGRdVz3UtG2rOu/7vss8z6olSSIvioGN46gFwAyIjkYDjcdxyHmeH533+771Di1N0y8gB+C2beKck7qupSgK8X5QR7ihyaDm2AbYEHVokQHS7NzvyObIoMTDNQau61INThRF30BrwuETSKPdAeA8gbgDSG0cx3/v0KLZDgFQh04aIvOkBmNhGP63Q/9jh9w/VwDQvvxnh1gFaL+BAXFINIoZZkBqng7R0ahVh8QD0DSNTsmyTGHsA5cMtDtARDPdNAbCCIJA3g/FMwda6jZKAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"paris latency\"\n        title=\"paris latency\"\n        src=\"/static/1c5ce77c191b02a74e3093eec0767f7d/37523/paris_log.png\"\n        srcset=\"/static/1c5ce77c191b02a74e3093eec0767f7d/e9ff0/paris_log.png 180w,\n/static/1c5ce77c191b02a74e3093eec0767f7d/f21e7/paris_log.png 360w,\n/static/1c5ce77c191b02a74e3093eec0767f7d/37523/paris_log.png 720w,\n/static/1c5ce77c191b02a74e3093eec0767f7d/302a4/paris_log.png 1080w,\n/static/1c5ce77c191b02a74e3093eec0767f7d/11b93/paris_log.png 1124w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>그러기 위해 일단 <code class=\"language-text\">AWS Region</code>을 Paris로 옮겼는데, 어머나.. <code class=\"language-text\">Latency</code>가 1/10 이상 줄어들었다.<br></p>\n<br>\n<p>사실 이렇게 많이 줄어들 줄 몰랐는데, 프랑스에서 한국까지 데이터가 전송되는데 많은 <code class=\"language-text\">Router</code>를 거치며 지연시간이 늘어났나 보다.<br></p>\n<br>\n<p>여기에 데이터 가공 로직까지 최적화 한다면, 유의미한 결과가 나올 것 같았다.<br>\n원래는 <code class=\"language-text\">Event</code>, <code class=\"language-text\">Exam</code>으로 나눠진 두개의 데이터를 하나의 프로세스에서 비동기로 처리하고 있었다.<br>\n이 두개를 각 프로세스에서 돌릴수 있게 <code class=\"language-text\">Interface 코드</code>를 짜고, 환경변수로 <code class=\"language-text\">Event</code>, <code class=\"language-text\">Exam</code> 프로세스를 분리했다. 그 뒤, Webpack을 이용해 <code class=\"language-text\">Interface 코드</code>를 번들링 하였고 각 프로세스를 실행시켰다.<br></p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 117.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAABYlAAAWJQFJUiTwAAADE0lEQVQ4y42UiY6bSBRF8/+fN6NksrQ7NjZgDJjaNyjOiHK3085MJynpSZbRu/WWe+rDmiK6jzSVxhhPXiClGe89y7IQQiiR5pllybw967rFeo/tfFhfPjaDY99pBmGo2is5ryUhr6/Jt6Q05/LtJr7+dMHKh1fl8xQ4tBN127FrNB8PosTXk0Joz5fvLX99rviyO/LpW8W3auAyObRLxJjIOb9UuEIIHmEirQjMS0bZxKAiwkYmGwkpMQhLiBExjUgpkW6hl4nuanHOlfG8CK5lRnPIWJkYxhEpBMYlnMyofkGOnnHs6SfDZGaU8VxGibP2/ZadXugqz2Ff0Z67crNREaczziaMMWgbMH7G+VhEvQ8Pi7lXuMU2fD9Ipu972vOFYZQMk+LQDPSTZpKO0/nK6Tzyz66makc+P7d8eqrZn3qM9bcKt029qhujqOsjShr6ViOkQttUhHbVhfOgEMpQN2eUCdTdxK7qmIT60fLrj+1sHowO5rjivGeeZ2II5JeB/8m5z9A6h1UJcZkxYmYcryilmIQoW3zrxV/FXTBET87vV/I7oTctr1iRGTtLTOkh+UbCemPsN5c82GZd4NRZDht6k+Z0npiXhbyuLK8I5lxMvywrc8Ev/0f8YYYbevtmou16nmpVkNviuTUoE8uWvzy3PO0bPu9OPJ/GQpQL26MxP1aYUmRUgePgCHFmUoFm9FyE5yI9xgeai0RqS9edy8IuIlD1ju5qsNa+GJybbbYN53kluaVs1llDTAvJrTiRsSoWj27eMyHjfGISmmVO77ds1Uyz9zw9f+fUtDSDRctI0GBkQEqB0O4FvcAkLetPc3xEL0McFfZYc+l7xOZB7dgdO6wPXMbbwjYy9vVI1Yz8/fXE8/FSiHGF65/Q01pxOh4Qk6arFddpqypwbK98259pe8lwVVTHulR7qAe+7s8FvQdjvwrOKWNUIvoFY+zt+Y+x+POtN99a5odf37BcSAkep2dkv2DkDT2tNdP0A72HJ39d/9+HWxWlXWPur+57VPwKwXuFMcb7H3+S8LvX5l/ZDP0FJ5rWpwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"before\"\n        title=\"before\"\n        src=\"/static/8e63bdb493533085b8a512001696184d/37523/before.png\"\n        srcset=\"/static/8e63bdb493533085b8a512001696184d/e9ff0/before.png 180w,\n/static/8e63bdb493533085b8a512001696184d/f21e7/before.png 360w,\n/static/8e63bdb493533085b8a512001696184d/37523/before.png 720w,\n/static/8e63bdb493533085b8a512001696184d/6d2da/before.png 936w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>최적화 전 코드</p>\n</blockquote>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB30lEQVQ4y42SjW7jIBCE8/7Pd1epl9RJ6r/YgAEb22BjviqOWt1Vd9eutCBWaHZ2Zw6r6gjnM6MOiGJF31Z0G/FTILxkeCFRpqfRE9M08XuklPgch3sxVDXLrSHPS17zgq7THE8nrHVUdU1daGQ9c61ans8NUmm2Lf4V9HA/Qn3bQa+vOa0QVFVFKxRCacryhqoi11zwkkuEMsS4/pPl4f4MRUmsauq64ng8cblceckypO6Zipo2Kzidz/x4euZ8uVJVNTH+h+E0TGS55lxbbm3H6VLjnCOlDWIkrYFpnnFuZJpm5tmzbdsO9jl3QOcjz6WjUT1CSLLKUnfznjftkb3nu/Fg6CNPV8upNEilKNqenxfLr+J+G46lZZw82WuL6AaaVuziCSkp5UTRDgyDw3v/UFkaixgW+vmxj9mvGJ8YV5hCYgyJmCLKDoxzYFkW+mHYbeRCQg+BEB71XRSTF2xdhzV6V3n2gU2pPa01WGMYzcZsobdu/3OfREqFEC1xXf70IW4gDRbTa7TRrDGxaUPUGmN7us7gTKTvItY4mqZ5gEq1j38f9V3xxw4dWJ0YNbuZhRCYYWDj+/Fun4P3gb4L9HLFihUpur27kop1WT4+f5UfDO9+21L8svN3bfMG34XtVtxQneAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"after\"\n        title=\"after\"\n        src=\"/static/10cee15dfd59b81b14ed859eeecafe59/37523/after.png\"\n        srcset=\"/static/10cee15dfd59b81b14ed859eeecafe59/e9ff0/after.png 180w,\n/static/10cee15dfd59b81b14ed859eeecafe59/f21e7/after.png 360w,\n/static/10cee15dfd59b81b14ed859eeecafe59/37523/after.png 720w,\n/static/10cee15dfd59b81b14ed859eeecafe59/f3c12/after.png 764w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>최적화 후 코드</p>\n</blockquote>\n<br>\n<p>두 코드를 보았을 때, <code class=\"language-text\">선언형</code>, <code class=\"language-text\">추상화</code>에 초점을 맞춰 리팩토링을 진행하니 확실히 코드의 가독성이 좋아졌다.<br>\nNode.js의 <code class=\"language-text\">모듈 캐싱 전략</code>을 적절히 활용하여 <code class=\"language-text\">DI</code>를 적용한 것도 가독성에 한몫 했다고 보이는 것 같다.<br></p>\n<br>\n<h3 id=\"️-대기업-플랫폼을-이용한-최적화-전략-먹혔나\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-%EB%8C%80%EA%B8%B0%EC%97%85-%ED%94%8C%EB%9E%AB%ED%8F%BC%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%B5%9C%EC%A0%81%ED%99%94-%EC%A0%84%EB%9E%B5-%EB%A8%B9%ED%98%94%EB%82%98\" aria-label=\"️ 대기업 플랫폼을 이용한 최적화 전략 먹혔나 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>☂️ 대기업 플랫폼을 이용한 최적화 전략.. 먹혔나?</h3>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 576px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA5UlEQVQY022Qy26CUBRF+RUFi0opcrm8H8oj0NZqKIqmjkxHHfQ7OuhPrwbS2EkHKytnsnP2VoT0GQjjDCEDvCDGCxL8MBl9N7/Hsl2slUSdLZhq85v/Q9mUNXnVkGQFQZQRpzlRskF6IdKLMC2Hqn4mXZdj+ETVb6F/LNF0Y7SifXyhxw2HtqOoHqmbLe1rT7oueNru2e078rKmP1/ojmeOpzf604W269m1B67Xd0RcoH9+M8teUKayQDclwvEwTBvTEmPFYQbXj7FsOd5DfdvxcGTAw8rB/f1+mGhhWEycHHUp+AEpW4QxiTsxvgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"paris result\"\n        title=\"paris result\"\n        src=\"/static/19b644c05c508ac558c4bbb1fbeb5ad0/533c1/paris_result.png\"\n        srcset=\"/static/19b644c05c508ac558c4bbb1fbeb5ad0/e9ff0/paris_result.png 180w,\n/static/19b644c05c508ac558c4bbb1fbeb5ad0/f21e7/paris_result.png 360w,\n/static/19b644c05c508ac558c4bbb1fbeb5ad0/533c1/paris_result.png 576w\"\n        sizes=\"(max-width: 576px) 100vw, 576px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>Paris Region 서버 Slack 응답 로그</p>\n</blockquote>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 580px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA6klEQVQY023Qy1LCQBSE4byJ4giSoIaEZMhMmNwI4C0lKCVgQIuVGx/Et/6tGnXnohe9+arPcRJtUGmOyacEozGpKRnFiqKc4Qcx3uXQ9kgq+t41HXGB6Lqcnff/jVPNbixYVnOiWFlQJimTrMId+AxDSV7WNoOrgJNO16J/wA/uInoeoufiiHLJYlrTLJ8xecXLtqWe32KyisfVmodmRWoK2v07T+sNu/aNzW7P9vVAVS9oD0ea+wax+sD7/MLpDTVSKvxQEkZje3YstV2t0gyZTAijxC6PpCZRxnals98XFcix5tTXCH3HN7HbhcEayBiqAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"seoul result\"\n        title=\"seoul result\"\n        src=\"/static/57a9c0e30110ec54ed9b7f0637abe342/b6272/seoul_result.png\"\n        srcset=\"/static/57a9c0e30110ec54ed9b7f0637abe342/e9ff0/seoul_result.png 180w,\n/static/57a9c0e30110ec54ed9b7f0637abe342/f21e7/seoul_result.png 360w,\n/static/57a9c0e30110ec54ed9b7f0637abe342/b6272/seoul_result.png 580w\"\n        sizes=\"(max-width: 580px) 100vw, 580px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>Seoul Region 서버 Slack 응답 로그</p>\n</blockquote>\n<br>\n<p>결과를 보니 확연한 차이가 있었다. Paris로 Region을 이전한 것, 서버 프로세스 최적화를 진행한 것 이 두개의 효율이 잘 나와 <code class=\"language-text\">700ms의 Latency</code>를 줄이게 되었다.<br></p>\n<br>\n<h2 id=\"-뱀의-머리보단-용의-꼬리가-낫다\" style=\"position:relative;\"><a href=\"#-%EB%B1%80%EC%9D%98-%EB%A8%B8%EB%A6%AC%EB%B3%B4%EB%8B%A8-%EC%9A%A9%EC%9D%98-%EA%BC%AC%EB%A6%AC%EA%B0%80-%EB%82%AB%EB%8B%A4\" aria-label=\" 뱀의 머리보단 용의 꼬리가 낫다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🐍 뱀의 머리보단 용의 꼬리가 낫다</h2>\n<br>\n<p>확실히 직접 통신 비용을 줄이려는 노력을 하기보단, 이미 구축되어있는 플랫폼의 기술을 이용하는 것이 좋은 방법인 듯 하다.<br>\n이로써 최종 2,000ms -> 1,300ms로 35%의 통신 비용을 단축할 수 있었다.<br></p>\n<br>\n<p>다만 아쉬운 점은, API 서버가 너무 멀리 있어 아무리 최적화를 해도 800ms 정도 최소한의 통신 비용은 존재하는게 어쩔수 없긴 해도 아쉽긴 하다.<br></p>\n<br>\n<h3 id=\"-그런데-왜-줄이려는-시도를-하는-것인가\" style=\"position:relative;\"><a href=\"#-%EA%B7%B8%EB%9F%B0%EB%8D%B0-%EC%99%9C-%EC%A4%84%EC%9D%B4%EB%A0%A4%EB%8A%94-%EC%8B%9C%EB%8F%84%EB%A5%BC-%ED%95%98%EB%8A%94-%EA%B2%83%EC%9D%B8%EA%B0%80\" aria-label=\" 그런데 왜 줄이려는 시도를 하는 것인가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>❓ 그런데 왜 줄이려는 시도를 하는 것인가?</h3>\n<br>\n<p>제일 중요한게 <code class=\"language-text\">Why?</code> 인데 설명을 안해서 마지막에 하려한다.<br></p>\n<br>\n<p>42 교육과정에서 선착순으로 진행되는 행사의 알림을 실시간으로 해주는 서버를 운영중이라 빠른 알림이 필요했다. 하지만 2,000ms는 너무 느린 속도여서 ”<strong>조금이라도 단축할 수 있지 않을까?</strong>“라는 생각이 들었고, 이김에 과거에 작성한 쪽팔린(?) 코드를 고치는 것이 목표였다.<br></p>\n<br>\n<p>여튼 기획에 맞게 단축이 되긴 해서 다행이고, 오래전에 짠 더러운 코드를 싹다 고쳐서 묵은 때를 벗기는 느낌이 들어 굉장히 기분이 좋았다.<br></p>\n<br>\n<h2 id=\"-github-주소\" style=\"position:relative;\"><a href=\"#-github-%EC%A3%BC%EC%86%8C\" aria-label=\" github 주소 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📚 Github 주소</h2>\n<ul>\n<li><a href=\"https://github.com/nfl1ryxditimo12/42Notifier\">https://github.com/nfl1ryxditimo12/42Notifier</a></li>\n</ul>\n<br/>\n<br/>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-%EA%B0%9C%EC%9A%94\">🐽 개요</a></p>\n</li>\n<li>\n<p><a href=\"#-%EC%B5%9C%EC%A0%81%ED%99%94-%EB%B0%A9%EB%B2%95%EC%9D%84-%EB%96%A0%EC%98%AC%EB%A0%A4-%EB%B3%B4%EC%9E%90\">🎨 최적화 방법을 떠올려 보자</a></p>\n<ul>\n<li><a href=\"#-%EB%B2%94%EC%9D%B8%EC%9D%80-api-%EC%9D%91%EB%8B%B5%EC%9D%B4-%EB%8A%A6%EC%96%B4%EC%84%9C-%EC%98%80%EB%8B%A4\">📄 범인은 API 응답이 늦어서 였다.</a></li>\n<li><a href=\"#-latency%EB%A5%BC-%EC%A4%84%EC%9D%B4%EA%B8%B0-%EC%9C%84%ED%95%9C-%EB%B0%A9%EB%B2%95\">🤟🏻 Latency를 줄이기 위한 방법</a></li>\n<li><a href=\"#%EF%B8%8F-%EB%8C%80%EA%B8%B0%EC%97%85-%ED%94%8C%EB%9E%AB%ED%8F%BC%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%B5%9C%EC%A0%81%ED%99%94-%EC%A0%84%EB%9E%B5-%EB%A8%B9%ED%98%94%EB%82%98\">☂️ 대기업 플랫폼을 이용한 최적화 전략.. 먹혔나?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EB%B1%80%EC%9D%98-%EB%A8%B8%EB%A6%AC%EB%B3%B4%EB%8B%A8-%EC%9A%A9%EC%9D%98-%EA%BC%AC%EB%A6%AC%EA%B0%80-%EB%82%AB%EB%8B%A4\">🐍 뱀의 머리보단 용의 꼬리가 낫다</a></p>\n<ul>\n<li><a href=\"#-%EA%B7%B8%EB%9F%B0%EB%8D%B0-%EC%99%9C-%EC%A4%84%EC%9D%B4%EB%A0%A4%EB%8A%94-%EC%8B%9C%EB%8F%84%EB%A5%BC-%ED%95%98%EB%8A%94-%EA%B2%83%EC%9D%B8%EA%B0%80\">❓ 그런데 왜 줄이려는 시도를 하는 것인가?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-github-%EC%A3%BC%EC%86%8C\">📚 Github 주소</a></p>\n</li>\n</ul>\n</div>","excerpt":"🐽 개요 프랑스에서 3초마다 데이터를 받아와 Slack으로 최신 데이터를 제공해주는 서비스를 운영중인데, 평균 2-3초의 가 있었다. 위와 같은 Flow로 데이터가 이동하였는데 아무리 프랑스에서 데이터가 전송된다 해도, 말이 평균이지 최소 2초의 지연시간은 발생하였다. 10초가 넘어가는 경우도 가끔 있었다. 이렇게 불안정한 환경으로 서버를 운영하는 것은 서비스 질적으로 최악이라 판단해서 서버 운영 1주년을 기념해 를 기획하게 되었다. 🎨 최적화 방법을 떠올려 보자 일단 데이터 Flow를 기준으로 , ,  총 3가지를 트랜잭션으로 묶었고, 로깅을 진행했다. 📄 범인은 API 응답이 늦어서 였다.  프랑스에서 한국까지 API를 받아오는데  정도를 기록했고, 데이터 가공은  미만, slack 전송은  정도였다. 🤟🏻 Latency를 줄이기 위한 방법 를 줄이겠다고 서버 데이터 가공 로직을 최적화 하는건 한계가 있을 것이다.\n그래서 최적화는 그대로 하되, 데이터를 받아오는 지역 자체를 프랑…","frontmatter":{"date":"October 08, 2022","title":"프랑스 - 한국 간 Latency 단축 전략","categories":"네트워크 회고","author":"seongsu","emoji":"1️⃣5️⃣"},"fields":{"slug":"/skill/latency-strategy/"}},"next":{"id":"c316931f-bff2-5758-8803-7f65f7df02be","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAC4iAAAuIgGq4t2SAAAB20lEQVQY0x2RzWvTYByAf/hBwGm1HR7UgQfx6kEQZSB42Gng/MBSaUy62ua7ed+k6eqavP2yw0VE6FVRUMdApiZpVoXRpEn9QA/iVY+ymwdP/gGR9fY8l+fyQPLnEUx8AowoQ5bTwO73oaytQFE1gJU1YBVt6iVcg2wZw9YrAp8/dCD0H8B40ILY70I0aEPkdyDevg+QJJv7v7xvnQa4DHnJOJgkCYi1BlXW6lShos8uV6qHuOq9DKevHM3xeubNRnPm684aFQ3tfbHfpSbD3uHI78zF293ZyXAtAyWEnr5+UU/+/exdPL8onCkomKdFVKYF9SotojYjY8QqOr6r6ku3SujxxrNVbuKT/uiddSl0iRR6ZHnsNYuha1XHXvMG3BHRE7Nl3BQ0jeS4yjVGxgwtIj4vqNdpERFGwgar6Kio6ou3eby++Xx1IRpYvcAxSeiaeuhaUjRozweOuRdegt3vdjpwzE9GA/+9klXOHr/AAy2iI7SIZhhZmysoeiovqKcYGaVzvJZat2uZ39/IgZFjnghdiwpdcmzsNVOB00iHrnUSfoxaMPas+Z231rmtl3VIkhhoQd2LAiPh6RRaVIGVMeR4DeyHNfj1kcDIMSFwTQhdazoncBpT/g85e9N6OvY2NAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"hibernate logo\"\n        title=\"hibernate logo\"\n        src=\"/static/9fcaa2ae1ae6ab14b2e461d825c39d97/37523/Hibernate_logo.png\"\n        srcset=\"/static/9fcaa2ae1ae6ab14b2e461d825c39d97/e9ff0/Hibernate_logo.png 180w,\n/static/9fcaa2ae1ae6ab14b2e461d825c39d97/f21e7/Hibernate_logo.png 360w,\n/static/9fcaa2ae1ae6ab14b2e461d825c39d97/37523/Hibernate_logo.png 720w,\n/static/9fcaa2ae1ae6ab14b2e461d825c39d97/302a4/Hibernate_logo.png 1080w,\n/static/9fcaa2ae1ae6ab14b2e461d825c39d97/07a9c/Hibernate_logo.png 1440w,\n/static/9fcaa2ae1ae6ab14b2e461d825c39d97/58916/Hibernate_logo.png 2313w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<h2 id=\"-hibernate-spatial\" style=\"position:relative;\"><a href=\"#-hibernate-spatial\" aria-label=\" hibernate spatial permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💽 Hibernate Spatial</h2>\n<br>\n<p>Hibernate Spatial은 지리 데이터를 계산하기 위해 만들어 졌고, Hibernate 5.0 버전 부터 Hibernate 라이브러리에 공식적으로 마이그레이션이 됐다.<br></p>\n<p>현재 지원하는 데이터베이스는 <code class=\"language-text\">Oracle</code>, <code class=\"language-text\">PostgreSQL</code>, <code class=\"language-text\">MySQL</code>, <code class=\"language-text\">MSSQL</code>, <code class=\"language-text\">H2</code>이고, 각 데이터베이스에 구현 되어있는 지리 데이터처리 구현체를 추상화한 인터페이스가 <code class=\"language-text\">Hibernate Spatial</code>이다.<br></p>\n<p>Hibernate Spatial은 <a href=\"https://www.tsusiatsoftware.net/jts/main.html\">JTS</a>와 <a href=\"https://github.com/GeoLatte/geolatte-geom\">\ngeolatte-geom</a>이라는 기하학 모델을 제공한다고 한다.<br></p>\n<p>이러한 GIS(Geometry Information System)를 <code class=\"language-text\">Native Query</code>로 날리지 않고 Hibernate에 추상화된 함수를 통해 JPQL로 쉽게 짤 수 있다.<br></p>\n<br>\n<h3 id=\"-어떤-데이터베이스를-사용해야-할까\" style=\"position:relative;\"><a href=\"#-%EC%96%B4%EB%96%A4-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4%EC%95%BC-%ED%95%A0%EA%B9%8C\" aria-label=\" 어떤 데이터베이스를 사용해야 할까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>👈 어떤 데이터베이스를 사용해야 할까?</h3>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABnElEQVQoz2WTiW7EIAxE8///2ao5IAc3JJlqht20VSNZGC+xX2bYwa471u3A4QK23T3rbCycD+Bz3zfO80TOGaUUtNa0Z/4O1mqtGEIIaLXi93NdJ5xzasBmDL6w7zt4fhxHeO8RQ9Cesa4rjuPAYKzBPE8KHtz3DTknRSn5yVOKqLWoFoLX/v076zEG5JIxcOq6WmzbpinE5sF5nhFjxHVdilQScs04z/bkuSTEHNHOprW2iuHz8wPGLNi2VY05iQTLMsO5oxOmBB8cQuxkLhzPnrlqvq8inKbp0aWLnaUXNSQRg59TKsWvIuv7LFrWuIrQWiuyZVlgjFEjNuYQrtSHMpAmpqBhPjrlDObvGgcNb+3YmE1T6iZQBmrYCU+kHEVFGuolHaVheGr8goF0JGMDGuG9UyO6/kNY/hGGFBR/CLMIVzncmxoZQu04gLSku0j4cpb3Mb5oGXK5/XKZL3YNZ0xTv4dsOo5futyczn+CqKIXhXs53F12T42yDNYaaUj9GKTthEaEvIP3dT8ukzjS2ZTQclYujUsn/AbQAqD9hs4OyQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"hibernate function\"\n        title=\"hibernate function\"\n        src=\"/static/aa68a854a10bee6dbf747f03da7df2d2/37523/hibernate-function.png\"\n        srcset=\"/static/aa68a854a10bee6dbf747f03da7df2d2/e9ff0/hibernate-function.png 180w,\n/static/aa68a854a10bee6dbf747f03da7df2d2/f21e7/hibernate-function.png 360w,\n/static/aa68a854a10bee6dbf747f03da7df2d2/37523/hibernate-function.png 720w,\n/static/aa68a854a10bee6dbf747f03da7df2d2/302a4/hibernate-function.png 1080w,\n/static/aa68a854a10bee6dbf747f03da7df2d2/07a9c/hibernate-function.png 1440w,\n/static/aa68a854a10bee6dbf747f03da7df2d2/6e52c/hibernate-function.png 1948w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p><a href=\"https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#spatial-configuration\">Hibernate Spatial Function</a></p>\n</blockquote>\n<br>\n<p>Geometry 함수를 지원하는 데이터베이스는 많이 있다. 하지만 이 포스팅에서 작성할 내용인 <code class=\"language-text\">ST_Distance</code>, <code class=\"language-text\">ST_Dwithin</code>과 같은 좌표 간 거리를 간단하게 반환해주는 함수를 사용하기엔 이식성이 떨어지는 데이터베이스가 존재한다.<br></p>\n<p>원래는 MySQL을 사용하려 했지만, 위 거리계산 함수를 Hibernate에서 지원하지 않아 <code class=\"language-text\">Native Query</code>로 사용해야 돼 ORM을 사용하는 이유를 찾지 못해 PostreSQL을 사용하기로 했다.<br></p>\n<p>또한 테스트를 위해 H2 Database를 사용해야 하는데, H2GIS가 PostGIS를 기반으로 제작되어서 테스트가 용이한 이유도 있다.<br></p>\n<br>\n<h2 id=\"️-postgresql-postgis-설치\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-postgresql-postgis-%EC%84%A4%EC%B9%98\" aria-label=\"️ postgresql postgis 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⬇️ PostgreSQL, PostGIS 설치</h2>\n<br>\n<p>우선 원하는 PostgreSQL을 설치하고, PostgreSQL로 지리계산을 하려면 <code class=\"language-text\">PostGIS</code> 라이브러를 설치해야 한다.<br></p>\n<p><code class=\"language-text\">PostgreSQL 설치 방법과 버전은 너무 간단하니 패스!</code><br></p>\n<blockquote>\n<p><a href=\"https://postgis.net/tags/3/\">PostGIS Relase</a></p>\n</blockquote>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 8.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAYUlEQVQI1z2OSwqAMAxEuxS0H/EGYn+4EW1avP/BIhNqF2GSmeERZSKxTZWhGJcqu9x4O1+55+OWe82NdSgjx24jiWpfJDeBWC3+kQKKYnYwgChP+zU8dG0H/o8ANoCR+AO02DiVyhMOcgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"postgis relase\"\n        title=\"postgis relase\"\n        src=\"/static/c4551a7abb8e2fce4f936bf1a91c81b9/37523/postgis-relase.png\"\n        srcset=\"/static/c4551a7abb8e2fce4f936bf1a91c81b9/e9ff0/postgis-relase.png 180w,\n/static/c4551a7abb8e2fce4f936bf1a91c81b9/f21e7/postgis-relase.png 360w,\n/static/c4551a7abb8e2fce4f936bf1a91c81b9/37523/postgis-relase.png 720w,\n/static/c4551a7abb8e2fce4f936bf1a91c81b9/302a4/postgis-relase.png 1080w,\n/static/c4551a7abb8e2fce4f936bf1a91c81b9/07a9c/postgis-relase.png 1440w,\n/static/c4551a7abb8e2fce4f936bf1a91c81b9/68638/postgis-relase.png 1510w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>위 링크에서 릴리즈 버전을 선택할 때 지원하는 PostgreSQL 버전을 꼭 확인해야 한다!</p>\n</blockquote>\n<br>\n<p>PostgreSQL, PostGIS 설치가 모두 끝났으면, Extension 설정을 다음과 같이 해줘야 한다.<br></p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> EXTENSION postgis<span class=\"token punctuation\">;</span></code></pre></div>\n<p>이제 데이터베이스에 지리데이터 계산 함수를 사용할 수 있고, 지리데이터 타입을 사용할 수 있게 된다.<br></p>\n<p>PostGIS 지리 함수에 대해선 아래 링크를 참고해보자<br></p>\n<blockquote>\n<p><a href=\"https://postgis.net/docs/manual-1.5/ch08.html\">PostGIS Special Functions Index</a></p>\n</blockquote>\n<br>\n<h2 id=\"️-hibernate-설치-및-설정\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-hibernate-%EC%84%A4%EC%B9%98-%EB%B0%8F-%EC%84%A4%EC%A0%95\" aria-label=\"️ hibernate 설치 및 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✍️ Hibernate 설치 및 설정</h2>\n<br>\n<p>우선 Gradle설정을 해준다.<br></p>\n<div class=\"gatsby-highlight\" data-language=\"gradle\"><pre class=\"language-gradle\"><code class=\"language-gradle\">plugins {\n    id &#39;org.springframework.boot&#39; version &#39;2.7.5&#39;\n}\n\ndependencies {\n  implementation &#39;org.springframework.boot:spring-boot-starter-web&#39;\n  implementation &#39;org.springframework.boot:spring-boot-starter-data-jpa&#39;\n  implementation group: &#39;org.hibernate&#39;, name: &#39;hibernate-spatial&#39;\n  implementation group: &#39;org.postgresql&#39;, name: &#39;postgresql&#39;\n  runtimeOnly &#39;org.postgresql:postgresql&#39;\n}</code></pre></div>\n<p>Spring은 <code class=\"language-text\">2.7.5</code>버전을 사용할 예정이고 Hibernate는 <code class=\"language-text\">spring-boot-starter</code>에 명시된 버전을 사용할 것이다.<br></p>\n<p>그리고 <code class=\"language-text\">hibernate-spatial</code>, <code class=\"language-text\">jpa</code>, <code class=\"language-text\">postgresql</code> implementation을 추가해준다.<br></p>\n<blockquote>\n<p><a href=\"https://docs.spring.io/spring-boot/docs/2.7.5/reference/html/dependency-versions.html#appendix.dependency-versions\">Spring boot 2.7.5 라이브러리 의존성은 여기서 확인</a></p>\n</blockquote>\n<p>Spring boot 버전 별 라이브러리 의존성은 <a href=\"https://spring.io/blog\">스프링부트 공식 페이지</a>에 잘 나와있다!<br></p>\n<br>\n<h3 id=\"️-applicationyml-설정\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-applicationyml-%EC%84%A4%EC%A0%95\" aria-label=\"️ applicationyml 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⚙️ application.yml 설정</h3>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> jdbc<span class=\"token punctuation\">:</span>postgresql<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span>5432/test_db <span class=\"token comment\"># DB host</span>\n    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> username <span class=\"token comment\"># DB username</span>\n    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> password <span class=\"token comment\"># DB password</span>\n    <span class=\"token key atrule\">driver-class-name</span><span class=\"token punctuation\">:</span> org.postgresql.Driver <span class=\"token comment\"># DB driver</span>\n  <span class=\"token key atrule\">jpa</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">hibernate</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">ddl-auto</span><span class=\"token punctuation\">:</span> create <span class=\"token comment\"># 작성된 entity에 따라 스키마 자동 생성</span>\n      <span class=\"token key atrule\">use-new-id-generator-mappings</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> <span class=\"token comment\"># pk 설정</span>\n    <span class=\"token key atrule\">properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">hibernate</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">format_sql</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n        <span class=\"token key atrule\">use_sql_comments</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token comment\"># 중요!!</span>\n    <span class=\"token key atrule\">database-platform</span><span class=\"token punctuation\">:</span> org.hibernate.spatial.dialect.postgis.PostgisDialect</code></pre></div>\n<br>\n<p>위에서 중요한 부분은 <code class=\"language-text\">spring.jpa.database-platform</code>이고, 이 부분은 Hibernate Spatial의 지리 함수를 썼을 때 PostGIS 함수로 매핑해주는 Dialect 설정이다.<br></p>\n<p>PostgreSQL 버전에 따라 Dialect가 다른데 이는 아래 링크에 첨부하겠다.<br></p>\n<blockquote>\n<p><a href=\"https://docs.jboss.org/hibernate/orm/5.4/javadocs/org/hibernate/spatial/dialect/postgis/package-summary.html\">Package org.hibernate.spatial.dialect.postgis</a></p>\n</blockquote>\n<br>\n<h3 id=\"-jpql로-작성한-gis-함수\" style=\"position:relative;\"><a href=\"#-jpql%EB%A1%9C-%EC%9E%91%EC%84%B1%ED%95%9C-gis-%ED%95%A8%EC%88%98\" aria-label=\" jpql로 작성한 gis 함수 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🔌 JPQL로 작성한 GIS 함수</h3>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>locationtech<span class=\"token punctuation\">.</span>jts<span class=\"token punctuation\">.</span>geom<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Point</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>persistence<span class=\"token punctuation\">.</span></span><span class=\"token operator\">*</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Test</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span>IDENTITY<span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"id\"</span><span class=\"token punctuation\">,</span> unique <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"gps\"</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Point</span> gps<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>우선 거리 계산을 위해 <code class=\"language-text\">Test</code> 엔티티를 작성해 주고, <code class=\"language-text\">Geometry</code> 타입인 Point 타입을 이용해 컬럼을 작성해 준다.<br></p>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">TestRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Test</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">/*\n        dwithin 함수는 반경(단위: m) 내에 존재하는지 boolean 값으로 응답함\n        4번째 인자는 평면에서 구할 것인지, 구에서 구할 것인지 정하는 flag로 false인 경우 구에서 거리를 계산함\n    */</span>\n    <span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"select t from Test t where dwithin(t.gps, :point, 30000, false) = true\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Test</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findTestByDistance</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"point\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Point</span> point<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>그 뒤 Repository에서 <code class=\"language-text\">JPQL</code>을 사용하여 where절에 GIS 함수인 <code class=\"language-text\">dwithin</code>을 사용해 데이터베이스에 저장된 좌표와의 거리계산을 통해 List로 응답을 받게 코드를 작성한다.<br></p>\n<blockquote>\n<p><a href=\"https://postgis.net/docs/ST_DWithin.html\">Dwithin이란? (PostGIS ST_Dwithin)</a></p>\n</blockquote>\n<br>\n<p>Hibernate에 정의된 내용에 따르면, 두 Geometry(Point)타입과 Double 형인 distance를 사용하여 두 좌표간 거리가 distance 내에 포함되는지 <code class=\"language-text\">boolean</code> 형태로 리턴해 주는 함수이다.<br></p>\n<blockquote>\n<p>distance 기준은 미터이다.</p>\n</blockquote>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAdklEQVQI142Oyw7CMBAD+/8/ilBKQvcVlTQZlCDOYGlk78Xe7b4X9iKEO2G2cHdOVVoE13XRW6P3zhjjJ9uen9xSQUQ/ZapEBK9ZNv086bUyWuMfbY+cSSmRcyaXwrxFBHNHVFGzlefXx3GgqpjZ8lrrGp988xsbSumY0vB3NQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"st_dwithin\"\n        title=\"st_dwithin\"\n        src=\"/static/a68d0b29d915d41cd0bffc681c533df6/37523/st_diwthin.png\"\n        srcset=\"/static/a68d0b29d915d41cd0bffc681c533df6/e9ff0/st_diwthin.png 180w,\n/static/a68d0b29d915d41cd0bffc681c533df6/f21e7/st_diwthin.png 360w,\n/static/a68d0b29d915d41cd0bffc681c533df6/37523/st_diwthin.png 720w,\n/static/a68d0b29d915d41cd0bffc681c533df6/302a4/st_diwthin.png 1080w,\n/static/a68d0b29d915d41cd0bffc681c533df6/07a9c/st_diwthin.png 1440w,\n/static/a68d0b29d915d41cd0bffc681c533df6/0a077/st_diwthin.png 3552w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>PostGIS description</p>\n</blockquote>\n<br>\n<p>위 레포지토리 코드를 보면, 4번째 인자로 boolean이 추가되었는데<br>\n이는 주석에 적혀있는 것처럼 <code class=\"language-text\">구</code>에서 거리 계산을 할 것인지, <code class=\"language-text\">평면</code>에서 계산할 것인지 나타내는 값으로 위도, 경도를 이용한 거리 계산이 필요하다면 <code class=\"language-text\">true</code>로 인자를 전달하면 된다.<br></p>\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-hibernate-spatial\">💽 Hibernate Spatial</a></p>\n<ul>\n<li><a href=\"#-%EC%96%B4%EB%96%A4-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4%EC%95%BC-%ED%95%A0%EA%B9%8C\">👈 어떤 데이터베이스를 사용해야 할까?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EF%B8%8F-postgresql-postgis-%EC%84%A4%EC%B9%98\">⬇️ PostgreSQL, PostGIS 설치</a></p>\n</li>\n<li>\n<p><a href=\"#%EF%B8%8F-hibernate-%EC%84%A4%EC%B9%98-%EB%B0%8F-%EC%84%A4%EC%A0%95\">✍️ Hibernate 설치 및 설정</a></p>\n<ul>\n<li><a href=\"#%EF%B8%8F-applicationyml-%EC%84%A4%EC%A0%95\">⚙️ application.yml 설정</a></li>\n<li><a href=\"#-jpql%EB%A1%9C-%EC%9E%91%EC%84%B1%ED%95%9C-gis-%ED%95%A8%EC%88%98\">🔌 JPQL로 작성한 GIS 함수</a></li>\n</ul>\n</li>\n</ul>\n</div>\n<br>\n<br>","frontmatter":{"date":"October 08, 2022","title":"Hibernate Spatial을 이용한 좌표간 거리계산 (feat. PostGIS, H2GIS)","categories":"Spring","author":"seongsu","emoji":"1️⃣9️⃣"},"fields":{"slug":"/skill/hibernate-spatial/"}},"prev":{"id":"94f7adbc-6e01-5de4-9ab6-ec5ad4add288","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+0lEQVQY05WQv06DcBSFeaP6OPVPog7Fh3DupJN9AYuLQ8WJlhRcTCo2GnGSNCgEE4GmlIWBWOD3GUisjXHxG+69yzn33CsJagSrogBR8U1ZlvxGCMFfVNWPTqrNXgs4nrko3gP5Z8F7EKBcKEzuJriuSxiGmKZJv39OnudkWUYURcznMXEcs0yX62VSXW6HT1wrl4wfu7wFL8idI3b3djg43Ke93UaWO/R6Z7S2Wti2je/72M825o2J4zhMp/frCxrDavbB4uQUFgarPEdVVUajIbquM7gaYBjjRqxpGp7nkaZp0y3LasyTJNlIKAT1WCGo+B+bv6sN64RfjVxpHTpdz60AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack api\"\n        title=\"slack api\"\n        src=\"/static/44d3f86e4c5ad7b41d7f00f4edfd1b34/37523/slack_api.png\"\n        srcset=\"/static/44d3f86e4c5ad7b41d7f00f4edfd1b34/e9ff0/slack_api.png 180w,\n/static/44d3f86e4c5ad7b41d7f00f4edfd1b34/f21e7/slack_api.png 360w,\n/static/44d3f86e4c5ad7b41d7f00f4edfd1b34/37523/slack_api.png 720w,\n/static/44d3f86e4c5ad7b41d7f00f4edfd1b34/1d69c/slack_api.png 750w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<p>서버를 운영하다 보면, 예상치 못한 문제에 직면할 때가 많을 것이다.<br>\n서버가 죽는다던지, 특정 로직에서 오류가 발생하는 등 하루종일 서버를 관찰하지 않는 이상 즉각적인 대응은 힘들 것이다.<br>\n이런 <code class=\"language-text\">Critical한 Issue</code>를 대응하기 위해 Slack을 모니터링 알림으로 사용해 보고자 한다.<br></p>\n<blockquote>\n<p>Slack web hook을 이용해야 해서 다음 글을 참고하면 도움이 될 듯 하다.</p>\n</blockquote>\n<ul>\n<li><a href=\"https://jojoldu.tistory.com/552\">Slack Webhook API 생성하기</a></li>\n<li><a href=\"https://api.slack.com/messaging/webhooks\">Sending messages using Incoming Webhooks</a></li>\n</ul>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token operator\">...</span>\n\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"에러 발생!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">...</span></code></pre></div>\n<br>\n<p>예시를 위해 일부러 Error를 throw 했는데, 직접 핸들링 하는 Error가 아니라 <code class=\"language-text\">코드 에러</code>, <code class=\"language-text\">DB 에러</code>, <code class=\"language-text\">비동기 에러</code> 등 당장 처리할 수 없는 Error에 대해 모니터링 프로세스를 통해 빠른 대응으로 안정적인 서비스를 운영할 수 있어야 한다.<br></p>\n<br>\n<h2 id=\"️-error-handling\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-error-handling\" aria-label=\"️ error handling permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✍️ Error Handling</h2>\n<br>\n<p>모니터링 프로세스를 놓던, 로깅을 하던 일단 에러에 대해 Handling 할 수 있어야 한다.<br>\n<code class=\"language-text\">Framework</code>단에서 지원하는 Filter가 있다면 상관없지만, 싱글 스레드로 동작하는 Node.js에겐 Error Handling이 잘 이루어져야 한다.<br></p>\n<blockquote>\n<p>비동기 로직은 메인 스레드가 아닌 스레드로 돌아가기 때문에 적절한 처리가 안된다면 프로세스가 죽는다.</p>\n</blockquote>\n<br>\n<ul>\n<li><a href=\"https://seongsu.me/skill/express-error-middleware/\">Express로 구현한 비동기 Error Handling</a></li>\n</ul>\n<br>\n<h2 id=\"-슬랙봇을-이용한-error-모니터링\" style=\"position:relative;\"><a href=\"#-%EC%8A%AC%EB%9E%99%EB%B4%87%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-error-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81\" aria-label=\" 슬랙봇을 이용한 error 모니터링 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🤖 슬랙봇을 이용한 Error 모니터링</h2>\n<br>\n<p>슬랙봇을 통해 모니터링을 하기 위해서, Error 발생 지점(trace), Error Message, Date time 등이 필요할 텐데, 여기에 마크다운을 이용한 디자인 매핑을 하게 되면, 보기 좋은 에러 알림이 될 것이다.<br></p>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">Field</span> <span class=\"token punctuation\">{</span>\n  title<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  value<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">;</span>\n  short<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">Block</span> <span class=\"token punctuation\">{</span>\n  type<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  text<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">SlackTextBuilder</span> <span class=\"token punctuation\">{</span>\n  color<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  pretext<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  fields<span class=\"token operator\">:</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span>Field<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n  blocks<span class=\"token operator\">:</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span>Block<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> color<span class=\"token punctuation\">,</span> pretext <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> Partial<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">{</span> color<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> pretext<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> color <span class=\"token operator\">||</span> <span class=\"token string\">\"#2eb886\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pretext <span class=\"token operator\">=</span> pretext <span class=\"token operator\">||</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fields <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>blocks <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">addField</span><span class=\"token punctuation\">(</span>field<span class=\"token operator\">:</span> Field<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>field<span class=\"token punctuation\">.</span>short <span class=\"token operator\">===</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      field<span class=\"token punctuation\">.</span>short <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>field<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">addBlock</span><span class=\"token punctuation\">(</span>block<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>blocks<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>block<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      as_user<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      attachments<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n          color<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">,</span>\n          pretext<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pretext<span class=\"token punctuation\">,</span>\n          fields<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      blocks<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>blocks<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p><a href=\"https://api.slack.com/messaging/composing/layouts\">여기</a>에서 볼 수 있는데, 위 클래스의 <code class=\"language-text\">toJSON</code> 부분을 이해하는 것이 중요하다!</p>\n</blockquote>\n<br>\n<p>슬랙 포매팅을 위한 클래스를 제작해 주고, 여기에 필요한 데이터를 넣으면 될 듯하다.<br>\n대략 위 코드를 설명하자면 다음과 같다.<br></p>\n<ul>\n<li>Field: 자잘한 정보들이 병렬적으로 들어갈 부분</li>\n<li>Block: Layer 단위로 정보들이 수직적으로 들어갈 부분</li>\n</ul>\n<br>\n<blockquote>\n<p>슬랙 메세지 포맷에 대한 정보는 다음 사이트에서 찾아볼 수 있다.</p>\n</blockquote>\n<ul>\n<li><a href=\"https://api.slack.com/messaging/composing/layouts\">Creating rich message layouts</a></li>\n<li><a href=\"https://api.slack.com/reference/surfaces/formatting\">Formatting text for app surfaces</a></li>\n</ul>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">errorFormat</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>message<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> stack<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> builder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SlackTextBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  builder\n    <span class=\"token punctuation\">.</span><span class=\"token function\">addField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      title<span class=\"token operator\">:</span> <span class=\"token string\">\"APP_NAME\"</span><span class=\"token punctuation\">,</span>\n      value<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\`Monitering test\\`</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">addField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      title<span class=\"token operator\">:</span> <span class=\"token string\">\"TIME_STAMP\"</span><span class=\"token punctuation\">,</span>\n      value<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\`</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">addBlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      type<span class=\"token operator\">:</span> <span class=\"token string\">\"header\"</span><span class=\"token punctuation\">,</span>\n      text<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        type<span class=\"token operator\">:</span> <span class=\"token string\">\"plain_text\"</span><span class=\"token punctuation\">,</span>\n        text<span class=\"token operator\">:</span> message<span class=\"token punctuation\">,</span>\n        emoji<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">addBlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      type<span class=\"token operator\">:</span> <span class=\"token string\">\"section\"</span><span class=\"token punctuation\">,</span>\n      text<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        type<span class=\"token operator\">:</span> <span class=\"token string\">\"mrkdwn\"</span><span class=\"token punctuation\">,</span>\n        text<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\`\\`\\`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>stack<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\`\\`\\`</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> builder<span class=\"token punctuation\">.</span><span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">slackError</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>error<span class=\"token operator\">:</span> IError<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> body <span class=\"token operator\">=</span> <span class=\"token function\">errorFormat</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span>env<span class=\"token punctuation\">.</span>slackConfig<span class=\"token punctuation\">.</span>errorUri<span class=\"token punctuation\">,</span> body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<p>위와 같은 방식으로 <code class=\"language-text\">Slack message formatter</code> 클래스의 인스턴스를 생성한 뒤, JSON 형태로 <code class=\"language-text\">Body</code>에 담아 앞전에 생성한 <code class=\"language-text\">Incoming Webhook url</code>에 전송하면 해당 슬랙 채널에 메세지가 전송되게 된다.<br></p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABwUlEQVQoz42S2W6cQBBF+YvEHjDD2oCh2Zqm2cdjK4qU//+eG1URkC3PQx6uSr2dulXVVlG2WNY7puUN03LDr99/UDUdtrcPKD3CfvHxbF//W1YQpUgyCS8QX+SHCcerH8P1ooeis896uYY7kFxWjUZZd5CVQi4b1K1Gowzv016c5KxIvHIUaQF6eyiMM4ZadKHtBi532d6xbHes2zsa1bMIRucErtv+TCDLlqs4RFAGhlHKD8f5xjAS9dOMK4ZpQ1kryKo93b8WNcpKsVOCHPEEUi/IPg2ARG66fmKg0gOvCUggUlE23BJqEyWhhElWsMvTIZWizQwzLgzrhwVmWDBMKydp2p4BpCyvGCjS/Bzel5ID6qEy6IcZ03xjZ9vtA+O8YV7v0GbiAZGTwxWVTr2k33HAzqEUXrhfqjuIVPLo92+xR1rTo1zuPyHN9jvk7jg/5LgBrMVxMasaRiu0VQnPC/Dj2cXTxcXPyx4vjg/d1ihyyRD6wLT/8GPPtou51xgHg9EYRGHIUM/bI12izKbXKP9Nm8rbE3nfZEnbhUxj5KlAkQrkSYxUxEjiGCKK8GRfYTseMhHBcf3zISV6BPwLioBmYy852OMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"monitering\"\n        title=\"monitering\"\n        src=\"/static/08869197813c78e79d7144c02f008d81/37523/monitering.png\"\n        srcset=\"/static/08869197813c78e79d7144c02f008d81/e9ff0/monitering.png 180w,\n/static/08869197813c78e79d7144c02f008d81/f21e7/monitering.png 360w,\n/static/08869197813c78e79d7144c02f008d81/37523/monitering.png 720w,\n/static/08869197813c78e79d7144c02f008d81/302a4/monitering.png 1080w,\n/static/08869197813c78e79d7144c02f008d81/0d98f/monitering.png 1276w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>위와 같은 메세지 포맷을 사용하면 다음과 같이 슬랙에 메세지가 전송될 것이다.<br></p>\n<br>\n<p>이를 통해 Latency 측정, Error 모니터링 등 상황에 맞게 여러 방면으로 실시간 서버 모니터링이 가능하니, 활용만 잘 하면 될 듯 하다.<br></p>\n<br>\n<h2 id=\"-참고-자료\" style=\"position:relative;\"><a href=\"#-%EC%B0%B8%EA%B3%A0-%EC%9E%90%EB%A3%8C\" aria-label=\" 참고 자료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📚 참고 자료</h2>\n<blockquote>\n<p>Sending messages using Incoming Webhooks</p>\n</blockquote>\n<ul>\n<li><a href=\"https://api.slack.com/messaging/webhooks\">https://api.slack.com/messaging/webhooks</a></li>\n</ul>\n<br>\n<blockquote>\n<p>Slack Webhook API 생성하기</p>\n</blockquote>\n<ul>\n<li><a href=\"https://jojoldu.tistory.com/552\">https://jojoldu.tistory.com/552</a></li>\n</ul>\n<br>\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EF%B8%8F-error-handling\">✍️ Error Handling</a></li>\n<li><a href=\"#-%EC%8A%AC%EB%9E%99%EB%B4%87%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-error-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81\">🤖 슬랙봇을 이용한 Error 모니터링</a></li>\n<li><a href=\"#-%EC%B0%B8%EA%B3%A0-%EC%9E%90%EB%A3%8C\">📚 참고 자료</a></li>\n</ul>\n</div>","frontmatter":{"date":"October 09, 2022","title":"Slack을 서버 오류 알림으로 사용해 보자","categories":"Node.js 기타","author":"seongsu","emoji":"1️⃣6️⃣"},"fields":{"slug":"/skill/slack-monitering/"}},"site":{"siteMetadata":{"siteUrl":"https://seongsu.me","comments":{"utterances":{"repo":"nfl1ryxditimo12/nfl1ryxditimo12.github.io"}}}}},"pageContext":{"slug":"/skill/latency-strategy/","nextSlug":"/skill/hibernate-spatial/","prevSlug":"/skill/slack-monitering/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}