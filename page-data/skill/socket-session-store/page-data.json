{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/skill/socket-session-store/",
    "result": {"data":{"cur":{"id":"f341528a-1f5b-52f8-9ab1-c0b4084437af","html":"","excerpt":"","frontmatter":{"date":"Invalid date","title":"NestJS Socket session store","categories":"Node.js NestJS","author":"seongsu","emoji":"1️⃣3️⃣"},"fields":{"slug":"/skill/socket-session-store/"}},"next":{"id":"122a4296-ace7-5c97-8a62-55037352a874","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABM0lEQVQoz41SO07DQBT0BZCAJJj39ueP7EBkLIQEBTQUIAWRIBHRQIWUnoaSe0DDCSJKjkCRgpIrcAP6QbuxowWZhGK0o1nvvBnvBpss4UCzNSSBWqNK97VlCGoS2oMsnInFBgmsE8+H+KZNPPQN5x+QxAqRQ8wG+5yjXZlSA5oGBH5cm2ogu3iJTvCqhpioIXY4RYsYLRJYI57Dpm/X6RoNq8pPyQGm6Sk+kxHezQjPsg/DCtd6C+cqx5nK0FcZLlSOG70N0WQYepNsmlIYTNJDfGWXeIsGKDjGWPdwZwrcmxJXquv4re6BF1Wuaz9EJR6TPXzkxxjrwtWNWUGyRMQKuuIWfxr64ioxdkWEI5k4bvc6JNyweq0R/vqPPxI6kWY32Kkugf7x9hZW9kENB5Y97G8YIhP9LicF3gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"nestjs_logo\"\n        title=\"nestjs_logo\"\n        src=\"/static/6222f56890d651903c0e685b8ec265b2/37523/nestjs_logo.png\"\n        srcset=\"/static/6222f56890d651903c0e685b8ec265b2/e9ff0/nestjs_logo.png 180w,\n/static/6222f56890d651903c0e685b8ec265b2/f21e7/nestjs_logo.png 360w,\n/static/6222f56890d651903c0e685b8ec265b2/37523/nestjs_logo.png 720w,\n/static/6222f56890d651903c0e685b8ec265b2/76cea/nestjs_logo.png 799w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<h2 id=\"-횡단-관심사-란\" style=\"position:relative;\"><a href=\"#-%ED%9A%A1%EB%8B%A8-%EA%B4%80%EC%8B%AC%EC%82%AC-%EB%9E%80\" aria-label=\" 횡단 관심사 란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🤝 횡단 관심사 란?</h2>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 548px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACSElEQVQoz12S608aARDE7///1qQfEKSIAh5VpMhTojwOOEUUKxW4giA9kBN5COgBUrhfA9rUdJNJdjaZzWR3BAP4CAwD4x2rvtUeUCg2aKhdFosFlVp7zTvdEZPJDKXapqQ0GQ71lRqBdyF/l/GvVv2JfMdnewr/icJkvsTlu1rzbOEerfeM3ZNnw3XGz7v+28Jxu83w4YFes8ny6QmmU7TCJaoUpXeRIuf1I4lBTvd8tOU4abcPSQxwHQhSj0dJuf0kXT7K0QjzyTNCuVyipChovR5GrwfNFmomgRI6QEsdkRX3iNlEMk43aiyEtC2ued7joRo5JGF3E7Pt8sP/jdnzCCH3UCLbUdCNOeg6xmzGoF7l8TpHv5gn/S1K0BEmvhdBuzonuhsiuBPmInxCTU4TcYUJ7AS5iSdZvE4RhrMxv1myXN2s24Vmk0rkkO8uC83wPtmtLyRNm8hWK/VDkbR5k4Rpk7xjC8XjQDJbSZosXIs76MM+QqJzzf108PaElxeYzRhrLbqVEt1qmXhA4sAV48gb50EpEvgaw+OMcXYsU8tf4RPjeJzHFDI5jMUcodi75XbUeotNpwOqSiXk5cz6icttEznbJukNC+dWC798Lk4tFtIrRw4b1f0dZPOKm7kR7ehPfYTFyzPLiY6h6/D6unaqj0eMOxrjR41QMMfWtoz34JSOqiKKGWz2DFL8imqxgsMpY7OnyJ8XgSUC/+XOWC4/jsjftDmS6pzmVeYLg2S2QUSqU651GYwmnMgNjqQaTW24zuEf4sq6bQDNXssAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"횡단 관심사\"\n        title=\"횡단 관심사\"\n        src=\"/static/6c4e696c10c5c42e48b39d54735ad275/a58fe/cross-cutting.png\"\n        srcset=\"/static/6c4e696c10c5c42e48b39d54735ad275/e9ff0/cross-cutting.png 180w,\n/static/6c4e696c10c5c42e48b39d54735ad275/f21e7/cross-cutting.png 360w,\n/static/6c4e696c10c5c42e48b39d54735ad275/a58fe/cross-cutting.png 548w\"\n        sizes=\"(max-width: 548px) 100vw, 548px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>비즈니스 로직의 핵심 기능이 아닌, 프로세스 중간에 삽입되는 기능을 말한다.<br>\n위 사진처럼 프로세스마다 공통되는 기능을 <code class=\"language-text\">횡단 관심사</code>라고 부르며, 이러한 관심사들의 분리는 <code class=\"language-text\">AOP</code>, 즉 관점 지향 프로그래밍에서 모듈성을 증가시키기 위한 패터다임이다.<br></p>\n<br>\n<h3 id=\"-aop의-주요-개념\" style=\"position:relative;\"><a href=\"#-aop%EC%9D%98-%EC%A3%BC%EC%9A%94-%EA%B0%9C%EB%85%90\" aria-label=\" aop의 주요 개념 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🗿 AOP의 주요 개념</h3>\n<br>\n<ul>\n<li>Aspect : 위에서 설명한 <code class=\"language-text\">횡단 관심사</code>를 모듈화 한 것이다.</li>\n<li>Target : Aspect를 적용하는 곳이다.</li>\n<li>Advice : 실질적인 부가기능을 담은 구현체이다.</li>\n<li>JointPoint : <code class=\"language-text\">Advice가 적용될 위치</code>로 필드에서 값을 꺼내올 때 등 다양한 시점에 적용 가능하다.</li>\n<li>PointCut : <code class=\"language-text\">JointPoint의 상세한 스펙</code>을 정의한 것으로 Advice가 실행될 지점을 정할 수 있음</li>\n</ul>\n<br>\n<h3 id=\"-nestjs의-interceptor-란\" style=\"position:relative;\"><a href=\"#-nestjs%EC%9D%98-interceptor-%EB%9E%80\" aria-label=\" nestjs의 interceptor 란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>👽 NestJS의 Interceptor 란?</h3>\n<br>\n<p>NestJS는 <code class=\"language-text\">AOP(Aspect Oriented Programing)</code>에서 영감을 받은 Interceptor를 다음과 같은 5가지의 예시를 들며 강조하고 있다.<br></p>\n<ul>\n<li>메서드 실행 전후에 추가 논리 바인딩</li>\n<li>함수에서 반환된 결과를 변환</li>\n<li>함수에서 throw된 예외를 변환</li>\n<li>기본 기능 동작 확장</li>\n<li>특정 조건에 따라 함수를 완전히 재정의 (예: 캐싱 목적)</li>\n</ul>\n<br>\n<p>NestJS 요청 - 응답 생명주기를 봤을 때 Controller 로직 전/후로 동작을 수행하는 기능이다.<br>\n여기서 위 1번 기능으로 <code class=\"language-text\">JointPoint</code>를 지정해 관심사 분리를 진행할 예정이다.<br></p>\n<br>\n<h2 id=\"-횡단-관심사-분리\" style=\"position:relative;\"><a href=\"#-%ED%9A%A1%EB%8B%A8-%EA%B4%80%EC%8B%AC%EC%82%AC-%EB%B6%84%EB%A6%AC\" aria-label=\" 횡단 관심사 분리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🪢 횡단 관심사 분리</h2>\n<br>\n<p>예를들어 채팅방을 구현한다 가정을 해보자.<br>\n방장이 존재할 것이며, 방장은 <code class=\"language-text\">mute</code>, <code class=\"language-text\">ban</code>, <code class=\"language-text\">invite</code>의 기능을 수행할 수 있다.<br>\n유저는 <code class=\"language-text\">chat</code>, <code class=\"language-text\">DM</code>, <code class=\"language-text\">block</code>의 기능을 사용할 수 있다.<br>\n그전에 일단 해당 채팅방에 참여하고 있어야 한다.<br>\n이를 통해 위 AOP의 <code class=\"language-text\">Aspect</code>를 정의해 보면 <code class=\"language-text\">채팅방</code>, <code class=\"language-text\">채팅</code>으로 구분할 수 있다.<br></p>\n<br>\n<p><code class=\"language-text\">채팅방</code>에서는 <strong>채팅방 존재 여부</strong>, <strong>방장 권한</strong>, <strong>채팅방 참여 가능 여부</strong>로 나눌 수 있고, <code class=\"language-text\">채팅</code>에서는 <strong>mute 여부</strong>, <strong>block 여부</strong>로 나눌 수 있다.<br></p>\n<br>\n<h3 id=\"-관점을-기준으로-분리해-보자\" style=\"position:relative;\"><a href=\"#-%EA%B4%80%EC%A0%90%EC%9D%84-%EA%B8%B0%EC%A4%80%EC%9C%BC%EB%A1%9C-%EB%B6%84%EB%A6%AC%ED%95%B4-%EB%B3%B4%EC%9E%90\" aria-label=\" 관점을 기준으로 분리해 보자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🕸 관점을 기준으로 분리해 보자</h3>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Client</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Socket</span> <span class=\"token punctuation\">{</span>\n  hasChannel<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">;</span>\n  isAdmin<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">;</span>\n  isMuted<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 채팅방 Interceptor</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ChannelAuthInterceptor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">NestInterceptor</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> requiredAdmin<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>param<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>requiredAdmin <span class=\"token operator\">=</span> param<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">intercept</span><span class=\"token punctuation\">(</span>context<span class=\"token operator\">:</span> ExecutionContext<span class=\"token punctuation\">,</span> next<span class=\"token operator\">:</span> CallHandler<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>Observable<span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">>></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// Socket Gateway 기반으로 구현된 사항 입니다.</span>\n    <span class=\"token keyword\">const</span> client<span class=\"token operator\">:</span> Client <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">switchToWs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 1. 채팅방에 존재하지 않는 경우 Exception</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>client<span class=\"token punctuation\">.</span>hasChannel<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ForbiddenException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 2. 방장 권한이 없는 경우 Exception</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>client<span class=\"token punctuation\">.</span>isAdmin <span class=\"token operator\">&amp;&amp;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>requiredAdmin<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ForbiddenException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 채팅 Interceptor</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ChannelMessageInterceptor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">NestInterceptor</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">intercept</span><span class=\"token punctuation\">(</span>context<span class=\"token operator\">:</span> ExecutionContext<span class=\"token punctuation\">,</span> next<span class=\"token operator\">:</span> CallHandler<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>Observable<span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">>></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">const</span> client<span class=\"token operator\">:</span> Client <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">switchToWs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 3. 방장에게 채팅 차단을 당한 경우 Exception</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>client<span class=\"token punctuation\">.</span>isMuted<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ForbiddenException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>위에 예시로 적은 모든 기능들을 코드화 하진 않았지만, 위와 같이 <code class=\"language-text\">채팅방</code>, <code class=\"language-text\">채팅</code>으로 관점을 Interceptor로 분리하고, 세부적인 기능을 조건문으로 조정할 수 있다.<br></p>\n<br>\n<h3 id=\"-pointcut\" style=\"position:relative;\"><a href=\"#-pointcut\" aria-label=\" pointcut permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🎯 PointCut</h3>\n<br>\n<p>클래스, 메서드 어느 곳이던 위 <code class=\"language-text\">Interceptor</code>를 적용할 수 있다.<br>\n위 예시는 채팅방이니, <code class=\"language-text\">Gateway</code>의 메서드 하나에 적용해 보도록 하겠다.<br></p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> ChannelAuthInterceptor <span class=\"token keyword\">from</span> <span class=\"token string\">'@Interceptor/channel'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">WebSocketGateway</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SocketGateway</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">OnGatewayConnection</span><span class=\"token punctuation\">,</span> OnGatewayDisconnect <span class=\"token punctuation\">{</span>\n\n  <span class=\"token comment\">/* ... */</span>\n\n  <span class=\"token comment\">// ⬇️ 이곳이 PointCut이 된다.</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">UseInterceptors</span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelAuthInterceptor</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">SubscribeMessage</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'muteUser'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">muteUser</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">ConnectedSocket</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> client<span class=\"token operator\">:</span> ClientInstance<span class=\"token punctuation\">,</span> <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">MessageBody</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'userId'</span><span class=\"token punctuation\">)</span> userId<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* Business Logic */</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>위처럼 필요한 메서드에 <code class=\"language-text\">@UseInterceptors</code> 데코레이터를 사용하여 <code class=\"language-text\">Interceptor</code>를 적용할 수 있다.<br>\n필요에 따라, 여러 관심사들을 <code class=\"language-text\">Interceptor</code>로 묶어 <code class=\"language-text\">횡단 관심사 분리</code>를 진행할 수 있다.<br></p>\n<br>\n<p>이로인해 AOP의 주요 목적인 <code class=\"language-text\">관심사</code>들의 모듈화를 하게 되어, 유지보수성이 높은 코드를 짤 수 있게 된다.<br></p>\n<br>\n<h3 id=\"-interceptor로-할-수-있는-것들\" style=\"position:relative;\"><a href=\"#-interceptor%EB%A1%9C-%ED%95%A0-%EC%88%98-%EC%9E%88%EB%8A%94-%EA%B2%83%EB%93%A4\" aria-label=\" interceptor로 할 수 있는 것들 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🧩 Interceptor로 할 수 있는 것들</h3>\n<br>\n<p>Interceptor만 잘 이용하면 여러 기능을 구현할 수 있다.<br>\nHTTP 통신 라우터라면 throw 컨트롤, 메서드 로깅, 요청값 변경, 유효성 검사 등 여러 기능을 수행할 수 있다.<br></p>\n<br>\n<p>이외에 <code class=\"language-text\">Socket Gateway</code>라면 NestJS에서 지원하지 않는 <code class=\"language-text\">Socket Message Body</code>의 유효성 검사가 가능하다.<br>\n이 부분은 <code class=\"language-text\">ValidationPipe</code>로 진행할 수 있다고 생각할 수 있는데, <code class=\"language-text\">ValidationPipe</code>는 정상적으로 들어온 인자에 대해 검사를 진행하기 때문에, 애초에 <code class=\"language-text\">undefined</code>로 들어온 인자는 검사 자체를 안한다.<br>\n이는 서버 운영에 치명적인 결과를 낳을 수 있지만 <code class=\"language-text\">Interceptor</code>만 잘 활용하면 해결 가능한 문제이다.<br></p>\n<br>\n<h2 id=\"-참고-자료\" style=\"position:relative;\"><a href=\"#-%EC%B0%B8%EA%B3%A0-%EC%9E%90%EB%A3%8C\" aria-label=\" 참고 자료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📚 참고 자료</h2>\n<br>\n<blockquote>\n<p>NestJS Docs</p>\n</blockquote>\n<ul>\n<li><a href=\"https://nestjs.com\">https://nestjs.com</a></li>\n</ul>\n<br>\n<blockquote>\n<p>AOP 주요 개념</p>\n</blockquote>\n<ul>\n<li><a href=\"https://engkimbs.tistory.com/746\">https://engkimbs.tistory.com/746</a></li>\n</ul>\n<br>\n<h2 id=\"-github-주소\" style=\"position:relative;\"><a href=\"#-github-%EC%A3%BC%EC%86%8C\" aria-label=\" github 주소 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🧑‍💻 Github 주소</h2>\n<br>\n<ul>\n<li><a href=\"https://github.com/mtak0235/simmons_transcendence/blob/main/backend/node/app/src/socket/interceptor/channel.socket.interceptor.ts\">이 글을 쓰게 된 계기</a></li>\n</ul>\n<br/>\n<br/>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-%ED%9A%A1%EB%8B%A8-%EA%B4%80%EC%8B%AC%EC%82%AC-%EB%9E%80\">🤝 횡단 관심사 란?</a></p>\n<ul>\n<li><a href=\"#-aop%EC%9D%98-%EC%A3%BC%EC%9A%94-%EA%B0%9C%EB%85%90\">🗿 AOP의 주요 개념</a></li>\n<li><a href=\"#-nestjs%EC%9D%98-interceptor-%EB%9E%80\">👽 NestJS의 Interceptor 란?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%ED%9A%A1%EB%8B%A8-%EA%B4%80%EC%8B%AC%EC%82%AC-%EB%B6%84%EB%A6%AC\">🪢 횡단 관심사 분리</a></p>\n<ul>\n<li><a href=\"#-%EA%B4%80%EC%A0%90%EC%9D%84-%EA%B8%B0%EC%A4%80%EC%9C%BC%EB%A1%9C-%EB%B6%84%EB%A6%AC%ED%95%B4-%EB%B3%B4%EC%9E%90\">🕸 관점을 기준으로 분리해 보자</a></li>\n<li><a href=\"#-pointcut\">🎯 PointCut</a></li>\n<li><a href=\"#-interceptor%EB%A1%9C-%ED%95%A0-%EC%88%98-%EC%9E%88%EB%8A%94-%EA%B2%83%EB%93%A4\">🧩 Interceptor로 할 수 있는 것들</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EC%B0%B8%EA%B3%A0-%EC%9E%90%EB%A3%8C\">📚 참고 자료</a></p>\n</li>\n<li>\n<p><a href=\"#-github-%EC%A3%BC%EC%86%8C\">🧑‍💻 Github 주소</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"September 25, 2022","title":"NestJS Interceptor를 이용한 횡단 관심사 분리","categories":"Node.js NestJS","author":"seongsu","emoji":"1️⃣2️⃣"},"fields":{"slug":"/skill/nestjs-aop/"}},"prev":{"id":"98902d3c-e3ed-5e39-b45b-d44536d6e2b1","html":"","frontmatter":{"date":"October 08, 2022","title":"프랑스 - 한국 간 Latency 단축 전략","categories":"Node.js Express","author":"seongsu","emoji":"1️⃣4️⃣"},"fields":{"slug":"/skill/latency-strategy/"}},"site":{"siteMetadata":{"siteUrl":"https://seongsu.me","comments":{"utterances":{"repo":"nfl1ryxditimo12/nfl1ryxditimo12.github.io"}}}}},"pageContext":{"slug":"/skill/socket-session-store/","nextSlug":"/skill/nestjs-aop/","prevSlug":"/skill/latency-strategy/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}