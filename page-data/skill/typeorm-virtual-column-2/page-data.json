{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/skill/typeorm-virtual-column-2/",
    "result": {"data":{"cur":{"id":"e8766f3e-fca1-57fa-a86f-a302076eee1f","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABIklEQVQoz5WST0/CQBDF+9U9EWMgGEhM/ATejCetXLl556DZGv4WUiBuaCnddudn2gUsiRGcZHY3b2fevJldj9JEqg2rIf6gbrJ5LxekHveHeSKCFHmVIP4dol7YZBb9tXYk6hl5vXf3RY61tvIqr+aunuBVh3xP2Glj1YhVkrAIQ7ZlcDBCOrdnlR1IvSN7WbVxhSwj5qsV08mExBiKRQjNBlEU0e/36fV6+L6P1rryOI5PFR5ll0D7BjsPWccxyyhis9tRhFNoXZNZIZzN+AwCBoMBSZKQpinGmN9aNo6w20SUYq414+GQrMSUQrqtQ2OXtSy2cODbAxI8YQSydOsig0eH/+dRTornula1VK+58Mc4hRxnWJtlDftpZ6/kDPM3H6637KPjZfIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"typeorm.png\"\n        title=\"typeorm.png\"\n        src=\"/static/e4b90acf02bd52801818ca0004fdd1f1/37523/typeorm.png\"\n        srcset=\"/static/e4b90acf02bd52801818ca0004fdd1f1/e9ff0/typeorm.png 180w,\n/static/e4b90acf02bd52801818ca0004fdd1f1/f21e7/typeorm.png 360w,\n/static/e4b90acf02bd52801818ca0004fdd1f1/37523/typeorm.png 720w,\n/static/e4b90acf02bd52801818ca0004fdd1f1/00d43/typeorm.png 1000w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br/>\n<h2 id=\"ullia-hrefhttpsseongsumetypeorm-virtual-column-1-target_blanktypeorm-virtual-column-설정-1aliul\" style=\"position:relative;\"><a href=\"#ullia-hrefhttpsseongsumetypeorm-virtual-column-1-target_blanktypeorm-virtual-column-%EC%84%A4%EC%A0%95-1aliul\" aria-label=\"ullia hrefhttpsseongsumetypeorm virtual column 1 target_blanktypeorm virtual column 설정 1aliul permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><ul><li><a href=\"https://seongsu.me/typeorm-virtual-column-1\" target=\"_blank\">Typeorm Virtual Column 설정 (1)</a></li></ul></h2>\n<br/>\n<br/>\n<p>이전 포스팅에서 <code class=\"language-text\">getMany()</code>함수와 <code class=\"language-text\">getRawMany()</code>함수의 차이점을 알아보게 되었는데<br/>\n이번 포스팅에선 가상컬럼을 사용하며 join시 위 함수의 문제와 해결법을 포스팅 해보려 한다.<br/></p>\n<br/>\n<h2 id=\"-custom-virtual-column을-사용해야-하는-이유\" style=\"position:relative;\"><a href=\"#-custom-virtual-column%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%B4%EC%95%BC-%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0\" aria-label=\" custom virtual column을 사용해야 하는 이유 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>😵‍💫 Custom Virtual Column을 사용해야 하는 이유</h2>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// station id 1 주변 맛집</span>\n<span class=\"token punctuation\">[</span>\n    Shops <span class=\"token punctuation\">{</span>\n        id<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        stationId<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        shopName<span class=\"token operator\">:</span> <span class=\"token string\">\"동찬이네\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    Shops <span class=\"token punctuation\">{</span>\n        id<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        stationId<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        shopName<span class=\"token operator\">:</span> <span class=\"token string\">\"사왕이네\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    Shops <span class=\"token punctuation\">{</span>\n        id<span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n        stationId<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        shopName<span class=\"token operator\">:</span> <span class=\"token string\">\"승한이네\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\">// station id 2 주변 맛집</span>\n<span class=\"token punctuation\">[</span>\n    Shops <span class=\"token punctuation\">{</span>\n        id<span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span>\n        stationId<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        shopName<span class=\"token operator\">:</span> <span class=\"token string\">\"크래프트 한스\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    Shops <span class=\"token punctuation\">{</span>\n        id<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n        stationId<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        shopName<span class=\"token operator\">:</span> <span class=\"token string\">\"큰통치킨\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    Shops <span class=\"token punctuation\">{</span>\n        id<span class=\"token operator\">:</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span>\n        stationId<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        shopName<span class=\"token operator\">:</span> <span class=\"token string\">\"BBQ\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<br/>\n<p>예를들어 위처럼 버스 정류소와 주변 맛집이 정류소 pk를 통해 foreign key로 연결이 되어있다 가정해 보자.<br/></p>\n<br/>\n<p>이렇게 정류소와 주변 맛집의 관계가 맺어져 있는 상황에서 현재 거리 기준 2km 이내 정류소 주변 맛집을 조회하는 쿼리를 실행하면 어떻게 될까?<br/></p>\n<br/>\n<h3 id=\"span-stylecolor-redgetrawmany의-문제span\" style=\"position:relative;\"><a href=\"#span-stylecolor-redgetrawmany%EC%9D%98-%EB%AC%B8%EC%A0%9Cspan\" aria-label=\"span stylecolor redgetrawmany의 문제span permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><span style=\"color: red\">getRawMany()의 문제</span></h3>\n<p>지금 보니 <code class=\"language-text\">getRawMany()</code>함수를 사용하니 가상 컬럼 효과를 낸 것 같은데 해결된거 아니냐? 할 수 있다.<br/>\n그런데 문제는 지금부터이다. 여기서 <code class=\"language-text\">inner join</code> 또는 <code class=\"language-text\">left join</code>을 할 경우<br/></p>\n<br/>\n<p><code class=\"language-text\">getRawMany()함수로 join &amp; 가상컬럼</code></p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token punctuation\">[</span>\n    Stations <span class=\"token punctuation\">{</span>\n        stations_id<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        stations_station<span class=\"token operator\">:</span> <span class=\"token string\">\"동대문역 2번출구 정류소\"</span><span class=\"token punctuation\">,</span>\n        stations_latitude<span class=\"token operator\">:</span> <span class=\"token number\">37.57198805</span><span class=\"token punctuation\">,</span>\n        stations_longitude<span class=\"token operator\">:</span> <span class=\"token number\">127.0117451</span><span class=\"token punctuation\">,</span>\n        shops_id<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        shops_stationId<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        shops_shopName<span class=\"token operator\">:</span> <span class=\"token string\">\"동찬이네\"</span><span class=\"token punctuation\">,</span>\n        distance<span class=\"token operator\">:</span> <span class=\"token number\">0.4228400907307967</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    Stations <span class=\"token punctuation\">{</span>\n        stations_id<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        stations_station<span class=\"token operator\">:</span> <span class=\"token string\">\"동대문역 2번출구 정류소\"</span><span class=\"token punctuation\">,</span>\n        stations_latitude<span class=\"token operator\">:</span> <span class=\"token number\">37.57198805</span><span class=\"token punctuation\">,</span>\n        stations_longitude<span class=\"token operator\">:</span> <span class=\"token number\">127.0117451</span><span class=\"token punctuation\">,</span>\n        shops_id<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        shops_stationId<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        shops_shopName<span class=\"token operator\">:</span> <span class=\"token string\">\"사왕이네\"</span><span class=\"token punctuation\">,</span>\n        distance<span class=\"token operator\">:</span> <span class=\"token number\">0.4228400907307967</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token operator\">...</span>\n\n    Stations <span class=\"token punctuation\">{</span>\n        stations_id<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        stations_station<span class=\"token operator\">:</span> <span class=\"token string\">\"원남동 사거리 정류소\"</span><span class=\"token punctuation\">,</span>\n        stations_latitude<span class=\"token operator\">:</span> <span class=\"token number\">37.57578617</span><span class=\"token punctuation\">,</span>\n        stations_longitude<span class=\"token operator\">:</span> <span class=\"token number\">126.998124</span><span class=\"token punctuation\">,</span>\n        shops_id<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n        shops_stationId<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        shops_shopName<span class=\"token operator\">:</span> <span class=\"token string\">\"큰통치킨\"</span><span class=\"token punctuation\">,</span>\n        distance<span class=\"token operator\">:</span> <span class=\"token number\">1.5482886513847316</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    Stations <span class=\"token punctuation\">{</span>\n        stations_id<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        stations_station<span class=\"token operator\">:</span> <span class=\"token string\">\"원남동 사거리 정류소\"</span><span class=\"token punctuation\">,</span>\n        stations_latitude<span class=\"token operator\">:</span> <span class=\"token number\">37.57578617</span><span class=\"token punctuation\">,</span>\n        stations_longitude<span class=\"token operator\">:</span> <span class=\"token number\">126.998124</span><span class=\"token punctuation\">,</span>\n        shops_id<span class=\"token operator\">:</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span>\n        shops_stationId<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        shops_shopName<span class=\"token operator\">:</span> <span class=\"token string\">\"BBQ\"</span>\n        distance<span class=\"token operator\">:</span> <span class=\"token number\">1.5482886513847316</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<br/>\n<p>위처럼 <code class=\"language-text\">distance</code>를 추가해 조회 할 경우<br/>\n원래 대로면 부모 객체 안에 join된 객체들이 배열을 이뤄 지정한 key의 배열로 저장이 되어야 한다.<br/>\n하지만 <code class=\"language-text\">getRawMany()</code>를 사용하면 부모객체와의 의존성이 모두 사라지며 join된 객체 하나하나가 독립적으로 조회된다.<br/>\n여기서 Typeorm 원시 쿼리 조회의 문제가 나온다.<br/></p>\n<br/>\n<h3 id=\"span-stylecolor-redgetmany의-문제span\" style=\"position:relative;\"><a href=\"#span-stylecolor-redgetmany%EC%9D%98-%EB%AC%B8%EC%A0%9Cspan\" aria-label=\"span stylecolor redgetmany의 문제span permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><span style=\"color: red\">getMany()의 문제</span></h3>\n<br/>\n<p>그럼 <code class=\"language-text\">getMany()</code>함수를 사용하면 되는것 아니냐?<br/>\n<a href=\"https://seongsu.me/typeorm-virtual-column-1/#code-classlanguage-textgetmany-%EC%82%AC%EC%9A%A9-%EC%8B%9Ccode\">이전 포스팅</a>에서 봤던 것 처럼 <code class=\"language-text\">distance</code>를 출력하고 싶은데 안나오는 문제가 있어 자세히 알아볼 필요가 없다.<br/></p>\n<br/>\n<h2 id=\"-custom-virtual-column을-사용해-보자\" style=\"position:relative;\"><a href=\"#-custom-virtual-column%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%B4-%EB%B3%B4%EC%9E%90\" aria-label=\" custom virtual column을 사용해 보자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🤩 Custom Virtual Column을 사용해 보자</h2>\n<br/>\n<p>우리가 만들 가상 컬럼은 위 문제를 완벽히 해결해 줄 것이다.<br/></p>\n<blockquote>\n<p>물론 짜기 나름이다 🤪</p>\n</blockquote>\n<br/>\n<p>Custom Virtual Column을 어떻게 사용하냐면<br/>\n첫째로 데코레이터 설정, 가상 컬럼 설정, 그 뒤 <code class=\"language-text\">getMany()</code>, <code class=\"language-text\">getRawMany()</code>를 대체할 함수 제작이다.<br/>\n그럼 <code class=\"language-text\">addSelect()</code>함수가 호출 될 때 alias 된 컬럼명으로 데코레이터가 등록된 컬럼이 적용될 것이다.<br/></p>\n<br/>\n<ul>\n<li>\n<p><a href=\"https://typescript-kr.github.io/pages/decorators.html\">https://typescript-kr.github.io/pages/decorators.html</a><br/></p>\n<p>먼저 위 링크에서 데코레이터 &#x26; 메타데이터에 관해 알아보자<br/></p>\n</li>\n</ul>\n<br/>\n<p>그 뒤 <code class=\"language-text\">reflect-metadata</code>설치가 완료 되었고 <code class=\"language-text\">tsconfig.json</code>에 메타데이터 설정이 완료 되었다면 데코레이터를 만들어 주자.</p>\n<br/>\n<h3 id=\"code-classlanguage-textmodulesdecoratortscode\" style=\"position:relative;\"><a href=\"#code-classlanguage-textmodulesdecoratortscode\" aria-label=\"code classlanguage textmodulesdecoratortscode permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">@modules/decorator.ts</code></h3>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token string\">\"reflect-metadata\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">COLUMN_KEY</span> <span class=\"token operator\">=</span> <span class=\"token function\">Symbol</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"VIRTUAL_COLUMN\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">VirtualColumn</span><span class=\"token punctuation\">(</span>name<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> PropertyDecorator <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> propertyKey<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> metaInfo <span class=\"token operator\">=</span> Reflect<span class=\"token punctuation\">.</span><span class=\"token function\">getMetadata</span><span class=\"token punctuation\">(</span><span class=\"token constant\">COLUMN_KEY</span><span class=\"token punctuation\">,</span> target<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n        metaInfo<span class=\"token punctuation\">[</span>propertyKey<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> name <span class=\"token operator\">??</span> propertyKey<span class=\"token punctuation\">;</span>\n\n        Reflect<span class=\"token punctuation\">.</span><span class=\"token function\">defineMetadata</span><span class=\"token punctuation\">(</span><span class=\"token constant\">COLUMN_KEY</span><span class=\"token punctuation\">,</span> metaInfo<span class=\"token punctuation\">,</span> target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>데코레이터 함수 작성이 완료되었으면 Entity에 바로 적용하자!<br/></p>\n<br/>\n<h3 id=\"code-classlanguage-textentitiesstationstscode\" style=\"position:relative;\"><a href=\"#code-classlanguage-textentitiesstationstscode\" aria-label=\"code classlanguage textentitiesstationstscode permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">@entities/stations.ts</code></h3>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Entity<span class=\"token punctuation\">,</span> PrimaryGeneratedColumn<span class=\"token punctuation\">,</span> Column <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"typeorm\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> VirtualColumn <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@modules/decorator.ts\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Entity</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stations\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Stations</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">PrimaryGeneratedColumn</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    id<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Column</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"varchar\"</span><span class=\"token punctuation\">)</span>\n    station<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Column</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"double\"</span><span class=\"token punctuation\">)</span>\n    latitude<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Column</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"double\"</span><span class=\"token punctuation\">)</span>\n    longitude<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 데코레이터는 distance라는 이름을 가진 컬럼으로 인식하게 된다.</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">VirtualColumn</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    distance<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>이제 Express 서버가 실행되며 Typeorm이 연결될 때 VirtualColumn()도 같이 적용된다.<br/>\n그 뒤 우리가 원하는 결과를 얻기 위해 <code class=\"language-text\">getRawMany()</code>함수를 커스텀 해보자.<br/></p>\n<br/>\n<h3 id=\"code-classlanguage-textmodulesquerybuildertscode\" style=\"position:relative;\"><a href=\"#code-classlanguage-textmodulesquerybuildertscode\" aria-label=\"code classlanguage textmodulesquerybuildertscode permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">@modules/queryBuilder.ts</code></h3>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> SelectQueryBuilder <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"typeorm\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"reflect-metadata\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">\"typeorm\"</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">interface</span> <span class=\"token class-name\">SelectQueryBuilder<span class=\"token operator\">&lt;</span>Entity<span class=\"token operator\">></span></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">getAroundShop</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">:</span> SelectQueryBuilder<span class=\"token operator\">&lt;</span>Entity<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>Entity<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">COLUMN_KEY</span> <span class=\"token operator\">=</span> <span class=\"token function\">Symbol</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"VIRTUAL_COLUMN\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nSelectQueryBuilder<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">getAroundShop</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 먼저 원시 데이터 조회 결과를 얻어온다</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> entities<span class=\"token punctuation\">,</span> raw <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRawAndEntities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> flag <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> idx <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> items <span class=\"token operator\">=</span> entities<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>entitiy<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 원시 결과에서 필요없는 데이터를 쳐내기 위해 반복문을 돌려준다.</span>\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>flag <span class=\"token operator\">===</span> raw<span class=\"token punctuation\">[</span>idx<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"staions_id\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            idx<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// 앞전에 작성한 데코레이터를 COLUMN_KEY로 인식하게 한다.</span>\n        <span class=\"token keyword\">const</span> metaInfo <span class=\"token operator\">=</span> Reflect<span class=\"token punctuation\">.</span><span class=\"token function\">getMetadata</span><span class=\"token punctuation\">(</span><span class=\"token constant\">COLUMN_KEY</span><span class=\"token punctuation\">,</span> entitiy<span class=\"token punctuation\">)</span> <span class=\"token operator\">??</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> item <span class=\"token operator\">=</span> raw<span class=\"token punctuation\">[</span>idx<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>propertyKey<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">]</span> <span class=\"token keyword\">of</span> Object<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">entries</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>metaInfo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            entitiy<span class=\"token punctuation\">[</span>propertyKey<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> item<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        flag <span class=\"token operator\">=</span> item<span class=\"token punctuation\">[</span><span class=\"token string\">\"stations_id\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> entitiy<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// distance를 포함한 데이터를 반환해준다.</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>items<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br/>\n<p>이렇게 되면 기존 Typeorm의 <code class=\"language-text\">getRawMany()</code>의 기능과 거의 비슷하게 만든 <code class=\"language-text\">getAroundShop()</code>함수가 만들어 졌다.<br/>\n이렇게 되면 원래 원했던 부모 객체 안에 join된 객체들이 배열을 이뤄 반환이 될 것이다.<br/></p>\n<br/>\n<h3 id=\"code-classlanguage-textgetaroundshop-사용-시code\" style=\"position:relative;\"><a href=\"#code-classlanguage-textgetaroundshop-%EC%82%AC%EC%9A%A9-%EC%8B%9Ccode\" aria-label=\"code classlanguage textgetaroundshop 사용 시code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">getAroundShop() 사용 시</code></h3>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getRepository <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"typeorm\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getAroundShop <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@modules/queryBuilder\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Stations <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@entities/stations\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Shops <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@entities/shops\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n    lat: 37.57418192,\n    lon: 127.015664,\n    radius(기준 km): 2\n*/</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">aroundStation</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>lat<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> lon<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> radius<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getRepository</span><span class=\"token punctuation\">(</span>Stations<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">createQueryBuilder</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stations\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">addSelect</span><span class=\"token punctuation\">(</span>\n                <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">6371 * acos(cos(radians(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>lat<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)) * cos(radians(latitude)) * cos(radians(longitude) - radians(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>lon<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)) + sin(radians(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>lat<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)) * sin(radians(latitude)))</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"distance\"</span>\n            <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">leftJoinAndSelect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stations.shops\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"shops\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">having</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">distance &lt;= </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>radius<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">orderBy</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"distance\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ASC\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">getAroundShop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">aroundStation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<blockquote>\n<p>Entity join하는 방법은 <a href=\"https://typeorm.io\">Typeorm 공식문서</a>를 참조하자!</p>\n</blockquote>\n<br/>\n<h2 id=\"-가상-컬럼을-통한-데이터-조회\" style=\"position:relative;\"><a href=\"#-%EA%B0%80%EC%83%81-%EC%BB%AC%EB%9F%BC%EC%9D%84-%ED%86%B5%ED%95%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A1%B0%ED%9A%8C\" aria-label=\" 가상 컬럼을 통한 데이터 조회 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🥳 가상 컬럼을 통한 데이터 조회</h2>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token punctuation\">[</span>\n    Stations <span class=\"token punctuation\">{</span>\n        id<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        station<span class=\"token operator\">:</span> <span class=\"token string\">\"동대문역 2번출구 정류소\"</span><span class=\"token punctuation\">,</span>\n        latitude<span class=\"token operator\">:</span> <span class=\"token number\">37.57198805</span><span class=\"token punctuation\">,</span>\n        longitude<span class=\"token operator\">:</span> <span class=\"token number\">127.0117451</span><span class=\"token punctuation\">,</span>\n        shops<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">{</span>\n                id<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n                stationId<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n                shopName<span class=\"token operator\">:</span> <span class=\"token string\">\"동찬이네\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">{</span>\n                id<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n                stationId<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n                shopName<span class=\"token operator\">:</span> <span class=\"token string\">\"사왕이네\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">{</span>\n                id<span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n                stationId<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n                shopName<span class=\"token operator\">:</span> <span class=\"token string\">\"승한이네\"</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        distance<span class=\"token operator\">:</span> <span class=\"token number\">0.4228400907307967</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    Stations <span class=\"token punctuation\">{</span>\n        id<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        station<span class=\"token operator\">:</span> <span class=\"token string\">\"원남동 사거리 정류소\"</span><span class=\"token punctuation\">,</span>\n        latitude<span class=\"token operator\">:</span> <span class=\"token number\">37.57578617</span><span class=\"token punctuation\">,</span>\n        longitude<span class=\"token operator\">:</span> <span class=\"token number\">126.998124</span><span class=\"token punctuation\">,</span>\n        shops<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">{</span>\n                id<span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span>\n                stationId<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n                shopName<span class=\"token operator\">:</span> <span class=\"token string\">\"크래프트 한스\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">{</span>\n                id<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n                stationId<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n                shopName<span class=\"token operator\">:</span> <span class=\"token string\">\"큰통치킨\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">{</span>\n                id<span class=\"token operator\">:</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span>\n                stationId<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n                shopName<span class=\"token operator\">:</span> <span class=\"token string\">\"BBQ\"</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        distance<span class=\"token operator\">:</span> <span class=\"token number\">1.5482886513847316</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<br/>\n<p>이로써 테이블에 존재하지 않는 특정 데이터를 포함해 조회하는 로직을 완성할 수 있게 되었다.<br/>\n이게 특별한 기능은 아닌것 같은데 Typeorm에서 정식으로 지원해 주지 않는 바람에 몇일 개고생을 해서 찾고 구현을 하게 되었다.<br/>\n후…😑 왜 이렇게 필요하고 이게 안돼? 라는 기능이 공식 지원이 안돼 개고생을 해야하는지 모르겠지만… 어쨋든 결과가 좋았으니 된것 같다…😅<br/></p>\n<blockquote>\n<p>0.2.37 버전에서 지원 해준다 했으면서 아직도 안해주네…</p>\n</blockquote>\n<br/>\n<h2 id=\"-참고-자료\" style=\"position:relative;\"><a href=\"#-%EC%B0%B8%EA%B3%A0-%EC%9E%90%EB%A3%8C\" aria-label=\" 참고 자료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📚 참고 자료</h2>\n<ul>\n<li>Virtual Column solutions for TypeORM</li>\n</ul>\n<blockquote>\n<p><a href=\"https://pietrzakadrian.com/blog/virtual-column-solutions-for-typeorm\">https://pietrzakadrian.com/blog/virtual-column-solutions-for-typeorm</a></p>\n</blockquote>\n<br/>\n<br/>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#ullia-hrefhttpsseongsumetypeorm-virtual-column-1-target_blanktypeorm-virtual-column-%EC%84%A4%EC%A0%95-1aliul\"><ul><li><a href=\"https://seongsu.me/typeorm-virtual-column-1\" target=\"_blank\">Typeorm Virtual Column 설정 (1)</a></li></ul></a></p>\n</li>\n<li>\n<p><a href=\"#-custom-virtual-column%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%B4%EC%95%BC-%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0\">😵‍💫 Custom Virtual Column을 사용해야 하는 이유</a></p>\n<ul>\n<li><a href=\"#span-stylecolor-redgetrawmany%EC%9D%98-%EB%AC%B8%EC%A0%9Cspan\"><span style=\"color: red\">getRawMany()의 문제</span></a></li>\n<li><a href=\"#span-stylecolor-redgetmany%EC%9D%98-%EB%AC%B8%EC%A0%9Cspan\"><span style=\"color: red\">getMany()의 문제</span></a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-custom-virtual-column%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%B4-%EB%B3%B4%EC%9E%90\">🤩 Custom Virtual Column을 사용해 보자</a></p>\n<ul>\n<li><a href=\"#modulesdecoratorts\"><code class=\"language-text\">@modules/decorator.ts</code></a></li>\n<li><a href=\"#entitiesstationsts\"><code class=\"language-text\">@entities/stations.ts</code></a></li>\n<li><a href=\"#modulesquerybuilderts\"><code class=\"language-text\">@modules/queryBuilder.ts</code></a></li>\n<li><a href=\"#getaroundshop-%EC%82%AC%EC%9A%A9-%EC%8B%9C\"><code class=\"language-text\">getAroundShop() 사용 시</code></a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EA%B0%80%EC%83%81-%EC%BB%AC%EB%9F%BC%EC%9D%84-%ED%86%B5%ED%95%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A1%B0%ED%9A%8C\">🥳 가상 컬럼을 통한 데이터 조회</a></p>\n</li>\n<li>\n<p><a href=\"#-%EC%B0%B8%EA%B3%A0-%EC%9E%90%EB%A3%8C\">📚 참고 자료</a></p>\n</li>\n</ul>\n</div>","excerpt":"Typeorm Virtual Column 설정 (1) 이전 포스팅에서 함수와 함수의 차이점을 알아보게 되었는데\n이번 포스팅에선 가상컬럼을 사용하며 join시 위 함수의 문제와 해결법을 포스팅 해보려 한다. 😵‍💫 Custom Virtual Column을 사용해야 하는 이유 예를들어 위처럼 버스 정류소와 주변 맛집이 정류소 pk를 통해 foreign key로 연결이 되어있다 가정해 보자. 이렇게 정류소와 주변 맛집의 관계가 맺어져 있는 상황에서 현재 거리 기준 2km 이내 정류소 주변 맛집을 조회하는 쿼리를 실행하면 어떻게 될까? getRawMany()의 문제 지금 보니 함수를 사용하니 가상 컬럼 효과를 낸 것 같은데 해결된거 아니냐? 할 수 있다.\n그런데 문제는 지금부터이다. 여기서  또는 을 할 경우  위처럼 를 추가해 조회 할 경우\n원래 대로면 부모 객체 안에 join된 객체들이 배열을 이뤄 지정한 key의 배열로 저장이 되어야 한다.\n하지만 를 사용하면 부모객체와의 의존성이 모두…","frontmatter":{"date":"January 17, 2022","title":"Typeorm Virtual Column 설정 (2)","categories":"Node.js Express","author":"seongsu","emoji":"🔟"},"fields":{"slug":"/skill/typeorm-virtual-column-2/"}},"next":{"id":"97e689c0-985c-5184-91ff-731bbd79b545","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABIklEQVQoz5WST0/CQBDF+9U9EWMgGEhM/ATejCetXLl556DZGv4WUiBuaCnddudn2gUsiRGcZHY3b2fevJldj9JEqg2rIf6gbrJ5LxekHveHeSKCFHmVIP4dol7YZBb9tXYk6hl5vXf3RY61tvIqr+aunuBVh3xP2Glj1YhVkrAIQ7ZlcDBCOrdnlR1IvSN7WbVxhSwj5qsV08mExBiKRQjNBlEU0e/36fV6+L6P1rryOI5PFR5ll0D7BjsPWccxyyhis9tRhFNoXZNZIZzN+AwCBoMBSZKQpinGmN9aNo6w20SUYq414+GQrMSUQrqtQ2OXtSy2cODbAxI8YQSydOsig0eH/+dRTornula1VK+58Mc4hRxnWJtlDftpZ6/kDPM3H6637KPjZfIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"typeorm.png\"\n        title=\"typeorm.png\"\n        src=\"/static/e4b90acf02bd52801818ca0004fdd1f1/37523/typeorm.png\"\n        srcset=\"/static/e4b90acf02bd52801818ca0004fdd1f1/e9ff0/typeorm.png 180w,\n/static/e4b90acf02bd52801818ca0004fdd1f1/f21e7/typeorm.png 360w,\n/static/e4b90acf02bd52801818ca0004fdd1f1/37523/typeorm.png 720w,\n/static/e4b90acf02bd52801818ca0004fdd1f1/00d43/typeorm.png 1000w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br/>\n<h2 id=\"ullia-hrefhttpsseongsumetypeorm-virtual-column-2-target_blanktypeorm-virtual-column-설정-2aliul\" style=\"position:relative;\"><a href=\"#ullia-hrefhttpsseongsumetypeorm-virtual-column-2-target_blanktypeorm-virtual-column-%EC%84%A4%EC%A0%95-2aliul\" aria-label=\"ullia hrefhttpsseongsumetypeorm virtual column 2 target_blanktypeorm virtual column 설정 2aliul permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><ul><li><a href=\"https://seongsu.me/typeorm-virtual-column-2\" target=\"_blank\">Typeorm Virtual Column 설정 (2)</a></li></ul></h2>\n<br/>\n<br/>\n<p>Typeorm을 사용하며 대부분 마음에 들었는데 한가지 딱 아쉬운 부분이 있다…<br/>\nMysql에서는 테이블에 특정 컬럼이 없어도 SELECT시에 새로 만들어 출력 할 수 있다.<br/>\n현재 Typeorm에 가상 컬럼 기능이 있긴 한데 원하는 목적과 좀 달라서 원하는 데이터를 가공 후 새로운 컬럼을 추가 해 return 받을 수 있게 가상 컬럼에 관해 포스팅 하려 한다.<br/></p>\n<blockquote>\n<p>Typeorm 버전 0.2.37에 가상컬럼 업데이트 될거라는 얘기가 있었지만 현재 0.2.41 버전까지 지원이 안되고 있다…</p>\n</blockquote>\n<br/>\n<h2 id=\"-가상-컬럼이란\" style=\"position:relative;\"><a href=\"#-%EA%B0%80%EC%83%81-%EC%BB%AC%EB%9F%BC%EC%9D%B4%EB%9E%80\" aria-label=\" 가상 컬럼이란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🎓 가상 컬럼이란?</h2>\n<br/>\n<p>Mysql 5.7 부터 지원되는 가상 컬럼은 가상의 컬럼을 둬서 수식과 조건문을 사용해 데이터의 가공 결과를 저장하는 것을 말한다. 사용 방법은 PERSISTENT(stored)와 VIRTUAL(generated-only)이라는 두 가지 타입이 존재하고 디폴트는 PERSISTENT 이다<br/>\nPERSISTENT virtual columns은 실제 데이터가 데이터베이스에 저장되는 특성을 갖게 되며, VIRTUAL virtual columns은 실제 데이터가 데이터베이스에 저장되지 않고 그때 그때 계산돼 보여주는 역할을 한다.<br/></p>\n<blockquote>\n<p>이 포스팅에서 사용하는 타입은 <strong>VIRTUAL</strong> 이다.</p>\n</blockquote>\n<br/>\n<h2 id=\"-데이터-조회\" style=\"position:relative;\"><a href=\"#-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A1%B0%ED%9A%8C\" aria-label=\" 데이터 조회 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🤔 데이터 조회</h2>\n<br/>\n<p>예를들어 데이터베이스 각 행에 버스 정류소의 위도, 경도 값이 저장이 돼 있다.<br/></p>\n<pre class=\"language-plain\">\n<span style=\"color: red;\">현재 위치</span> : 37.57418192 127.015664 (롯데캐슬 천지인 정류소)\n\n<span style=\"color: skyblue;\">목표 정류소1</span> : 37.57198805 127.0117451 (동대문역 2번출구 정류소)\n<span style=\"color: skyblue;\">목표 정류소2</span> : 37.57578617 126.998124 (원남동 사거리 정류소)\n<span style=\"color: skyblue;\">목표 정류소3</span> : 37.58630021 126.9853527 (감사원 정류소)\n</pre>\n<p>여기서 현재 위치 좌표 기준 직선거리 2km 이내의 데이터만 조회하려 하며<br/>\n각 데이터마다 거리가 얼마나 차이 나는지 알 수 있게 <code class=\"language-text\">distance</code>라는 key를 가진 컬럼을 추가해 조회하려 한다고 가정해 보자.<br/></p>\n<br/>\n<h3 id=\"code-classlanguage-textentitiesstationstscode\" style=\"position:relative;\"><a href=\"#code-classlanguage-textentitiesstationstscode\" aria-label=\"code classlanguage textentitiesstationstscode permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">@entities/stations.ts</code></h3>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Entity<span class=\"token punctuation\">,</span> PrimaryGeneratedColumn<span class=\"token punctuation\">,</span> Column <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"typeorm\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Entity</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stations\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Stations</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">PrimaryGeneratedColumn</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    id<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Column</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"varchar\"</span><span class=\"token punctuation\">)</span>\n    station<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Column</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"double\"</span><span class=\"token punctuation\">)</span>\n    latitude<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Column</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"double\"</span><span class=\"token punctuation\">)</span>\n    longitude<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>Data Mapper 형식으로 Entity를 생성한다.</p>\n</blockquote>\n<br/>\n<p>우선 위도, 경도 값을 <code class=\"language-text\">double</code>형식으로 갖는 Entity를 설정 해 준다.<br/>\n그 뒤 <code class=\"language-text\">getMany()</code>함수로 호출 할 때, <code class=\"language-text\">getRawMany()</code>함수로 호출 할 때를 나눠 예를 들어 보겠다.<br/></p>\n<blockquote>\n<p>float형식으로 정할 시 좌표가 소숫점 5자리부터 잘리는 현상이 발생하니 double로 설정해주자</p>\n</blockquote>\n<br/>\n<h3 id=\"code-classlanguage-textgetmany-사용-시code\" style=\"position:relative;\"><a href=\"#code-classlanguage-textgetmany-%EC%82%AC%EC%9A%A9-%EC%8B%9Ccode\" aria-label=\"code classlanguage textgetmany 사용 시code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">getMany() 사용 시</code></h3>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getRepository <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"typeorm\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Stations <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@entities/stations\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n    lat: 37.57418192,\n    lon: 127.015664,\n    radius(기준 km): 2\n*/</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">findAroundLocation</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>lat<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> lon<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> radius<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getRepository</span><span class=\"token punctuation\">(</span>Stations<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">createQueryBuilder</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stations\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">addSelect</span><span class=\"token punctuation\">(</span>\n                <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">6371 * acos(cos(radians(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>lat<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)) * cos(radians(latitude)) * cos(radians(longitude) - radians(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>lon<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)) + sin(radians(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>lat<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)) * sin(radians(latitude)))</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"distance\"</span>\n            <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">having</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">distance &lt;= </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>radius<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">orderBy</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"distance\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ASC\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">getMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">findAroundLocation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br/>\n<p><strong><code class=\"language-text\">Return</code></strong></p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token punctuation\">[</span>\n    Stations <span class=\"token punctuation\">{</span>\n        id<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        station<span class=\"token operator\">:</span> <span class=\"token string\">\"동대문역 2번출구 정류소\"</span><span class=\"token punctuation\">,</span>\n        latitude<span class=\"token operator\">:</span> <span class=\"token number\">37.57198805</span><span class=\"token punctuation\">,</span>\n        longitude<span class=\"token operator\">:</span> <span class=\"token number\">127.0117451</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    Stations <span class=\"token punctuation\">{</span>\n        id<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        station<span class=\"token operator\">:</span> <span class=\"token string\">\"원남동 사거리 정류소\"</span><span class=\"token punctuation\">,</span>\n        latitude<span class=\"token operator\">:</span> <span class=\"token number\">37.57578617</span><span class=\"token punctuation\">,</span>\n        longitude<span class=\"token operator\">:</span> <span class=\"token number\">126.998124</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<blockquote>\n<p>현재 좌표와 목표 정류소3의 좌표간 거리가 2km가 넘기 때문에 조회되지 않는다.<br/>\n실 거리가 약 3km (2.991km) 이기 때문이다.<br/></p>\n</blockquote>\n<br/>\n<p>분명 <code class=\"language-text\">addSelect()</code>함수에 두 좌표간 거리 구하는 공식과 컬럼명을 지정해 줬는데 결과에는 <code class=\"language-text\">distance</code>가 나오지 않는다.<br/>\n왜냐하면 DB에서 단일한 결과를 가져오는 <code class=\"language-text\">getMany()</code>함수의 특성상 쿼리문에서 적용한 데이터는 출력이 안되고 계산에만 사용이 된다.<br/></p>\n<br/>\n<h3 id=\"code-classlanguage-textgetrawmany-사용-시code\" style=\"position:relative;\"><a href=\"#code-classlanguage-textgetrawmany-%EC%82%AC%EC%9A%A9-%EC%8B%9Ccode\" aria-label=\"code classlanguage textgetrawmany 사용 시code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">getRawMany() 사용 시</code></h3>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getRepository <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"typeorm\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Stations <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@entities/stations\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n    lat: 37.57418192,\n    lon: 127.015664,\n    radius(기준 km): 2\n*/</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">aroundStation</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>lat<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> lon<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> radius<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getRepository</span><span class=\"token punctuation\">(</span>Stations<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">createQueryBuilder</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stations\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">addSelect</span><span class=\"token punctuation\">(</span>\n                <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">6371 * acos(cos(radians(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>lat<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)) * cos(radians(latitude)) * cos(radians(longitude) - radians(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>lon<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)) + sin(radians(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>lat<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)) * sin(radians(latitude)))</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"distance\"</span>\n            <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">having</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">distance &lt;= </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>radius<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">orderBy</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"distance\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ASC\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">getRawMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">aroundStation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br/>\n<p><strong><code class=\"language-text\">Return</code></strong></p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token punctuation\">[</span>\n    Stations <span class=\"token punctuation\">{</span>\n        stations_id<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        stations_station<span class=\"token operator\">:</span> <span class=\"token string\">\"동대문역 2번출구 정류소\"</span><span class=\"token punctuation\">,</span>\n        stations_latitude<span class=\"token operator\">:</span> <span class=\"token number\">37.57198805</span><span class=\"token punctuation\">,</span>\n        stations_longitude<span class=\"token operator\">:</span> <span class=\"token number\">127.0117451</span><span class=\"token punctuation\">,</span>\n        distance<span class=\"token operator\">:</span> <span class=\"token number\">0.4228400907307967</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    Stations <span class=\"token punctuation\">{</span>\n        stations_id<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        stations_station<span class=\"token operator\">:</span> <span class=\"token string\">\"원남동 사거리 정류소\"</span><span class=\"token punctuation\">,</span>\n        stations_latitude<span class=\"token operator\">:</span> <span class=\"token number\">37.57578617</span><span class=\"token punctuation\">,</span>\n        stations_longitude<span class=\"token operator\">:</span> <span class=\"token number\">126.998124</span><span class=\"token punctuation\">,</span>\n        distance<span class=\"token operator\">:</span> <span class=\"token number\">1.5482886513847316</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<blockquote>\n<p>distance는 킬로미터 기준으로 계산한 결과이다.</p>\n</blockquote>\n<br/>\n<p><code class=\"language-text\">getRawMany()</code>함수로 조회 시 원시 결과를 얻어오기 때문에 <code class=\"language-text\">addSelect()</code>함수에서 지정한 <code class=\"language-text\">distance</code>를 갖고올 수 있다.<br/>\n이 경우 Mysql 가상 컬럼과 매우 비슷한 결과를 도출할 수 있게 된다.<br/>\n하지만 객체 key에 stations_ 가 붙어 나오게 된다.<br/>\n이 경우는 <code class=\"language-text\">addSelect()</code>함수 호출 이전에 <code class=\"language-text\">select()</code>함수를 호출해 <code class=\"language-text\">alias</code>설정을 해주면 손쉽게 해결 가능하다.<br/></p>\n<br/>\n<br/>\n<p>이상 Mysql의 가상 컬럼을 비슷하게 구현할 수 있는 Typeorm의 기능을 포스팅 했다.<br/>\n다음 포스팅에서 왜 Custom Virtual Column을 사용해야 하는지 이유와 함께 포스팅 해야겠다.<br/></p>\n<br/>\n<h2 id=\"-참고-자료\" style=\"position:relative;\"><a href=\"#-%EC%B0%B8%EA%B3%A0-%EC%9E%90%EB%A3%8C\" aria-label=\" 참고 자료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📚 참고 자료</h2>\n<blockquote>\n<p>Typeorm 공식 레퍼런스</p>\n</blockquote>\n<ul>\n<li><a href=\"https://typeorm.io\">https://typeorm.io</a></li>\n</ul>\n<br/>\n<br/>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#ullia-hrefhttpsseongsumetypeorm-virtual-column-2-target_blanktypeorm-virtual-column-%EC%84%A4%EC%A0%95-2aliul\"><ul><li><a href=\"https://seongsu.me/typeorm-virtual-column-2\" target=\"_blank\">Typeorm Virtual Column 설정 (2)</a></li></ul></a></p>\n</li>\n<li>\n<p><a href=\"#-%EA%B0%80%EC%83%81-%EC%BB%AC%EB%9F%BC%EC%9D%B4%EB%9E%80\">🎓 가상 컬럼이란?</a></p>\n</li>\n<li>\n<p><a href=\"#-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A1%B0%ED%9A%8C\">🤔 데이터 조회</a></p>\n<ul>\n<li><a href=\"#entitiesstationsts\"><code class=\"language-text\">@entities/stations.ts</code></a></li>\n<li><a href=\"#getmany-%EC%82%AC%EC%9A%A9-%EC%8B%9C\"><code class=\"language-text\">getMany() 사용 시</code></a></li>\n<li><a href=\"#getrawmany-%EC%82%AC%EC%9A%A9-%EC%8B%9C\"><code class=\"language-text\">getRawMany() 사용 시</code></a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EC%B0%B8%EA%B3%A0-%EC%9E%90%EB%A3%8C\">📚 참고 자료</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"January 15, 2022","title":"Typeorm Virtual Column 설정 (1)","categories":"Node.js Express","author":"seongsu","emoji":"9️⃣"},"fields":{"slug":"/skill/typeorm-virtual-column-1/"}},"prev":{"id":"963d06c8-1f47-5044-9d9a-1db14773d65e","html":"<br>\n<p><code class=\"language-text\">이 프로젝트는 학습용으로 제작되었으며, 현재는 운영되지 않습니다.</code></p>\n<br>\n<h2 id=\"-개발하게-된-계기\" style=\"position:relative;\"><a href=\"#-%EA%B0%9C%EB%B0%9C%ED%95%98%EA%B2%8C-%EB%90%9C-%EA%B3%84%EA%B8%B0\" aria-label=\" 개발하게 된 계기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💫 개발하게 된 계기</h2>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB3ElEQVQoz41Sya7TQBDMPyDxXpKXOI7jeBtvM96zmIQTghsSJxCruCEkJP4AxAUhPoIL3IAPLFRtwssBIQ6l7tmqq6tnFKkM2lSo2x3S3MBZ+ViufCyWa1yMZ7iczP8bM8vB6NWLZ3j44D5ev3mLu/fuQBc1TNEgiBIEUQqVaARKI1Q5ojhDFF9HP0wk5521rzCd2RgtbBeuF8phbhqYsoUuGhRVB1MO8XirRZZrJFkJFedIsgJxqpHpEklmJOd7IaRUxw2gkhyZruQSK5K4rDrEaYG+iaBUhIXjD5Y4nrxZrUO4XiSRFl3NlxhNrhYIwgTa1EjzYmi5bBGqTB45ro+57WPlRZIPe9cYSM8Ix1MLXhAjN5UoLKoWuamlrVCl4NDYUpxo8Y2F6Bsj26UIdsWzoeWphTg1qNstqmaLdrNHWXdouh2qZiMFNruD7HfbHk23l2FRBP2kVSSmSiGkwvNppXkpBU45UZTt7wEUsiYZ35z8G2IwfJtTy3W7x64/CtpNL5NmES9QsB0Plu3+AdcEfTvPhfDGzQkePX6Cr9++4PuPn/j46TPevf+Ap89fYu1H4hW/1uXEAgdIUMTfIEO5GM9xOPY43KbpWhSxBarmFHmRJPTnX+AdEv4CPlFPtk3F9XsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"reason.png\"\n        title=\"reason.png\"\n        src=\"/static/fee54b6925d36077d3649bbc9a0b8fcc/37523/reason.png\"\n        srcset=\"/static/fee54b6925d36077d3649bbc9a0b8fcc/e9ff0/reason.png 180w,\n/static/fee54b6925d36077d3649bbc9a0b8fcc/f21e7/reason.png 360w,\n/static/fee54b6925d36077d3649bbc9a0b8fcc/37523/reason.png 720w,\n/static/fee54b6925d36077d3649bbc9a0b8fcc/302a4/reason.png 1080w,\n/static/fee54b6925d36077d3649bbc9a0b8fcc/b67f3/reason.png 1338w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>아는 멘토님이 외주를 받아오셔서 슬랙에 구인공고를 하시길래, 한번 들여다 보니 <code class=\"language-text\">매크로</code> 서버를 제작해 달라는 것이였다.<br>\n오랜기간 프로젝트를 하던 도중이라 힘이 빠져서 기분 전환 겸 새로운 것을 찾고 있었고,<br>\n”<strong>취업은 비공식적으로 문제 없을거다</strong>” 라는 멘트에 혹해 지원해서 개발하게 되었지만, 나중에 생각해보니 장난으로 하신 말씀같다.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABa0lEQVQoz52SyW7CMBCG/RghCVkIiR0nIWRjKVIFoqUL3RRBc2pVqRceoKeq6qv/lR0ScaCtxOHTjMfy73/GJtVzhbLcYLG8gGn3YfU8aF0bHc2EqlttbPLD9SEdrYb4wQBRnCIcpGB8IKF+BOqHYDyCH8RtTUSXBtCNHrqmI2Od92HaDizLBlFUAzwcIiumyEdnNcUUSTZq12k+QVZMkOUTpPkYcZIjzcayHicFGI/hc46IOyCKZsBxmXTCw5ogHO6dRQiiBB4LYNquxLD6B85ql6puQlEFFgilEZJkJEX6Hpd4LJSI9hpEvYlixgIxuybX95Dd7gP35Qaz87mck3Ahbmse4BiNyDEISwoEsxQ8ituW/jrQOPsNks5vsa1ecLm6Qc/lyIYM1LWhaNa/wkcdVtsSj08lFsuVfADXY9C74jb7NMHPr2+8vr1jdb2G7VCooiW5eZoo4R7F3foBi+UVxCeXovpp7QrBH/qfPW8R41DmAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"사람들이 모였다\"\n        title=\"사람들이 모였다\"\n        src=\"/static/401cd49639b02da10d39d901206d2c67/37523/join_team.png\"\n        srcset=\"/static/401cd49639b02da10d39d901206d2c67/e9ff0/join_team.png 180w,\n/static/401cd49639b02da10d39d901206d2c67/f21e7/join_team.png 360w,\n/static/401cd49639b02da10d39d901206d2c67/37523/join_team.png 720w,\n/static/401cd49639b02da10d39d901206d2c67/302a4/join_team.png 1080w,\n/static/401cd49639b02da10d39d901206d2c67/07a9c/join_team.png 1440w,\n/static/401cd49639b02da10d39d901206d2c67/e431d/join_team.png 1882w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>이렇게 5명의 개발인원 + 리딩해 주시는 멘토님이 만났다.</p>\n</blockquote>\n<br>\n<h3 id=\"-첫번째-미팅\" style=\"position:relative;\"><a href=\"#-%EC%B2%AB%EB%B2%88%EC%A7%B8-%EB%AF%B8%ED%8C%85\" aria-label=\" 첫번째 미팅 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🤝 첫번째 미팅</h3>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 560px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMCBAX/xAAWAQEBAQAAAAAAAAAAAAAAAAACAAH/2gAMAwEAAhADEAAAAUk8wK2KLP/EABoQAQEAAgMAAAAAAAAAAAAAAAECAxESIkH/2gAIAQEAAQUCiOcdIaER1g9pd//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAECAQE/AYf/xAAZEAACAwEAAAAAAAAAAAAAAAAAAQIQETH/2gAIAQEABj8CJI4LL//EABkQAAMBAQEAAAAAAAAAAAAAAAABITERsf/aAAgBAQABPyFa+20c5uI4r2OyIPLHHp//2gAMAwEAAgADAAAAENMv/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAh/9oACAEDAQE/EAyf/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAECAQE/EDS2X//EABoQAQEBAQEBAQAAAAAAAAAAAAERACFhMUH/2gAIAQEAAT8Q9gC/Zcl4FQ2vjjEbKkcdZfRXn1yS5r25yUu//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"설계서 들어간다\"\n        title=\"설계서 들어간다\"\n        src=\"/static/8099fcebb70acc56506344b6f62087b0/9342c/feeding.jpg\"\n        srcset=\"/static/8099fcebb70acc56506344b6f62087b0/4ec73/feeding.jpg 180w,\n/static/8099fcebb70acc56506344b6f62087b0/158ba/feeding.jpg 360w,\n/static/8099fcebb70acc56506344b6f62087b0/9342c/feeding.jpg 560w\"\n        sizes=\"(max-width: 560px) 100vw, 560px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>확실히 현업에서 오래 종사하던 분이 리딩을 해주셔서 그런지 기획과 설계의 처리가 남달랐다.<br>\n요구사항 명세, 아키텍쳐 설계, 유저 시나리오 등 재직하시며 갖고 계시던 설계 보따리를 풀어 우리에게 제공해주시고, 작성하는 방법을 알려주셨고, 확실한 설계서가 3일만에 만들어 졌다.<br></p>\n<br>\n<h3 id=\"-요구사항이-들어왔다\" style=\"position:relative;\"><a href=\"#-%EC%9A%94%EA%B5%AC%EC%82%AC%ED%95%AD%EC%9D%B4-%EB%93%A4%EC%96%B4%EC%99%94%EB%8B%A4\" aria-label=\" 요구사항이 들어왔다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📝 요구사항이 들어왔다.</h3>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 133.33333333333331%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAbABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAIDBAUB/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgMA/9oADAMBAAIQAxAAAAFpixtkDEqWLWF1iYUm/wD/xAAcEAABBAMBAAAAAAAAAAAAAAABAAIDESEzQRD/2gAIAQEAAQUCjjBaYmqqUOtE5g12u9z5/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQMBAT8BIf/EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAECAQE/ASn/xAAcEAABAwUAAAAAAAAAAAAAAAABABAxICEycZH/2gAIAQEABj8CuFjQXO1JUnrf/8QAIBABAAIBAgcAAAAAAAAAAAAAAQARIRBxMVFhgZGx4f/aAAgBAQABPyG+iqvGNTCGQ5Md9zpZvMWG7oXzvctKAHRi/QgFT//aAAwDAQACAAMAAAAQ0yrD/8QAGBEAAwEBAAAAAAAAAAAAAAAAAAERITH/2gAIAQMBAT8Qa0XC6JYf/8QAGBEAAwEBAAAAAAAAAAAAAAAAAAExESH/2gAIAQIBAT8QUHTI30//xAAeEAACAwACAwEAAAAAAAAAAAAAAREhMaHwQVGBwf/aAAgBAQABPxBWv4egiH40ZHRckNLxXIqaxkz7SWkOP2FhWRIfVhWgGNSJy7n0jKP/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"생각보다 얼마 안되네?\"\n        title=\"생각보다 얼마 안되네?\"\n        src=\"/static/211e52b1b4e56b1a665f66d4b53b04a9/80e3c/request.jpg\"\n        srcset=\"/static/211e52b1b4e56b1a665f66d4b53b04a9/4ec73/request.jpg 180w,\n/static/211e52b1b4e56b1a665f66d4b53b04a9/158ba/request.jpg 360w,\n/static/211e52b1b4e56b1a665f66d4b53b04a9/80e3c/request.jpg 720w,\n/static/211e52b1b4e56b1a665f66d4b53b04a9/6a068/request.jpg 960w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>페이지 구성은 심플했다. 이것만 보고 ”<strong>생각보다 얼마 안되겠네ㅋ</strong>“라는 지금와서 돌이켜 보면 미친 생각을 할정도로.<br></p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA9ElEQVQY0yWO226CQABE+f+f8alJ39oXE2sbG01B2BVka70BsiyLXMqa04Q+TCaTOZmM9zRXLDY/iDRDqhvrrUJ+l/jywpc8T1qsQsJ9jro0pGdLcqz49BWL1Z75R8z7RhHEOdskw5u9SoL4ytBZGltzKzJ0WRDvBCLaEoUBUkSk+xhTlTTW4MaB8qZJdlei8EgSZ9TmDji82YtgHR2p6wpjaoqiIE0Vy+USIQRCSnw/QEpJnhdY29B1PbrS/I4Dfd/RdS390DM6h/f8dkIeKsahm8DmfsdaOw0bY9BaU5bl5G3b8ng8cM5N+XQ6Tyf+uWrq/wByXyfayMjYQwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"요구사항기술서\"\n        title=\"요구사항기술서\"\n        src=\"/static/9606cdfb0ca89fe975993adb20c4c53c/37523/request_docs.png\"\n        srcset=\"/static/9606cdfb0ca89fe975993adb20c4c53c/e9ff0/request_docs.png 180w,\n/static/9606cdfb0ca89fe975993adb20c4c53c/f21e7/request_docs.png 360w,\n/static/9606cdfb0ca89fe975993adb20c4c53c/37523/request_docs.png 720w,\n/static/9606cdfb0ca89fe975993adb20c4c53c/302a4/request_docs.png 1080w,\n/static/9606cdfb0ca89fe975993adb20c4c53c/07a9c/request_docs.png 1440w,\n/static/9606cdfb0ca89fe975993adb20c4c53c/27f8b/request_docs.png 1730w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>위 요구사항을 바탕으로 제작된 <code class=\"language-text\">요구사항 기술서</code></p>\n</blockquote>\n<br>\n<h3 id=\"-우당탕탕-설계\" style=\"position:relative;\"><a href=\"#-%EC%9A%B0%EB%8B%B9%ED%83%95%ED%83%95-%EC%84%A4%EA%B3%84\" aria-label=\" 우당탕탕 설계 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>😵‍💫 우당탕탕 설계</h3>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHElEQVQ4y6WT24qFMAxF+//fp48+iQji/X7PYRVS2hnHhzmFYJN27yQ71URRJE3TiK77vuWbZeI4liRJJM9zqevakf6X2KRpKkVRWMKyLAPCn8RvMd2bpyxvoLc7tkL/YNs2OY7DXbquK/DP85RxHGXfdxebpsniXIU+IYfLsgSEgPUO5AxQCVjDMDiMa1kJOYAAoH4h/UuWJ72DCud5ttnJSiX4VM0+yzJp29b6JFGMv7ca+lmpsO97C4QEMMZz0mdFMrRk0QEFcAdMVVViCGBkoc11XUVjmIL9IaiuJMcgVpmMBnWiEKgM7H1N8buus5XyMyADvv8SgpapSJ8Fhk8y2oeElvgSR1+68SX4NRStki/GxSffn6ovC4QfHaj9e97fFs0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sequence.jpg\"\n        title=\"sequence.jpg\"\n        src=\"/static/f00bc7cab47a6cf6eff9effdcf54d7bf/37523/sequence.png\"\n        srcset=\"/static/f00bc7cab47a6cf6eff9effdcf54d7bf/e9ff0/sequence.png 180w,\n/static/f00bc7cab47a6cf6eff9effdcf54d7bf/f21e7/sequence.png 360w,\n/static/f00bc7cab47a6cf6eff9effdcf54d7bf/37523/sequence.png 720w,\n/static/f00bc7cab47a6cf6eff9effdcf54d7bf/a8417/sequence.png 941w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>매달 말, 다음달 예약 페이지가 열리는데, 그 때 다른 매크로들과 경쟁을 해 예약을 선점 하는것이 우리의 목표였다.<br>\n그러기 위해 <code class=\"language-text\">Client</code>에서 지정한 예약 시간에 서버가 작동 되어야 했고, <code class=\"language-text\">trigging</code>이 된 시점엔 예약에 필요한 flow대로 남양주시 예약 프로세스를 잘 처리해야 했다.<br></p>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">로그인 -<span class=\"token operator\">></span> 예약페이지 이동 -<span class=\"token operator\">></span> 예약정보 기입 -<span class=\"token operator\">></span> 예약 신청</code></pre></div>\n<p>그러기 위해선 위와 같은 예약 사이트의 세션을 유지하는 식으로 진행해야 했다.<br></p>\n<br>\n<h2 id=\"-문제-해결을-위한-접근-방법\" style=\"position:relative;\"><a href=\"#-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0%EC%9D%84-%EC%9C%84%ED%95%9C-%EC%A0%91%EA%B7%BC-%EB%B0%A9%EB%B2%95\" aria-label=\" 문제 해결을 위한 접근 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>👣 문제 해결을 위한 접근 방법</h2>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 586px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 82.22222222222221%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACVUlEQVQ4y5WTfXOaQBDG/f6fpf0A/aOdNolpNO8maaVjDKiAEEBAAY/j7tc5NQkm6Uy6M8seC/fcc8/udtI0RQjBer3+gFetf6vnfFVVumkaHMfRHZP4iBVCYT9K7v2Sh0Dgp037szaP+XyuO2VZbjNa7/lrSwvFtVPx9XRM9zZgFEiUUoYdeZ5rKSW+7+uOSTwD7qIxKWviJCF8jCnLilUpiJcNaQVJoUlLxXJVcP9gM7i902EYEoZhi2ELzFijNMv0kWR6RTQbkLgDdDqCbAwrB1YTqmBI5lwjYmezccdwDUqgmq2WW9G3rFU5ZzQ7wZrfcOtdkrh9lN0lHHzZeG0fIS6OWd/91KDw/bnuVGuJrmxUMaKsalMpHMcmCCPy+IFf7jn9+zMu3AHepM9y+J27H5/4ffiZ8v6I4OAb8fnhhqG3AawEzWpMnQ1R+qk4ikbBKrG5mfY4n15x5l3jT/sw6aG9M/DOaCYnpN0D8ssjs3PL0FwxjmM8z3vpgSctm4w0OMWb9XGnJ5RuD+32UCZ6/U2sh12EffGi4VNRRF1jmtyAmXYwB1iWxfiPReS7oBt0U+PYY/JssSmjVtKcam7ULkq112/m3YDmec5kMjG6ED5GCCF31VeoVjeYpdol9hkKQZZlGzcSmK6Ua0U4XhCMY2ZWwHJR7A0BT4Og1FtAM4JRFJEkCWVRUktB6EYMji1uexY3xxaLIN/TuBX/feW2LcKcQdfi5mS4ia8BW0V8C/jeLBdZxWwY4I8ipr8Dlknxf4B7+uzWUjbIWiLr5s1V3wP8CyW1ywli4puuAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"프로세스 설계도\"\n        title=\"프로세스 설계도\"\n        src=\"/static/89b61dc123183dc93189e797483f25c7/a76f4/process_design.png\"\n        srcset=\"/static/89b61dc123183dc93189e797483f25c7/e9ff0/process_design.png 180w,\n/static/89b61dc123183dc93189e797483f25c7/f21e7/process_design.png 360w,\n/static/89b61dc123183dc93189e797483f25c7/a76f4/process_design.png 586w\"\n        sizes=\"(max-width: 586px) 100vw, 586px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>예약 프로세스의 간단한 설계도</p>\n</blockquote>\n<br>\n<p>일단 미래에 실행될 예약 정보를 <code class=\"language-text\">Client</code>에게 받아오고 DB에 저장한다.<br>\n그 뒤 <code class=\"language-text\">trigging을 위해</code> <code class=\"language-text\">Linux Cron</code>을 이용하여 5분 간격으로 데이터베이스를 조회한다.<br>\n트리거가 작동되면서 실행시간과 매칭이 되면 예약 사이트에 예약 프로세스를 진행하면 된다.<br></p>\n<br>\n<h3 id=\"프로세스-진행은-어떻게-\" style=\"position:relative;\"><a href=\"#%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%EC%A7%84%ED%96%89%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C-\" aria-label=\"프로세스 진행은 어떻게  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>프로세스 진행은 어떻게 ❓</h3>\n<br>\n<p>예약을 진행하려면 두가지 방법이 있었다.<br></p>\n<br>\n<ol>\n<li>가상 브라우저를 이용한다.</li>\n<li>직접 HTTP 통신을 한다.</li>\n</ol>\n<br>\n<p>처음엔 첫번째 방법으로 진행하려 했다. 두번째 방법으로 하기엔 직접 HTTP 통신을 해서 세션을 유지시켜 본적이 없어 자신이 없었기 때문이다.<br>\n하지만 <code class=\"language-text\">puppeteer</code>를 이용해 가상 브라우저로 진행한다면, 각 예약 건수 마다 최소 200MB 이상 메모리를 잡아먹어 리소스 낭비가 너무 심했고, 쓸모없는 html, css, js 파일까지 응답을 받아 속도 측면에서도 굉장히 안좋은 방법이라 분당 10번도 요청을 보낼 수 없었다.<br></p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA4ElEQVQY021Qy46CQBDkTwgHhpcCxj3iAKN+gJsYQCS4q7BofMT/P5TpZsWN2UOle6q7qielGYYBzxvBdb2hOo7DsG3nrXe5/gfLsqHrOrTp9AO73TfatsPlckWebxDHKaIohpQJZrOY0XMSUqbM0/s5p54ghOgN9/uGsV5nOBxaFEWJLMtR1198gGZlWWG7rfhwVdW803UnNM0Pc6vVJ0zz1/B8vrKIDI7HEy+QgHgS3W53nhGn1AJJovhH1Cu1RJrOmRPCgkauQRAywnAC3w8GvPi+jsf+kPUz77/ZU4YPkPWv3T1yhzIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"success!!\"\n        title=\"success!!\"\n        src=\"/static/3611c280f3be0342832ddd2799334944/39c09/success.png\"\n        srcset=\"/static/3611c280f3be0342832ddd2799334944/e9ff0/success.png 180w,\n/static/3611c280f3be0342832ddd2799334944/f21e7/success.png 360w,\n/static/3611c280f3be0342832ddd2799334944/39c09/success.png 624w\"\n        sizes=\"(max-width: 624px) 100vw, 624px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>그리하여 직접 HTTP 통신을 해 예약을 진행하는 방식을 택했다.<br>\n그리고 정말 다행히도 옛날 서버라 그런지 소스코드들이 그대로 보여 통신을 분석하기 쉬웠고, 포스트맨을 붙잡고 늘어지며 하루 밤새서 예약 성공을 하게 됐다.<br></p>\n<br>\n<h2 id=\"-개발-방법\" style=\"position:relative;\"><a href=\"#-%EA%B0%9C%EB%B0%9C-%EB%B0%A9%EB%B2%95\" aria-label=\" 개발 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🧑‍💻 개발 방법</h2>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABVUlEQVQoz32SzW6DMBCEef/36bWq1DaHnnKplB8UkJKYJARiDMZe2zDVmqZK27QrjY3Xux+rgaRpGnjv4ByByMJaCyJC3/coyxKn0wlSSjjnvu5uFXOfeX5OjCHsKkIqNIwbMY4DhmGA9x5t26KqqljIuRDCL3H+Ws+RdL3BYtdhvpEoygaqmabhN2qtcTgc4pkbeL8V5+q6Rq81jDERnFhrInmMS1y/RZ7ncUpuVkpFK3jirutgyUGdS9ByAYQwTcjkiTXBrCZsU4FsucVZ1Mg2WfTxcrmA/WaxpwyXfD4ecZ69YCC6D2xrjbfHOZ4eZsjf91it1iiKIkJa1UZFuJSoWfs9qtfn+0BWCAM8BQQ3ILiANE0hhIgeiaNAKlZw5GCNgSWCUQqUZxi8j7YlbO5/wV/aeYde92h7hfVh+W99wv8aN139+Sm+Y7/i3io0jfyzlvUBLq22zd/ruLAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"프로세스 간략도\"\n        title=\"프로세스 간략도\"\n        src=\"/static/6c0074038df291f591757fe2fcc356e5/37523/process_simple.png\"\n        srcset=\"/static/6c0074038df291f591757fe2fcc356e5/e9ff0/process_simple.png 180w,\n/static/6c0074038df291f591757fe2fcc356e5/f21e7/process_simple.png 360w,\n/static/6c0074038df291f591757fe2fcc356e5/37523/process_simple.png 720w,\n/static/6c0074038df291f591757fe2fcc356e5/8c857/process_simple.png 761w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>특정 시간에 N개의 예약 건수가 있을 수 있으니, 비동기를 이용한 병렬 처리를 위해 Node.js를 사용하였다.<br>\nN 예약들을 <code class=\"language-text\">타겟이 되는 날짜를 트랜잭션</code>으로 묶었고,<br>\n각 트랜잭션마다 예약을 초당 2번씩 <code class=\"language-text\">분당 120번 * 5분 * m</code>개 예약 사이트에 요청을 보냈다.<br>\n그 중 성공/실패로 <code class=\"language-text\">모든 프로세스가 끝난 트랜잭션</code>은 더이상 요청을 보내지 않도록 처리를 중지시켰고, 끝나지 않은 예약 건수들은 5분이 될 때 까지 계속 진행된다.<br></p>\n<br>\n<blockquote>\n<p>m개인 이유 -> 하루에 총 8개의 예약이 가능해서 m개이다.</p>\n</blockquote>\n<br>\n<h3 id=\"-트리거-작동-방법\" style=\"position:relative;\"><a href=\"#-%ED%8A%B8%EB%A6%AC%EA%B1%B0-%EC%9E%91%EB%8F%99-%EB%B0%A9%EB%B2%95\" aria-label=\" 트리거 작동 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🎾 트리거 작동 방법</h3>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">await</span> sequelize<span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> force<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"🚀 Database connect successfully.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Executor starts at </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toLocaleString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">const</span> reserves <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Reserve<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        reserves<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> now <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">const</span> open <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">.</span>open_time<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">.</span>status <span class=\"token operator\">!==</span> <span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> value<span class=\"token punctuation\">.</span>status <span class=\"token operator\">!==</span> <span class=\"token number\">3</span> <span class=\"token operator\">&amp;&amp;</span> open <span class=\"token operator\">&lt;=</span> now <span class=\"token operator\">&amp;&amp;</span> now <span class=\"token operator\">&lt;=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>open<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">5</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">const</span> executeOptions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n                    method<span class=\"token operator\">:</span> <span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span>\n                    headers<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> cookie<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">access=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">JWT</span><span class=\"token punctuation\">.</span><span class=\"token function\">accessSign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">; refresh=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">JWT</span><span class=\"token punctuation\">.</span><span class=\"token function\">refreshSign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">;</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                    url<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">API_ENDPOINT</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/rent/execute/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>value<span class=\"token punctuation\">.</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token function\">axios</span><span class=\"token punctuation\">(</span>executeOptions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p><code class=\"language-text\">Linux Cron</code>을 이용해 위 코드를 5분에 한 번 실행시킨다.<br>\n일단 DB에서 미래의 예약 정보를 모두 불러온다.<br>\n그 뒤, <code class=\"language-text\">예약 성공</code>, <code class=\"language-text\">예약 대기</code>, <code class=\"language-text\">예약 실패</code> 상태 중 <code class=\"language-text\">예약 대기</code>이며, <code class=\"language-text\">Client</code>가 작동하게 설정한 시간이 되면, 동작중인 예약 프로세스 서버에 예약 정보를 건네주고 예약이 진행된다.<br></p>\n<br>\n<p>만약 위 코드에서 <code class=\"language-text\">throw</code> 된다면, 실패 시 찍히는 <code class=\"language-text\">console.log</code>를 따로 저장해서, 어떤 경우에서 실패하는지 모니터링을 하였다.<br></p>\n<br>\n<h2 id=\"-프로젝트-설계도\" style=\"position:relative;\"><a href=\"#-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%84%A4%EA%B3%84%EB%8F%84\" aria-label=\" 프로젝트 설계도 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📑 프로젝트 설계도</h2>\n<br>\n<p>멘토님이 프로젝트 리딩을 해주셔서 토이 프로젝트 치고 꽤 괜찮은 설계들이 나왔다.<br></p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 111.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB7ElEQVQ4y42V6Y7DIAyEef+3a39VVdX7Su87vVJWn1eDSEK2i4SgsZmxx4Y6H43P5xNWTcbpdPL3+71kaxouBmrar1Yrf71e/w9YdXw+n/79fgcnAM/nc43wa4SsgAFwPB5tP5vN/HA49JPJxN9utxp5LA+zBCiAwWBgur1er6Dh4XBo1LkRsCgKAyGSy+Viui2XS9/pdHy/37dv39J2qQoTqQZaEh0SQEC1mXmeGzF79N3v92YvRUh0MgLKAfREgs1mYz4AoCcRQ7Tb7YxsPB7b6mKBcV4sFnaAlRRxgoDD+Amw2+369XptxHwnOgJycf6kATOaoZ2qGg8OATQajYxM4/F4/BYFEGlDFESWZVlom1SbQAQhIJyHhJWiuu1266fTabgNsKMHexxSV5G+bLVaRow/gSh1BzofYOADekGAA4CpvsMGKAVJtg0Oaoder+fb7bYBE338KEgrZEFrVpGGxtYGA5PK0iYAppqYviQbpgoR+9XaZj6fW5T0nR6IOPXUiG2lxhY7wKqwmp3KElF8x6vVLwGmIgCY9qCR9chSwCpgfN79lYp6jGqy/zbCa0OqqUnapEmhWPkGgexoixxELb2dRNfU06Xni9/cGg7xWzbZIVVT11IWIC3DzdFKxfVAsGdySwCt/gf9ACr9tgiYYpp+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"사용자 시나리오\"\n        title=\"사용자 시나리오\"\n        src=\"/static/8d7b7649a3cf33183dee260f5a8d432f/37523/senario.png\"\n        srcset=\"/static/8d7b7649a3cf33183dee260f5a8d432f/e9ff0/senario.png 180w,\n/static/8d7b7649a3cf33183dee260f5a8d432f/f21e7/senario.png 360w,\n/static/8d7b7649a3cf33183dee260f5a8d432f/37523/senario.png 720w,\n/static/8d7b7649a3cf33183dee260f5a8d432f/62de4/senario.png 746w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>사용자 예상 시나리오</p>\n</blockquote>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 88.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAACDklEQVQ4y4VU21LbQAzN/38LfS0P8A6FaXiifQAKMYlz8TW+e3e9p3PUkccJpmRGs7JWOjrSSlk45zAn3nm8N2vcRLe4iW8RNIHYPvOnWGuxmL1wFnDAa/2Kq801rsJrvNQvYuPdOcgJ4DAM8N6LUFcRlt4j3IbYbDai0zb1mcaNgGVZIk1TZFmGtm1hjEHXdXJS0iRFEifo+/7kjnGMYWzTNAIqgHVdY7fbIY5jATwej6IzoCgL+WYQz6qqROfJ+/1+L8JkIyAvkiQRB2bXn5ZIG4XOtOmPrDTZCUM60cAgngSnI9nyWxtOnZLnuYDoPeM0uQBaY+GMg+kMTG+EvoIwSEXBlbH2+MMr/2p/4768x7J6QGlK1GWN9XotDmRCxlEUyTnO6GQi1Kb64rF9xI/iDj+rJdI6RVVU0miy4ivK4xTFOAX8/u9gS8nWSdmaXR+FWZUhdQIyGXs8Zff1plgrvSSbMAylBRwV9oxsp337EpCZ2XSy4TwGQYDVaiX91Ek4Z6fr+AGQjmTBstgzAhD0cDiMw3u+v4Mb4AcPDBB9MUebZen4sF+U6R5Pd7izHbI2Q97lKNpivmSWS3Ysk4NMlhTadIezPEPf9HjL3/A9usTFn29YNg/zj0LRPwIF5M6TNU8y5p5zEdIqxfPxGU/5E7bN9nNAHSEF0YciGHssfyZdi77rYVoDb/718S8rhHVCz5HaDgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"DFD\"\n        title=\"DFD\"\n        src=\"/static/f83df9f61ec1f4a8d8339bfa7ca18418/37523/DFD.png\"\n        srcset=\"/static/f83df9f61ec1f4a8d8339bfa7ca18418/e9ff0/DFD.png 180w,\n/static/f83df9f61ec1f4a8d8339bfa7ca18418/f21e7/DFD.png 360w,\n/static/f83df9f61ec1f4a8d8339bfa7ca18418/37523/DFD.png 720w,\n/static/f83df9f61ec1f4a8d8339bfa7ca18418/302a4/DFD.png 1080w,\n/static/f83df9f61ec1f4a8d8339bfa7ca18418/07a9c/DFD.png 1440w,\n/static/f83df9f61ec1f4a8d8339bfa7ca18418/35890/DFD.png 1582w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>Data Flow Diagram</p>\n</blockquote>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 84.44444444444446%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACw0lEQVQ4y5WSWVMaQRSF51f4GCCUyqw9PTPMRBZl8SWv8SkiGhc0eclT8gfyksrfs8qlyn0Di6UUVBhQ5qRuEyhJJSnTVaeA232+Pn0vUqVSwfn5OQ4ODnB5eYlyuYwgCNBstXB2dib2tre3cXh4iJubG9zf38P3fXGOtL+/j52dHVSrVdzd3UG6uroSMDKQarUaut0uOp0OTk9PcXx8jJOTE9C5drst6g8PD+Ky4R4Fub29FRdJBBga6fvT0xN6vZ647eLiQhgp2XDRXr/fx9BHajQaYo+8Ur1eF8WjoyPxBAKRgVLSQTLSMwlEtSGQEpGX9ikx1Sm9RKZKpSx6RWkajbowjK0gQBD0RW9Jvy+qkYc+pY7vo93x0fG7Qn63B8IFzySeA6AvfhB0HPg8gLS2UkRpbQUfVlexWCigWCxicamIYqGA94sFFJaKeLewgG/ff4z6VK3WRHt2d3fFsFqtFh4fHwdAeUoBi8Vgya+hydPgsTAcOQJdm8TkVBTR11FMTExgeXlllOb6+hp7e3ujvxP1mC4SwJl4Gsl4Evk3DHPJGeQ9HW8TBmZSDmyXgzGGaDSK0tbHEbDZbAoopaMh0rBGCS1mwmIMtqmB6RosQ4XDVBhMg8F0GMxAOBzGxubmYAD9vpgoJSI4gUjDYUmWIcMiGOdQFAXyLynyQLqujwP/MOXn05Ysk8PlDB7XwA0VnqnC4yritg5N16BpOiLhMNa3Po1Mf5NI6NlJuFYCCa4gZanIuyrmPQ2ptI102obrmAiFxhP+K6Xkcg7XduA5BuKmJvpH8mwDSc+EF/9PoM0UMRBu2zAYg6Kq0FQVqqJgOqYMnhyJYGNz62VAQ+OIMwOuPg1HjyFhxpDgMixLg64rAh4KvcJ6qfQy4Hw2h1w2g/z8HPK5WeTmUsjksshk0khnZjGbzcCOO/j85euLgD8BR/IY2+GJw0IAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ERD\"\n        title=\"ERD\"\n        src=\"/static/3e49e55d0abb522182278ab65192bf7d/37523/ERD.png\"\n        srcset=\"/static/3e49e55d0abb522182278ab65192bf7d/e9ff0/ERD.png 180w,\n/static/3e49e55d0abb522182278ab65192bf7d/f21e7/ERD.png 360w,\n/static/3e49e55d0abb522182278ab65192bf7d/37523/ERD.png 720w,\n/static/3e49e55d0abb522182278ab65192bf7d/d9199/ERD.png 960w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>Database ERD</p>\n</blockquote>\n<br>\n<p>확실히 시니어가 참여한 프로젝트와 학생끼리 진행하는 프로젝트의 질은 기간을 떠나서 확연한 차이가 나는것 같다.<br></p>\n<br>\n<h2 id=\"-후기\" style=\"position:relative;\"><a href=\"#-%ED%9B%84%EA%B8%B0\" aria-label=\" 후기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>😁 후기</h2>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA5ElEQVQoz5VRa2vCQBC8v2F93CW5XLwYkaJQW3pE8YWJDxCxVGz/RZH++im7iWBFkHwYdnZubpnbEz/nX2TrLfqDIbSJS1iEUQdBaEseMyeQzp6yLzzFPelpiFfn0HsfILIJCy2lIZWG8g2kFzKUX1Q+K7V7faPlQ0zTFPv9AS4dwbQTTkAHtbrEU0NxvfB7/bVOVVhjkOUbDN8cIttFUwb/DPWmVwlitVjg8PEJl44RJz2EJuaktIJAtysPFZHWOB6/8Nx/4adSQtoN4ZK20sBdvsTp9I3JbM6/ebsbMl3zRwP/ANKPyOkDbgp1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"실패\"\n        title=\"실패\"\n        src=\"/static/d0826ddd5c72c30c47a0eef5c3ca0011/37523/fail.png\"\n        srcset=\"/static/d0826ddd5c72c30c47a0eef5c3ca0011/e9ff0/fail.png 180w,\n/static/d0826ddd5c72c30c47a0eef5c3ca0011/f21e7/fail.png 360w,\n/static/d0826ddd5c72c30c47a0eef5c3ca0011/37523/fail.png 720w,\n/static/d0826ddd5c72c30c47a0eef5c3ca0011/302a4/fail.png 1080w,\n/static/d0826ddd5c72c30c47a0eef5c3ca0011/07a9c/fail.png 1440w,\n/static/d0826ddd5c72c30c47a0eef5c3ca0011/263f4/fail.png 1996w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>사실 결과적으로 실패한 프로젝트여서 마무리가 너무 아쉬웠던 프로젝트이다.<br>\n예약 사이트의 <code class=\"language-text\">IP 차단 로직</code>이 들어가 있었는데 이 부분에 대해 대응을 전혀 하지 않았기 때문이다.<br>\n지속적인 IP 차단으로 인해 정상적인 서버 운영이 힘들었고, 동적 IP를 할당하여 지속적으로 변경해줘도 막히면 다시 IP를 할당하는데 시간이 걸렸기 때문이다.<br></p>\n<br>\n<p>그래서 동적 IP 풀을 구성해서 <code class=\"language-text\">IP 차단 응답</code>이 오거나 <code class=\"language-text\">timeout</code>이 될 때 IP를 변경해준 뒤, 매일 00시 IP 풀을 한번 초기화 해주는 방법을 시도하려 했지만, 아쉽게도 프로젝트는 마무리 되었다.<br></p>\n<br>\n<h2 id=\"️-그래서-뭘-배웠냐-️\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-%EA%B7%B8%EB%9E%98%EC%84%9C-%EB%AD%98-%EB%B0%B0%EC%9B%A0%EB%83%90-%EF%B8%8F\" aria-label=\"️ 그래서 뭘 배웠냐 ️ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>❗️ 그래서 뭘 배웠냐 ❗️</h2>\n<br>\n<p>이 프로젝트를 진행하며, 특정 사이트의 세션 유지 방법을 알게 되었고, HTTP 통신을 더 뜯어본 계기가 되었다.<br>\n또한, 가상 브라우저 없이 단순 요청/응답 만으로 원하는 결과를 얻는, 즉 리소스를 최소한으로 소모하며 통신을 하는 방법을 깨달았다.<br>\n이런 경험을 통해 문제 해결력을 키우고 여러 방면으로 사고를 할 수 있는 개발자가 되어가고 있는 것 같다.<br></p>\n<br>\n<h2 id=\"-github-주소\" style=\"position:relative;\"><a href=\"#-github-%EC%A3%BC%EC%86%8C\" aria-label=\" github 주소 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📚 Github 주소</h2>\n<br/>\n<blockquote>\n<p><a href=\"https://github.com/KOREAparksh/TennisKing\">https://github.com/KOREAparksh/TennisKing</a></p>\n</blockquote>\n<br/>\n<br/>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-%EA%B0%9C%EB%B0%9C%ED%95%98%EA%B2%8C-%EB%90%9C-%EA%B3%84%EA%B8%B0\">💫 개발하게 된 계기</a></p>\n<ul>\n<li><a href=\"#-%EC%B2%AB%EB%B2%88%EC%A7%B8-%EB%AF%B8%ED%8C%85\">🤝 첫번째 미팅</a></li>\n<li><a href=\"#-%EC%9A%94%EA%B5%AC%EC%82%AC%ED%95%AD%EC%9D%B4-%EB%93%A4%EC%96%B4%EC%99%94%EB%8B%A4\">📝 요구사항이 들어왔다.</a></li>\n<li><a href=\"#-%EC%9A%B0%EB%8B%B9%ED%83%95%ED%83%95-%EC%84%A4%EA%B3%84\">😵‍💫 우당탕탕 설계</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0%EC%9D%84-%EC%9C%84%ED%95%9C-%EC%A0%91%EA%B7%BC-%EB%B0%A9%EB%B2%95\">👣 문제 해결을 위한 접근 방법</a></p>\n<ul>\n<li><a href=\"#%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%EC%A7%84%ED%96%89%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C-\">프로세스 진행은 어떻게 ❓</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EA%B0%9C%EB%B0%9C-%EB%B0%A9%EB%B2%95\">🧑‍💻 개발 방법</a></p>\n<ul>\n<li><a href=\"#-%ED%8A%B8%EB%A6%AC%EA%B1%B0-%EC%9E%91%EB%8F%99-%EB%B0%A9%EB%B2%95\">🎾 트리거 작동 방법</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%84%A4%EA%B3%84%EB%8F%84\">📑 프로젝트 설계도</a></p>\n</li>\n<li>\n<p><a href=\"#-%ED%9B%84%EA%B8%B0\">😁 후기</a></p>\n</li>\n<li>\n<p><a href=\"#%EF%B8%8F-%EA%B7%B8%EB%9E%98%EC%84%9C-%EB%AD%98-%EB%B0%B0%EC%9B%A0%EB%83%90-%EF%B8%8F\">❗️ 그래서 뭘 배웠냐 ❗️</a></p>\n</li>\n<li>\n<p><a href=\"#-github-%EC%A3%BC%EC%86%8C\">📚 Github 주소</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"April 23, 2022","title":"예약 자동화 서버 개발기","categories":"프로젝트 회고","author":"seongsu","emoji":"1️⃣1️⃣"},"fields":{"slug":"/project/reservation-automation/"}},"site":{"siteMetadata":{"siteUrl":"https://seongsu.me","comments":{"utterances":{"repo":"nfl1ryxditimo12/nfl1ryxditimo12.github.io"}}}}},"pageContext":{"slug":"/skill/typeorm-virtual-column-2/","nextSlug":"/skill/typeorm-virtual-column-1/","prevSlug":"/project/reservation-automation/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}